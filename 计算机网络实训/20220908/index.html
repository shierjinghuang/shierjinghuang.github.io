<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="计算机网络实训, 十二惊惶">
    <meta name="description" content="# 实训一阶段 1：基本网络通信

要求：
开发一个聊天程序；
包含客户端和服务器端；
编程语言不限；
要能在两台 PC 上运行。

# 初级阶段 1：socket 使用
在 TCP 中，客户端的实现流程：（1）创建客户端的 socket ">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>计算机网络实训 | 十二惊惶</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="十二惊惶" type="application/atom+xml">
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/1.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">十二惊惶</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/1.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">十二惊惶</div>
        <div class="logo-desc">
            
            犁牛之子骍且角，虽欲勿用，山川其舍诸
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://gitee.com/Im-so-scared-2/shier_jinghuang" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>十二惊惶
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://gitee.com/Im-so-scared-2/shier_jinghuang" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="十二惊惶" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/22.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">计算机网络实训</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E5%AE%9E%E8%AE%AD%E8%AE%B0%E5%BD%95/">
                                <span class="chip bg-color">实训记录</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E7%9B%B8%E5%85%B3/" class="post-category">
                                网络工程相关
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-09-08
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-11-13
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    29.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    128 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="实训一阶段1基本网络通信"><a class="markdownIt-Anchor" href="#实训一阶段1基本网络通信">#</a> 实训一阶段 1：基本网络通信</h1>
<blockquote>
<p>要求：</p>
<p>开发一个聊天程序；</p>
<p>包含客户端和服务器端；</p>
<p>编程语言不限；</p>
<p>要能在两台 PC 上运行。</p>
</blockquote>
<h2 id="初级阶段1socket使用"><a class="markdownIt-Anchor" href="#初级阶段1socket使用">#</a> 初级阶段 1：socket 使用</h2>
<p>在 TCP 中，客户端的实现流程：（1）创建客户端的 socket 对象   （2）建立与服务器之间的联系  （3）发送请求  （4）接收数据  （5）关闭连接</p>
<p>服务端的实现流程：（1）创建服务端的 socket 对象  （2）绑定服务端的地址 （3）设置监听器 （4）等待客户端的连接 （5）接收客户端的请求  （6）返回处理的结果到客户端</p>
<p><img src="https://img-blog.csdn.net/20180115185303067" alt></p>
<p><strong>套接字 (Socket)</strong>，就是对网络中不同主机上的应用进程之间进行双向通信的端点的抽象。一个套接字就是网络上进程通信的一端，提供了应用层进程利用网络协议交换数据的机制。从所处的地位来讲，套接字上联应用进程，下联网络协议栈，是应用程序通过网络协议进行通信的接口，是应用程序与网络协议栈进行交互的接口</p>
<p><strong>应用程序接口</strong>（英语：<strong>A</strong>pplication <strong>P</strong>rogramming <strong>I</strong>nterface，简称：<strong>API</strong>），又称为<strong>应用编程接口</strong>，就是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%BD%AF%E4%BB%B6?fromModule=lemma_inlink">软件</a>系统不同组成部分衔接的约定。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">socket编程思路</span><br><span class="line">TCP服务端：</span><br><span class="line">1 创建套接字，绑定套接字到本地IP与端口</span><br><span class="line">   # socket.socket(socket.AF_INET,socket.SOCK_STREAM) , s.bind()</span><br><span class="line">2 开始监听连接                   #s.listen()</span><br><span class="line">3 进入循环，不断接受客户端的连接请求              #s.accept()</span><br><span class="line">4 然后接收传来的数据，并发送给对方数据         #s.recv() , s.sendall()</span><br><span class="line">5 传输完毕后，关闭套接字                     #s.close()</span><br><span class="line"></span><br><span class="line">TCP客户端:</span><br><span class="line">1 创建套接字，连接远端地址</span><br><span class="line">       # socket.socket(socket.AF_INET,socket.SOCK_STREAM) , s.connect()</span><br><span class="line">2 连接后发送数据和接收数据          # s.sendall(), s.recv()</span><br><span class="line">3 传输完毕后，关闭套接字          #s.close()</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>subprocess 模块</strong>允许我们启动一个新进程，并连接到它们的输入 / 输出 / 错误管道，从而获取返回值。</p>
</blockquote>
<blockquote>
<p>Python3 网络编程</p>
<p>Python 提供了两个级别访问的网络服务。：</p>
<ul>
<li>低级别的网络服务支持基本的 Socket，它提供了标准的 BSD Sockets API，可以访问底层操作系统 Socket 接口的全部方法。</li>
<li>高级别的网络服务模块 SocketServer， 它提供了服务器中心类，可以简化网络服务器的开发。</li>
</ul>
<p>Socket 又称 &quot;套接字&quot;，应用程序通常通过 &quot;套接字&quot; 向网络发出请求或者应答网络请求，使主机间或者一台计算机上的进程间可以通讯。</p>
<p>网络中进程间如何通信，即利用三元组【ip 地址，协议，端口】可以进行网络间通信了，那我们应该怎么实现了，因此，我们 socket 应运而生，它就是利用三元组解决网络通信的一个中间件工具</p>
<p>TCP 建立连接时要传输三个数据包，俗称三次握手（Three-way Handshaking）。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Shake 1</span>] 套接字A：“你好，套接字B，我这里有数据要传送给你，建立连接吧。”</span><br><span class="line">[<span class="meta">Shake 2</span>] 套接字B：“好的，我这边已准备就绪。”</span><br><span class="line">[<span class="meta">Shake 3</span>] 套接字A：“谢谢你受理我的请求。</span><br></pre></td></tr></table></figure>
</blockquote>
<table>
<thead>
<tr>
<th>服务器端套接字</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>s.bind()</td>
<td>绑定地址（host,port）到套接字， 在 AF_INET 下，以元组（host,port）的形式表示地址。</td>
</tr>
<tr>
<td>s.listen()</td>
<td>开始 TCP 监听。backlog 指定在拒绝连接之前，操作系统可以挂起的最大连接数量。该值至少为 1，大部分应用程序设为 5 就可以了。<br>listen 函数中 backlog 的含义是什么？完成队列的长度 (<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/78879634">https://zhuanlan.zhihu.com/p/78879634</a>)</td>
</tr>
<tr>
<td>s.accept()</td>
<td>被动接受 TCP 客户端连接，(阻塞式) 等待连接的到来</td>
</tr>
</tbody>
<tbody>
<tr>
<td>客户端套接字</td>
<td></td>
</tr>
<tr>
<td>------------</td>
<td>------------------------------------------------------------</td>
</tr>
<tr>
<td>s.connect()</td>
<td>主动初始化 TCP 服务器连接，。一般 address 的格式为元组（hostname,port），如果连接出错，返回 socket.error 错误。</td>
</tr>
</tbody>
<tbody>
<tr>
<td>公共用途的套接字函数</td>
<td></td>
</tr>
<tr>
<td>--------------------</td>
<td>------------------------------------------------------------</td>
</tr>
<tr>
<td>s.recv()</td>
<td>接收 TCP 数据，数据以字符串形式返回，bufsize 指定要接收的最大数据量。flag 提供有关消息的其他信息，通常可以忽略。</td>
</tr>
<tr>
<td>s.send()</td>
<td>发送 TCP 数据，将 string 中的数据发送到连接的套接字。返回值是要发送的字节数量，该数量可能小于 string 的字节大小。</td>
</tr>
<tr>
<td>s.close()</td>
<td>关闭套接字</td>
</tr>
</tbody>
</table>
<h3 id="代码01"><a class="markdownIt-Anchor" href="#代码01">#</a> <strong>代码 0.1</strong></h3>
<p><strong>作用：可以实现服务端和客户端简单交互，但仅限同一个局域网内，且一对一，只能发送一句话</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">错误类型：</span><br><span class="line">1.LookupError: unknown encoding: uft-8</span><br><span class="line">这个错误是记录错误类型的,第一次遇到LookupError ,这个是编码格式本来应该是utf-8 自己打字的时候打错了,打成uft-8 了 所以就出现了这个错误.</span><br><span class="line">2.AttributeError: &#x27;tuple&#x27; object has no attribute &#x27;send&#x27;</span><br><span class="line">错误原因： server.accept()的返回值是一对(conn, address)，其中conn是一个新的套接字对象，可用于在连接上发送和接收数据，地址是绑定到连接另一端的套接字的地址。</span><br><span class="line">解决方法：client,addr = server.accept()</span><br><span class="line">3.TimeoutError: [WinError 10060] 由于连接方在一段时间后没有正确答复或连接的主机没有反应，连接尝试失败。</span><br><span class="line">防火墙没开放该端口网上找到这个……经过24小时检验：socket仅限在局域网使用，所以……一个热点IP和学校内网一起玩……不可能，想的话买个服务器。所以要么开两个学校电脑，要么就在自己电脑上玩耍。</span><br><span class="line">host=&#x27;服务器的静态IP&#x27;（IPv4地址）</span><br><span class="line">host = socket.gethostbyname(socket.gethostname()) （土豆那缺儿，我们一直检验都连不起来原来它是IPv4网关……）</span><br><span class="line">4.</span><br><span class="line">这个时端口号未开放的原因，在防火墙里开放就行</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#客户端</span></span><br><span class="line"><span class="comment">#客户端IP地址：192.168.55.43</span></span><br><span class="line"><span class="comment">#服务器端IP地址：192.168.120.209</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment">#host = socket.gethostname() #获取本地主机名</span></span><br><span class="line">host = <span class="string">&#x27;192.168.31.129&#x27;</span></span><br><span class="line">port = <span class="number">8800</span> <span class="comment">#设置端口</span></span><br><span class="line"><span class="built_in">print</span>(host)</span><br><span class="line"></span><br><span class="line"><span class="comment">##第一步：创建嵌套字，连接远端地址</span></span><br><span class="line">client = socket.socket(socket.AF_INET,socket.SOCK_STREAM) <span class="comment">#创建socket对象</span></span><br><span class="line">client.connect((host,port)) <span class="comment">#连接服务端，指定主机和端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##第二步：连接后发送数据/接收数据</span></span><br><span class="line">msg = client.recv(<span class="number">1024</span>) <span class="comment">#接收小于1024字节的数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##第三步：传输完毕，关闭嵌套字</span></span><br><span class="line">client.close()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(msg.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务端</span></span><br><span class="line"><span class="comment">#客户端IP地址：192.168.55.43</span></span><br><span class="line"><span class="comment">#服务器端IP地址：192.168.120.209</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment">#host = socket.gethostname() #获取本地主机名</span></span><br><span class="line">host = <span class="string">&#x27;192.168.120.209&#x27;</span></span><br><span class="line">port = <span class="number">8800</span></span><br><span class="line"><span class="built_in">print</span>(host)</span><br><span class="line"></span><br><span class="line"><span class="comment">##第一步：创建嵌套字，绑定套接字到本地IP与端口</span></span><br><span class="line">server = socket.socket(socket.AF_INET,socket.SOCK_STREAM) <span class="comment">#创建socket对象</span></span><br><span class="line">server.bind((host,port)) <span class="comment">#绑定端口号</span></span><br><span class="line"><span class="comment">#bind():绑定地址（host,port）到套接字,在AF_INET下,以元组（host,port）的形式表示地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##第二步：监听连接</span></span><br><span class="line">server.listen(<span class="number">1</span>) <span class="comment">#开始监听;最大连接1台客户端，超过后排队</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##第三步：进入循环，不断接受客户端的连接请求</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    client,addr = server.accept() <span class="comment">#创建客户端连接</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;连接地址：%s&quot;</span>%<span class="built_in">str</span>(addr))</span><br><span class="line">    <span class="comment">##第四步：接收传来的数据/发送给对方数据</span></span><br><span class="line">    msg = <span class="string">&#x27;Hello!&#x27;</span></span><br><span class="line">    client.send(msg.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="comment">##第五步：传输完毕后，关闭套接字</span></span><br><span class="line">    client.close()</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>为什么多个客户端可以连接服务器的同个端口？</strong></p>
<p>我们这里讲 Socket 连接：<br>
1. 端口只是一个数字辨识，不是真正的物理端口；<br>
2. 一个 Socket 连接的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E4%B8%BB%E9%94%AE&amp;spm=1001.2101.3001.7020">主键</a>（即不同 socket 之间的区分）是由一个五元组 {SRC-IP, SRC-PORT, DEST-IP, DEST-PORT, PROTOCOL} 组成，即 {源地址，源端口，目标地址，目标端口，协议} 组成，那些说四元组不包含协议的说法是错误的。<br>
3. 一个进程可以拥有多个 socket 连接。</p>
<p>例子一、两个客户端连接在同个服务器的同个端口 80，即有两个 socket 连接：<br>
- socket1 {SRC-A, 100, DEST-X,80, TCP}<br>
- socket2{SRC-B, 100, DEST-X,80, TCP}<br>
 主机 A 和主机 B 的地址不同，两台主机同时连接到服务器 X 的 80 端口。服务器要怎么处理这个连接是它的事，我们要理解的是为什么一个主机同个端口能监听多个客户端 Socket 连接。</p>
<p>解释：<br>
1. 是因为两个客户端的 IP 不同，服务器能识别出不同的 Socket；<br>
2. 即使 IP 地址相同，端口不同，服务器也能够分辨；<br>
3. 只要服务器知道收到的请求和哪个 socket 相关，那么它就能使用这个 socket 正确地回复那个客户端；<br>
4. 如果对于不同的 socket 需要不同的端口，那么不仅仅浪费服务器资源，而且每次客户端连接上 serverSocket 之后还要另外分配新的端口和客户端通信。没必要。</p>
<p>例子二、不同的进程可以监听同一个端口。</p>
<ol>
<li>因此在服务器的两个使用不同协议的进程可以监听同一个端口。</li>
<li>如果一个 socket 的辨识只是四元组不包括协议 {SRC-IP, SRC-PORT, DEST-IP, DEST-PORT}，那么不同进程是不可能同时监听同一个端口的。没有协议的话一个客户端连接到同一台某个有两个进程监听端口的服务器，那么就没有什么机制可以确定客户端是要连接哪一个进程了。</li>
</ol>
<p>总结：</p>
<ol>
<li>不同协议可以监听同一个端口（不管是不是在服务器的同个进程）</li>
<li>某个协议的进程可以监听多个客户端的连接，因为只要五元组不同进程就能分辨。</li>
<li>从上面的例子可以知道，客户端同个进程也可以在同个端口用不同的协议与客户端建立连接。</li>
</ol>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/066d99da7cbd">一、Socket 技术详解 - 简书 (jianshu.com)</a></p>
<h3 id="代码02"><a class="markdownIt-Anchor" href="#代码02">#</a> <strong>代码 0.2</strong></h3>
<p><strong>作用：在 0.1 基础上，实现服务器接收数据，客户端发送数据</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">host = socket.gethostname() <span class="comment">#获取本地主机名</span></span><br><span class="line">port = <span class="number">9999</span></span><br><span class="line"><span class="built_in">print</span>(host)</span><br><span class="line"></span><br><span class="line"><span class="comment">##第一步：创建嵌套字，绑定套接字到本地IP与端口</span></span><br><span class="line">server = socket.socket(socket.AF_INET,socket.SOCK_STREAM) <span class="comment">#创建socket对象</span></span><br><span class="line">server.bind((host,port)) <span class="comment">#绑定端口号</span></span><br><span class="line"><span class="comment">#bind():绑定地址（host,port）到套接字,在AF_INET下,以元组（host,port）的形式表示地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##第二步：监听连接</span></span><br><span class="line">server.listen(<span class="number">2</span>) <span class="comment">#开始监听;最大连接1台客户端，超过后排队</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##第三步：进入循环，不断接受客户端的连接请求</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    client,addr = server.accept() <span class="comment">#创建客户端连接</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;连接地址：%s&quot;</span>%<span class="built_in">str</span>(addr))</span><br><span class="line">    <span class="comment">##第四步：接收传来的数据和转发对方数据</span></span><br><span class="line">    msg = client.recv(<span class="number">1024</span>) <span class="comment">#接收小于1024字节的数据</span></span><br><span class="line">    <span class="built_in">print</span>(msg.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="comment">##第五步：传输完毕后，关闭套接字</span></span><br><span class="line">    client.close()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#客户端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">host = socket.gethostname() <span class="comment">#获取本地主机名</span></span><br><span class="line"><span class="comment">#host = socket.gethostbyname(socket.gethostname())</span></span><br><span class="line"><span class="comment">#host = &#x27;39.144.108.89&#x27;</span></span><br><span class="line">port = <span class="number">9999</span> <span class="comment">#设置端口</span></span><br><span class="line"><span class="built_in">print</span>(host)</span><br><span class="line"></span><br><span class="line"><span class="comment">##第一步：创建嵌套字，连接远端地址</span></span><br><span class="line">client = socket.socket(socket.AF_INET,socket.SOCK_STREAM) <span class="comment">#创建socket对象</span></span><br><span class="line">client.connect((host,port)) <span class="comment">#连接服务端，指定主机和端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##第二步：连接后发送数据/接收数据</span></span><br><span class="line">msg = <span class="string">&#x27;Hello!&#x27;</span></span><br><span class="line">client.send(msg.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">##第三步：传输完毕，关闭嵌套字</span></span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure>
<h3 id="代码03"><a class="markdownIt-Anchor" href="#代码03">#</a> <strong>代码 0.3</strong></h3>
<p><strong>作用：在 0.2 基础上，实现可传可接收，但存在问题，未解决</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">host = socket.gethostname() <span class="comment">#获取本地主机名</span></span><br><span class="line"><span class="comment">#host = &#x27;192.168.120.29&#x27; #服务端IP地址</span></span><br><span class="line">port = <span class="number">8800</span></span><br><span class="line">max_connect = <span class="number">1</span> <span class="comment">#最大连接客户端数</span></span><br><span class="line">max_receive_data = <span class="number">1024</span> <span class="comment">#最大接收字节数</span></span><br><span class="line">server_name = <span class="string">&#x27;老王&#x27;</span> <span class="comment">#设置用户名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##第一步：创建嵌套字，绑定套接字到本地IP与端口</span></span><br><span class="line">server = socket.socket(socket.AF_INET,socket.SOCK_STREAM) <span class="comment">#创建socket对象</span></span><br><span class="line">server.bind((host,port)) <span class="comment">#绑定端口号</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##第二步：监听连接</span></span><br><span class="line">server.listen(max_connect) <span class="comment">#开始监听;最大连接1台客户端，超过后排队</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Server is ready.&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">##第三步：进入循环，不断接受客户端的连接请求</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    client,addr = server.accept() <span class="comment">#创建客户端连接</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;连接地址：%s&quot;</span>%<span class="built_in">str</span>(addr))</span><br><span class="line">    <span class="comment">##第四步：接收传来的数据/发送给对方数据</span></span><br><span class="line">    <span class="comment">#发送数据</span></span><br><span class="line">    send_msg = <span class="built_in">input</span>(<span class="string">&#x27;请输入：&#x27;</span>)</span><br><span class="line">    send_msg = server_name + <span class="string">&#x27;: &#x27;</span>+ send_msg</span><br><span class="line">    client.send(send_msg.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span> send_msg == <span class="string">&#x27;close&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment">#接收数据</span></span><br><span class="line">    receive_msg = client.recv(max_receive_data)</span><br><span class="line">    <span class="built_in">print</span>(receive_msg.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    </span><br><span class="line"><span class="comment">##第五步：传输完毕后，关闭套接字</span></span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#客户端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">host = socket.gethostname() <span class="comment">#获取本地主机名</span></span><br><span class="line"><span class="comment">#host = &#x27;192.168.31.129&#x27; #服务端IP地址</span></span><br><span class="line">port = <span class="number">8800</span> <span class="comment">#设置端口</span></span><br><span class="line">max_receive_data = <span class="number">1024</span> <span class="comment">#最大接收字节数</span></span><br><span class="line">client_name = <span class="string">&#x27;老刘&#x27;</span> <span class="comment">#设置用户名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##第一步：创建嵌套字，连接远端地址</span></span><br><span class="line">client = socket.socket(socket.AF_INET,socket.SOCK_STREAM) <span class="comment">#创建socket对象</span></span><br><span class="line">client.connect((host,port)) <span class="comment">#连接服务端，指定主机和端口</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Connecting is successful!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">##第二步：连接后发送数据/接收数据</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment">#接收数据</span></span><br><span class="line">    receive_msg = client.recv(max_receive_data)</span><br><span class="line">    <span class="built_in">print</span>(receive_msg.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span> receive_msg.decode(<span class="string">&#x27;utf-8&#x27;</span>)==<span class="string">&#x27;close&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment">#发送数据</span></span><br><span class="line">    send_msg = <span class="built_in">input</span>(<span class="string">&#x27;请输入：&#x27;</span>)</span><br><span class="line">    send_msg = client_name + <span class="string">&#x27;: &#x27;</span>+ send_msg</span><br><span class="line">    client.send(send_msg.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    </span><br><span class="line"><span class="comment">##第三步：传输完毕，关闭嵌套字</span></span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure>
<h2 id="初级阶段2hreading使用"><a class="markdownIt-Anchor" href="#初级阶段2hreading使用">#</a> 初级阶段 2：hreading 使用</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">服务器端的套接字起到监听的作用（类似电话主机），每连接成功一个客户端，就返回一个和客户端通信的套接字（类似电话的分机），服务器端用每个“分机”和每个客户端进行通信。</span><br><span class="line">因为我们使用的是默认的阻塞套接字，服务器和每个客户端通信的过程都是阻塞的，所以，为了服务器可以“同时”（并发）和客户端进行通信，我们用到了多线程。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>hreading (多线程) 模块中包含了关于线程操作的丰富功能，包括：常用线程函数，线程对象，锁对象，递归锁对象，事件对象，条件变量对象，信号量对象，定时器对象，栅栏对象。</p>
<p>创建 Thread 对象有 2 种手段：</p>
<p>1. 直接创建 Thread ，将一个 callable 对象从类的构造器传递进去，这个 callable 就是回调函数，用来处理任务。<br>
2.<strong> 编写一个自定义类继承 Thread，然后复写 run () 方法，在 run () 方法中编写任务处理代码，然后创建这个 Thread 的子类。</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/briblue/article/details/85101144">(29 条消息) Python 多线程编程 (一）：threading 模块 Thread 类的用法详解_frank909 的博客 - CSDN 博客_python threading</a></p>
</blockquote>
<blockquote>
<p>Python 将一个列表里面的元素拼接成一个字符串:</p>
<p>注意: 1. 列表里面的元素必须全是字符串才可以使用 join () 进行拼接</p>
<p>2. 返回的是一个字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">item1 = [<span class="string">&quot;lowman&quot;</span>, <span class="string">&quot;isbusy&quot;</span>]</span><br><span class="line">item2 = <span class="string">&quot;,&quot;</span>.join(item1) <span class="comment"># 根据实际需要使用相应的分隔符连接列表元素,如 , : ; 或者空字符串</span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>Thread.setDaemon (false) 设置为用户线程；通过 Thread.setDaemon (true) 设置为守护线程。如果不设置次属性，默认为用户线程。</p>
<p>用户线程和守护线程的区别：</p>
<p>1. 主线程结束后用户线程还会继续运行，JVM 存活；主线程结束后守护线程和 JVM 的状态又下面第 2 条确定。</p>
<p>2. 如果没有用户线程，都是守护线程，那么 JVM 结束（随之而来的是所有的一切烟消云散，包括所有的守护线程）。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xyls12345/article/details/26256693">(29 条消息) Thread.setDaemon 详解_starfe-geek 的博客 - CSDN 博客_thread.setdeamon</a></p>
</blockquote>
<table>
<thead>
<tr>
<th>Threading 模块的对象</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Thread</td>
<td>线程对象</td>
</tr>
</tbody>
<tbody>
<tr>
<td>Threading 模块的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Thread%E7%B1%BB&amp;spm=1001.2101.3001.7020"> Thread 类</a></td>
<td>描述</td>
</tr>
<tr>
<td>------------------------------------------------------------</td>
<td>------------------------------------------------------------</td>
</tr>
<tr>
<td>name</td>
<td>线程名（属性）</td>
</tr>
<tr>
<td>ident</td>
<td>线程标识符（属性）</td>
</tr>
<tr>
<td>daemon</td>
<td>线程是否是守护线程（属性）</td>
</tr>
<tr>
<td><em>init</em>(group=None, tatget=None, name=None, args=(),kwargs ={}, verbose=None, daemon=None)</td>
<td>实例化一个线程对象，需要有一个可调用的 target，以及其参数 args 或 kwargs。还可以传递 name 或 group 参数，不过后者还未实现。此外， verbose 标 志 也 是 可 接 受 的。 而 daemon 的 值 将 会 设定 thread.daemon 属性 / 标志</td>
</tr>
<tr>
<td>start()</td>
<td>开启线程</td>
</tr>
<tr>
<td>run()</td>
<td>定义线程功能的方法（通常在子类中被应用开发者重写）</td>
</tr>
</tbody>
</table>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wqx521/article/details/82754617">(29 条消息) Python3—— 多线程之 threading 模块_a1314521531 的博客 - CSDN 博客_python3 threading</a></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/klchang/p/4635040.html">Python 中获取异常（Exception）信息</a></p>
<p>repr(e)</p>
<p>给出较全的异常信息，包括异常信息的类型，如 1/0 的异常信息</p>
<p>“ZeroDivisionError(‘integer division or modulo by zero’,)”</p>
</blockquote>
<h3 id="代码04"><a class="markdownIt-Anchor" href="#代码04">#</a> <strong>代码 0.4</strong></h3>
<p><strong>作用：在 0.3 基础上实现多客户端交流，但发送数据和接收数据（显示）安排不合理</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wyn1564464568/article/details/122891038">(29 条消息) python 实现简易聊天室程序_Castria 的博客 - CSDN 博客_python 聊天室项目代码</a></p>
<blockquote>
<p>首先服务器端创建 ServerSocket 对象，等待客户连接。</p>
<p>每当有一个客户连接上时，使用一个线程保存其 Socket，把该线程保存在一个 HashMap 集合中。</p>
<p>客户端有信息发送给服务器时，服务器先获取要接收者用户名，根据用户名获取保存的线程（如果没有找到该线程则回发给发送者消息提示其需要联系的用户未上线），再根据该线程创建输出流，把消息转发给接收者。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务器</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">host = socket.gethostname()  <span class="comment"># 获取本地主机名</span></span><br><span class="line">port = <span class="number">9999</span>  <span class="comment"># 设置端口</span></span><br><span class="line">max_connect = <span class="number">2</span>  <span class="comment"># 设置最大连接客户端数</span></span><br><span class="line">max_recedata = <span class="number">1024</span>  <span class="comment"># 设置最大接收字节数</span></span><br><span class="line"><span class="built_in">print</span>(host)</span><br><span class="line"></span><br><span class="line">server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  <span class="comment"># 创建socket对象</span></span><br><span class="line">server.bind((host, port))  <span class="comment"># 绑定端口号</span></span><br><span class="line">server.listen(max_connect)  <span class="comment"># 开始监听;最大连接2台客户端，超过后排队</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;ServerSocket is ready.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cnt = <span class="number">0</span>  <span class="comment"># 当前在线人数</span></span><br><span class="line">textList = []  <span class="comment"># 存储历史记录</span></span><br><span class="line">socketList = []  <span class="comment"># 存储已有客户端（套接字）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义类继承，重写run()方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadCreate</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, client</span>):</span>  <span class="comment"># 线程初始化</span></span><br><span class="line">        threading.Thread.__init__(self)  <span class="comment"># 当作Thread的固定结构吧……</span></span><br><span class="line">        self.client = client  <span class="comment"># 保存嵌套字（客户端）</span></span><br><span class="line">        socketList.append(client)  <span class="comment"># 把嵌套字存在列表里</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">global</span> cnt</span><br><span class="line">            <span class="keyword">for</span> sock <span class="keyword">in</span> socketList:</span><br><span class="line">                <span class="keyword">if</span> sock == self.client:</span><br><span class="line">                    sock.send((<span class="string">&#x27;Old client.There are %d presons.&#x27;</span>%(cnt)).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    sock.send((<span class="string">&#x27;New Client is Coming.There are %d presons.&#x27;</span>%(cnt)).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                word = self.client.recv(max_recedata).decode() <span class="comment">#接收数据</span></span><br><span class="line">                textList.append(word) <span class="comment">#生成历史记录</span></span><br><span class="line">                <span class="keyword">for</span> sock <span class="keyword">in</span> socketList: <span class="comment">#给所有客户端发送新消息</span></span><br><span class="line">                    sock.send((<span class="string">&#x27;\n&#x27;</span>+word).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e: <span class="comment">#客户端强制断开连接（关闭窗口）</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">repr</span>(e)) <span class="comment">#如何加一个时间戳？</span></span><br><span class="line">            cnt = cnt-<span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Lose one person.There are %d persons.&#x27;</span>%(cnt))</span><br><span class="line">            socketList.remove(self.client) <span class="comment">#移除该客户端</span></span><br><span class="line">            <span class="keyword">for</span> sock <span class="keyword">in</span> socketList:</span><br><span class="line">                sock.send((<span class="string">&#x27;Lose one person.There are %d persons.&#x27;</span>%(cnt)).encode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    client, addr = server.accept()  <span class="comment"># 创建客户端连接，每次接收一个连接</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;连接地址：%s&quot;</span> % <span class="built_in">str</span>(addr))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 关于历史记录的处理</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(textList) == <span class="number">0</span>:</span><br><span class="line">            client.send(<span class="string">&#x27;No message.&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            client.send(<span class="string">&#x27;\n&#x27;</span>.join(textList).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        cnt = cnt + <span class="number">1</span>  <span class="comment"># 来了一个人加一</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 给用户创建新进程</span></span><br><span class="line">        newThread = ThreadCreate(client)</span><br><span class="line">        newThread.setDaemon(<span class="literal">True</span>)  <span class="comment"># 设置为守护线程</span></span><br><span class="line">        newThread.start()  <span class="comment"># 开启线程</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Connecting is successful!The number of people is &#x27;</span> + <span class="built_in">str</span>(cnt) + <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">repr</span>(e))</span><br><span class="line">    <span class="comment"># finally:</span></span><br><span class="line">    <span class="comment">#     client.close()</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#客户端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">server_host = socket.gethostname() <span class="comment">#获取本地主机名</span></span><br><span class="line">server_port = <span class="number">9999</span> <span class="comment">#设置端口</span></span><br><span class="line">max_recedata = <span class="number">1024</span>  <span class="comment"># 设置最大接收字节数</span></span><br><span class="line">client_name = <span class="string">&#x27;Nacy&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(server_host)</span><br><span class="line"></span><br><span class="line">client = socket.socket(socket.AF_INET,socket.SOCK_STREAM) <span class="comment">#创建socket对象</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Connecting......&#x27;</span>)</span><br><span class="line">client.connect((server_host,server_port)) <span class="comment">#连接服务端，指定主机和端口</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Connecting is successful!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">msg = client.recv(max_recedata) <span class="comment">#先接收历史消息</span></span><br><span class="line"><span class="keyword">if</span> msg.decode(<span class="string">&#x27;utf-8&#x27;</span>)!=<span class="string">&#x27;No message.&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(msg.decode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">&#x27;\n------以上是历史消息------\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#接收文字的线程</span></span><br><span class="line"><span class="comment">#由于用户的发送和接收消息是不同步的，在接收消息时线程会阻塞，所以另开启一个线程进行接收文字</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadReceive</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            receive_msg = client.recv(max_recedata)</span><br><span class="line">            <span class="built_in">print</span>(receive_msg.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">textThread = ThreadReceive()</span><br><span class="line">textThread.start()</span><br><span class="line"></span><br><span class="line"><span class="comment">#发送文字</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        send_msg = <span class="built_in">input</span>(<span class="string">&#x27;请输入：&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> send_msg==<span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        client.send((client_name+<span class="string">&#x27;: &#x27;</span>+send_msg).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">send()</span><br></pre></td></tr></table></figure>
<h3 id="代码05"><a class="markdownIt-Anchor" href="#代码05">#</a> <strong>代码 0.5</strong></h3>
<p><strong>作用：在 0.4 基础上加了时间戳，将 input 里的字符删了，直接输就行……</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/cheneykl/article/details/79717160">(29 条消息) Python 给某个文件名添加时间戳_cheney 康的博客 - CSDN 博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/drdairen/article/details/60962439">(29 条消息) python：threading.Thread 类的使用详解_啊啊啊西吧的博客 - CSDN 博客_python thread</a></p>
<p><a target="_blank" rel="noopener" href="https://www.yisu.com/zixun/720956.html">python 中的多线程锁 lock=threading.Lock () 如何使用 - 开发技术 - 亿速云 (yisu.com)</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mutex = threading.Lock()</span><br><span class="line">#锁的使用</span><br><span class="line">#创建锁</span><br><span class="line">mutex = threading.Lock()</span><br><span class="line">#锁定</span><br><span class="line">mutex.acquire([timeout])</span><br><span class="line">#释放</span><br><span class="line">mutex.release()</span><br></pre></td></tr></table></figure>
<p>发现没啥要修改的……</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务端import socket</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">host = socket.gethostname()  <span class="comment"># 获取本地主机名</span></span><br><span class="line">port = <span class="number">9999</span>  <span class="comment"># 设置端口</span></span><br><span class="line">max_connect = <span class="number">2</span>  <span class="comment"># 设置最大连接客户端数</span></span><br><span class="line">max_recedata = <span class="number">1024</span>  <span class="comment"># 设置最大接收字节数</span></span><br><span class="line"><span class="built_in">print</span>(host)</span><br><span class="line"></span><br><span class="line">server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  <span class="comment"># 创建socket对象</span></span><br><span class="line">server.bind((host, port))  <span class="comment"># 绑定端口号</span></span><br><span class="line">server.listen(max_connect)  <span class="comment"># 开始监听;最大连接2台客户端，超过后排队</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;ServerSocket is ready.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cnt = <span class="number">0</span>  <span class="comment"># 当前在线人数</span></span><br><span class="line">textList = []  <span class="comment"># 存储历史记录</span></span><br><span class="line">socketList = []  <span class="comment"># 存储已有客户端（套接字）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义类继承，重写run()方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadCreate</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, client</span>):</span>  <span class="comment"># 线程初始化</span></span><br><span class="line">        threading.Thread.__init__(self)  <span class="comment"># 当作Thread的固定结构吧……</span></span><br><span class="line">        self.client = client  <span class="comment"># 保存嵌套字（客户端）</span></span><br><span class="line">        socketList.append(client)  <span class="comment"># 把嵌套字存在列表里</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">global</span> cnt</span><br><span class="line">            <span class="keyword">for</span> sock <span class="keyword">in</span> socketList:</span><br><span class="line">                <span class="keyword">if</span> sock == self.client:</span><br><span class="line">                    sock.send((<span class="string">&#x27;Welcome!There are %d presons.&#x27;</span>%(cnt)).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    sock.send((<span class="string">&#x27;New Client is Coming.There are %d presons.&#x27;</span>%(cnt)).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                word = self.client.recv(max_recedata).decode() <span class="comment">#接收数据</span></span><br><span class="line">                textList.append(word) <span class="comment">#生成历史记录</span></span><br><span class="line">                <span class="keyword">for</span> sock <span class="keyword">in</span> socketList: <span class="comment">#给所有客户端发送新消息</span></span><br><span class="line">                    sock.send((<span class="string">&#x27;\n&#x27;</span>+word).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e: <span class="comment">#客户端强制断开连接（关闭窗口）</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">repr</span>(e)) <span class="comment">#如何加一个时间戳？</span></span><br><span class="line">            cnt = cnt-<span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Lose one person.There are %d persons.&#x27;</span>%(cnt))</span><br><span class="line">            socketList.remove(self.client) <span class="comment">#移除该客户端</span></span><br><span class="line">            <span class="keyword">for</span> sock <span class="keyword">in</span> socketList:</span><br><span class="line">                sock.send((<span class="string">&#x27;Lose one person.There are %d persons.&#x27;</span>%(cnt)).encode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    client, addr = server.accept()  <span class="comment"># 创建客户端连接，每次接收一个连接</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;连接地址：%s&quot;</span> % <span class="built_in">str</span>(addr))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 关于历史记录的处理</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(textList) == <span class="number">0</span>:</span><br><span class="line">            client.send(<span class="string">&#x27;No message.&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            client.send(<span class="string">&#x27;\n&#x27;</span>.join(textList).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        cnt = cnt + <span class="number">1</span>  <span class="comment"># 来了一个人加一</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 给用户创建新进程</span></span><br><span class="line">        newThread = ThreadCreate(client)</span><br><span class="line">        newThread.setDaemon(<span class="literal">True</span>)  <span class="comment"># 设置为守护线程</span></span><br><span class="line">        newThread.start()  <span class="comment"># 开启线程</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Connecting is successful!The number of people is &#x27;</span> + <span class="built_in">str</span>(cnt) + <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">repr</span>(e))</span><br><span class="line">    <span class="comment"># finally:</span></span><br><span class="line">    <span class="comment">#     client.close()</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#客户端</span></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">server_host = socket.gethostname() <span class="comment">#获取本地主机名</span></span><br><span class="line">server_port = <span class="number">9999</span> <span class="comment">#设置端口</span></span><br><span class="line">max_recedata = <span class="number">1024</span>  <span class="comment"># 设置最大接收字节数</span></span><br><span class="line">client_name = <span class="string">&#x27;Helen&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(server_host)</span><br><span class="line">lock = threading.Lock() <span class="comment">#创建锁</span></span><br><span class="line"></span><br><span class="line">client = socket.socket(socket.AF_INET,socket.SOCK_STREAM) <span class="comment">#创建socket对象</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Connecting......&#x27;</span>)</span><br><span class="line">client.connect((server_host,server_port)) <span class="comment">#连接服务端，指定主机和端口</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Connecting is successful!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">msg = client.recv(max_recedata) <span class="comment">#先接收历史消息</span></span><br><span class="line"><span class="keyword">if</span> msg.decode(<span class="string">&#x27;utf-8&#x27;</span>)!=<span class="string">&#x27;No message.&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(msg.decode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">&#x27;\n------以上是历史消息------\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#接收文字的线程</span></span><br><span class="line"><span class="comment">#由于用户的发送和接收消息是不同步的，在接收消息时线程会阻塞，所以另开启一个线程进行接收文字</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadReceive</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                receive_msg = client.recv(max_recedata)</span><br><span class="line">                <span class="built_in">print</span>(receive_msg.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">textThread = ThreadReceive()</span><br><span class="line">textThread.start()</span><br><span class="line"></span><br><span class="line"><span class="comment">#发送文字</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            send_msg = <span class="built_in">input</span>()</span><br><span class="line">            <span class="keyword">if</span> send_msg == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            client.send((client_name+<span class="string">&#x27;: &#x27;</span>+send_msg).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">send()</span><br></pre></td></tr></table></figure>
<h2 id="初级阶段3可视化"><a class="markdownIt-Anchor" href="#初级阶段3可视化">#</a> 初级阶段 3：可视化</h2>
<h3 id="代码06"><a class="markdownIt-Anchor" href="#代码06">#</a> <strong>代码 0.6</strong></h3>
<p><strong>作用：有问题，修理中…… 主要是服务器老炸了…… 可能是类的原因</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务端</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> wx</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getIP</span>():</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">    s.connect((<span class="string">&quot;8.8.8.8&quot;</span>, <span class="number">80</span>))</span><br><span class="line">    ip=s.getsockname()[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> ip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">host = getIP()  <span class="comment"># 获取本地主机名</span></span><br><span class="line">port = <span class="number">8000</span>  <span class="comment"># 设置端口</span></span><br><span class="line">max_connect = <span class="number">2</span>  <span class="comment"># 设置最大连接客户端数</span></span><br><span class="line">max_recedata = <span class="number">2048</span>  <span class="comment"># 设置最大接收字节数</span></span><br><span class="line"><span class="built_in">print</span>(host)</span><br><span class="line"></span><br><span class="line">cnt = <span class="number">0</span>  <span class="comment"># 当前在线人数</span></span><br><span class="line">textList = []  <span class="comment"># 存储历史记录</span></span><br><span class="line">socketList = []  <span class="comment"># 存储已有客户端（套接字）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义类继承，重写run()方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadCreate</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, client</span>):</span></span><br><span class="line">        <span class="comment"># 线程初始化</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        <span class="comment"># 当作Thread的固定结构吧……</span></span><br><span class="line">        self.client = client</span><br><span class="line">        <span class="comment"># 保存嵌套字（客户端）</span></span><br><span class="line">        socketList.append(client)</span><br><span class="line">        <span class="comment"># 把嵌套字存在列表里</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">global</span> cnt</span><br><span class="line">            <span class="keyword">for</span> sock <span class="keyword">in</span> socketList:</span><br><span class="line">                <span class="keyword">if</span> sock == self.client:</span><br><span class="line">                    sock.send((<span class="string">&#x27;Welcome!There are %d presons.&#x27;</span>%(cnt)).encode())</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    sock.send((<span class="string">&#x27;New Client is Coming.There are %d presons.&#x27;</span>%(cnt)).encode())</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                word = self.client.recv(max_recedata).decode() <span class="comment">#接收数据</span></span><br><span class="line">                textList.append(word)</span><br><span class="line">                <span class="comment"># 生成历史记录</span></span><br><span class="line">                <span class="keyword">for</span> sock <span class="keyword">in</span> socketList:</span><br><span class="line">                    <span class="comment"># 给所有客户端发送新消息</span></span><br><span class="line">                    sock.send((<span class="string">&#x27;\n&#x27;</span>+word).encode())</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># 客户端强制断开连接（关闭窗口）</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">repr</span>(e)) <span class="comment"># 如何加一个时间戳？</span></span><br><span class="line">            cnt = cnt-<span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Lose one person.There are %d persons.&#x27;</span>%(cnt))</span><br><span class="line">            socketList.remove(self.client) <span class="comment"># 移除该客户端</span></span><br><span class="line">            <span class="keyword">for</span> sock <span class="keyword">in</span> socketList:</span><br><span class="line">                sock.send((<span class="string">&#x27;Lose one person.There are %d persons.&#x27;</span>%(cnt)).encode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Frame</span>(<span class="params">wx.Frame</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        wx.Frame.__init__(self, <span class="literal">None</span>, title=<span class="string">&#x27;多人聊天系统（服务器）&#x27;</span>, size=(<span class="number">400</span>, <span class="number">300</span>),name=<span class="string">&#x27;frame&#x27;</span>,style=<span class="number">541072960</span>)</span><br><span class="line">        self.qdck = wx.Panel(self)</span><br><span class="line">        self.qdck.SetOwnBackgroundColour((<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line">        self.Centre()</span><br><span class="line">        self.an1 = wx.Button(self.qdck,size=(<span class="number">120</span>, <span class="number">40</span>),pos=(<span class="number">44</span>, <span class="number">160</span>),label=<span class="string">&#x27;启动客户端&#x27;</span>,name=<span class="string">&#x27;button&#x27;</span>)</span><br><span class="line">        self.an1.SetAuthNeeded(<span class="literal">True</span>)</span><br><span class="line">        self.an1.Bind(wx.EVT_BUTTON,self.an1_anbdj)</span><br><span class="line">        self.an2 = wx.Button(self.qdck,size=(<span class="number">120</span>, <span class="number">40</span>),pos=(<span class="number">227</span>, <span class="number">160</span>),label=<span class="string">&#x27;关闭客户端&#x27;</span>,name=<span class="string">&#x27;button&#x27;</span>)</span><br><span class="line">        self.an2.SetAuthNeeded(<span class="literal">True</span>)</span><br><span class="line">        self.an2.Bind(wx.EVT_BUTTON,self.an2_anbdj)</span><br><span class="line">        self.bq1 = wx.StaticText(self.qdck,size=(<span class="number">240</span>, <span class="number">40</span>),pos=(<span class="number">80</span>, <span class="number">35</span>),label=<span class="string">&#x27;多人聊天系统客户端&#x27;</span>,name=<span class="string">&#x27;staticText&#x27;</span>,style=<span class="number">2321</span>)</span><br><span class="line">        bq1_字体 = wx.Font(<span class="number">16</span>,<span class="number">70</span>,<span class="number">90</span>,<span class="number">400</span>,<span class="literal">False</span>,<span class="string">&#x27;Microsoft YaHei UI&#x27;</span>,-<span class="number">1</span>)</span><br><span class="line">        self.bq1.SetFont(bq1_字体)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">an1_anbdj</span>(<span class="params">self,event</span>):</span></span><br><span class="line">        <span class="comment"># print(&#x27;an1,按钮被单击&#x27;)</span></span><br><span class="line">        server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  <span class="comment"># 创建socket对象</span></span><br><span class="line">        server.bind((host, port))  <span class="comment"># 绑定端口号</span></span><br><span class="line">        server.listen(max_connect)  <span class="comment"># 开始监听;最大连接2台客户端，超过后排队</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ServerSocket is ready.&#x27;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            client, addr = server.accept()  <span class="comment"># 创建客户端连接，每次接收一个连接</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;连接地址：%s&quot;</span> % <span class="built_in">str</span>(addr))</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">global</span> cnt</span><br><span class="line">                <span class="comment"># 关于历史记录的处理</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(textList) == <span class="number">0</span>:</span><br><span class="line">                    client.send(<span class="string">&#x27;No message.&#x27;</span>.encode())</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    client.send(<span class="string">&#x27;\n&#x27;</span>.join(textList).encode())</span><br><span class="line"></span><br><span class="line">                cnt = cnt + <span class="number">1</span>  <span class="comment"># 来了一个人加一</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 给用户创建新进程</span></span><br><span class="line">                newThread = ThreadCreate(client)</span><br><span class="line">                newThread.setDaemon(<span class="literal">True</span>)  <span class="comment"># 设置为守护线程</span></span><br><span class="line">                newThread.start()  <span class="comment"># 开启线程</span></span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;Connecting is successful!The number of people is &#x27;</span> + <span class="built_in">str</span>(cnt) + <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">repr</span>(e))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">an2_anbdj</span>(<span class="params">self,event</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;an2,按钮被单击&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myApp</span>(<span class="params">wx.App</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnInit</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.frame = Frame()</span><br><span class="line">        self.frame.Show(<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app = myApp()</span><br><span class="line">    app.MainLoop()</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> wx</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep, localtime</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">server_host = socket.gethostname()</span><br><span class="line"><span class="comment"># 获取本地主机名</span></span><br><span class="line">server_port = <span class="number">8000</span></span><br><span class="line"><span class="comment"># 设置端口</span></span><br><span class="line">max_recedata = <span class="number">2048</span></span><br><span class="line"><span class="comment"># 设置最大接收字节数</span></span><br><span class="line">client_name = socket.gethostname()</span><br><span class="line"><span class="built_in">print</span>(server_host)</span><br><span class="line">lock = threading.Lock()</span><br><span class="line"><span class="comment"># 创建锁</span></span><br><span class="line">host_ip = <span class="string">&#x27;&#x27;</span></span><br><span class="line">client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  <span class="comment"># 创建socket对象</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">chuangkou</span>(<span class="params">wx.Frame</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.liaotian = <span class="number">0</span></span><br><span class="line">        <span class="comment"># 判断是否取过消息记录</span></span><br><span class="line">        <span class="built_in">super</span>(chuangkou, self).__init__(<span class="literal">None</span>, -<span class="number">1</span>, title=<span class="string">&quot;多人聊天程序&quot;</span>, size=(<span class="number">600</span>, <span class="number">600</span>))</span><br><span class="line">        self.a = wx.Panel(self)</span><br><span class="line">        <span class="comment"># 创建一个画板</span></span><br><span class="line">        self.ip=wx.TextCtrl(self.a,style=wx.TE_PROCESS_ENTER ,value=<span class="string">&quot;请输入服务器的ip地址&quot;</span>)</span><br><span class="line">        <span class="comment"># 创建一个输入服务器ip地址的输入框</span></span><br><span class="line">        self.b = wx.Button(self.a, wx.ID_ANY, <span class="string">&quot;确定&quot;</span>)</span><br><span class="line">        self.b.SetAuthNeeded(<span class="literal">True</span>)</span><br><span class="line">        self.b.Bind(wx.EVT_BUTTON, self.b_anbdj)</span><br><span class="line">        <span class="comment"># 创建一个聊天创建的输入框</span></span><br><span class="line">        self.text = wx.TextCtrl(self.a,</span><br><span class="line">                             style=wx.TE_READONLY | wx.TE_MULTILINE | wx.TE_RICH2 | wx.BORDER_SIMPLE | wx.HSCROLL)</span><br><span class="line">        self.text.SetBackgroundColour(<span class="string">&#x27;#d1d1d1&#x27;</span>)  <span class="comment"># 颜色改变为灰</span></span><br><span class="line">        self.ctrl = wx.TextCtrl(self.a, style=wx.TE_PROCESS_ENTER | wx.TE_MULTILINE,value=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="comment"># 创建一个输入发送聊天内容的输入框</span></span><br><span class="line">        self.sent = wx.Button(self.a, wx.ID_ANY, <span class="string">&quot;发送&quot;</span>)</span><br><span class="line">        self.sent.SetAuthNeeded(<span class="literal">True</span>)</span><br><span class="line">        self.sent.Bind(wx.EVT_BUTTON, self.sent_anbdj)</span><br><span class="line">        box = wx.BoxSizer(wx.HORIZONTAL)  <span class="comment"># 创建一个垂直布局</span></span><br><span class="line">        box1 = wx.BoxSizer(wx.VERTICAL)  <span class="comment"># 创建一个平行布局</span></span><br><span class="line">        box1.Add(self.ip,proportion=<span class="number">3</span>, flag=wx.EXPAND|wx.TOP,border=<span class="number">0</span>)</span><br><span class="line">        <span class="comment"># 输入ip地址的输入框的布局</span></span><br><span class="line">        box1.Add(self.b, proportion=<span class="number">1</span>, flag=wx.EXPAND | wx.TOP, border=<span class="number">0</span>)</span><br><span class="line">        <span class="comment"># 查看聊天记录按钮的布局</span></span><br><span class="line">        box1.Add(self.text, proportion=<span class="number">30</span>, flag=wx.EXPAND | wx.TOP, border=<span class="number">0</span>)</span><br><span class="line">        <span class="comment"># 接收输入框的布局</span></span><br><span class="line">        box1.Add(self.ctrl, proportion=<span class="number">20</span>, flag=wx.EXPAND | wx.TOP, border=<span class="number">0</span>)</span><br><span class="line">        <span class="comment"># 发送的输入框的布局</span></span><br><span class="line">        box1.Add(self.sent, proportion=<span class="number">3</span>, flag=wx.EXPAND | wx.TOP, border=<span class="number">0</span>)</span><br><span class="line">        self.a.SetSizer(box1)  <span class="comment"># 布局设置在a画板上</span></span><br><span class="line">        self.msg=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">b_anbdj</span>(<span class="params">self,event</span>):</span></span><br><span class="line">        <span class="keyword">global</span> msg</span><br><span class="line">        host_ip=self.ip.GetValue()</span><br><span class="line">        toastone = wx.MessageDialog(<span class="literal">None</span>, <span class="string">&quot;链接的服务器地址为&quot;</span>+host_ip, <span class="string">&quot;信息提示&quot;</span>, wx.YES_DEFAULT | wx.ICON_QUESTION)</span><br><span class="line">        <span class="keyword">if</span> toastone.ShowModal() == wx.ID_YES:</span><br><span class="line">            <span class="comment"># 如果点击了提示框的确定按钮</span></span><br><span class="line">            toastone.Destroy()</span><br><span class="line">            <span class="comment"># 则关闭提示框</span></span><br><span class="line">        client.connect((host_ip, server_port))  <span class="comment"># 连接服务端，指定主机和端口</span></span><br><span class="line">        toastone = wx.MessageDialog(<span class="literal">None</span>, <span class="string">&quot;Connecting is successful!&quot;</span>, <span class="string">&quot;信息提示&quot;</span>, wx.YES_DEFAULT | wx.ICON_QUESTION)</span><br><span class="line">        <span class="keyword">if</span> toastone.ShowModal() == wx.ID_YES:</span><br><span class="line">            <span class="comment"># 如果点击了提示框的确定按钮</span></span><br><span class="line">            toastone.Destroy()</span><br><span class="line">            <span class="comment"># 则关闭提示框</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sent_anbdj</span>(<span class="params">self,event</span>):</span></span><br><span class="line">        send_msg = self.ctrl.GetValue()</span><br><span class="line">        client.send((client_name + <span class="string">&#x27;: &#x27;</span> + send_msg).encode())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 接收文字的线程</span></span><br><span class="line">    <span class="comment"># 由于用户的发送和接收消息是不同步的，在接收消息时线程会阻塞，所以另开启一个线程进行接收文字</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ThreadReceive</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            self.msg = client.recv(max_recedata)</span><br><span class="line">            self.text.AppendText(self.msg.decode() + <span class="string">&quot;\n\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app = wx.App()  <span class="comment"># 初始化</span></span><br><span class="line">    shili = chuangkou()  <span class="comment"># 创建实例</span></span><br><span class="line">    shili.Show()  <span class="comment"># 显示窗口</span></span><br><span class="line">    app.MainLoop()  <span class="comment"># 窗口主循环</span></span><br></pre></td></tr></table></figure>
<h2 id="初级阶段4线程改版tkinter使用"><a class="markdownIt-Anchor" href="#初级阶段4线程改版tkinter使用">#</a> 初级阶段 4：线程改版 + tkinter 使用</h2>
<h3 id="05"><a class="markdownIt-Anchor" href="#05">#</a> <strong>0.5</strong></h3>
<p><strong>作用：换了个线程控制方式</strong></p>
<blockquote>
<p>变化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server.listen() #监听</span><br><span class="line">server = socket.socket() #创建server对象</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务器端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">host = socket.gethostname() <span class="comment">#获取当前主机的IP地址</span></span><br><span class="line">port = <span class="number">8000</span> <span class="comment">#设置防火墙开放端口</span></span><br><span class="line">SocketList = [] <span class="comment">#存储客户端套接字的列表</span></span><br><span class="line">TextList = [] <span class="comment">#存储聊天记录</span></span><br><span class="line">cnt = <span class="number">0</span> <span class="comment">#当前客户端人数</span></span><br><span class="line"><span class="built_in">print</span>(host)</span><br><span class="line"></span><br><span class="line">server = socket.socket() <span class="comment">#创建server对象</span></span><br><span class="line">server.bind((host,port)) <span class="comment">#绑定</span></span><br><span class="line">server.listen() <span class="comment">#监听</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;服务器准备就绪！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#接收一个客户端连接，及其发送来数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_client</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment">#接受客户端发送来的数据</span></span><br><span class="line">        <span class="keyword">return</span> s.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment">#客户端异常，连接失败，则删除该socket</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(addr)+<span class="string">&#x27;已下线！&#x27;</span>)</span><br><span class="line">        SocketList.remove(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">#多线程：将收到的消息发送给所有客户端</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_client</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            content = read_client(s) <span class="comment">#客户端消息</span></span><br><span class="line">            <span class="keyword">if</span> content <span class="keyword">is</span> <span class="literal">None</span>: <span class="comment">#如果没有结束循环</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>: <span class="comment">#如果有将消息保存到历史记录</span></span><br><span class="line">                TextList.append(<span class="built_in">str</span>(addr)+<span class="string">&#x27;: &#x27;</span>+content)</span><br><span class="line">            <span class="comment">#将一个客户端发送过来的数据广播给其他客户端</span></span><br><span class="line">            <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">                sock.send((<span class="built_in">str</span>(addr)+<span class="string">&#x27;: &#x27;</span>+content).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;广播未成功！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    client,addr = server.accept()</span><br><span class="line">    SocketList.append(client)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(addr)+<span class="string">&#x27;已加入！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment">#历史消息生成</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(TextList)==<span class="number">0</span>:</span><br><span class="line">            client.send(<span class="string">&#x27;No message.&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            client.send(<span class="string">&#x27;\n&#x27;</span>.join(TextList).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        cnt = cnt + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#每当有客户连接后，就启动一个线程为其服务</span></span><br><span class="line">        threading.Thread(target=send_client, args=(client,)).start()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">repr</span>(e))</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#客户端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">server_host = socket.gethostname()</span><br><span class="line">server_port = <span class="number">8000</span></span><br><span class="line"></span><br><span class="line">client = socket.socket() <span class="comment">#创建socket对象</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Connecting......&#x27;</span>)</span><br><span class="line">client.connect((server_host,server_port)) <span class="comment">#连接服务端，指定主机和端口</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Connecting is successful!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">content = client.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> content != <span class="string">&#x27;No message.&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(content + <span class="string">&#x27;\n------以上是历史消息------\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_server</span>(<span class="params">c</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment">#子线程负责从服务端接受数据并打印</span></span><br><span class="line">        content = c.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(content)</span><br><span class="line">threading.Thread(target=read_server, args=(client,)).start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    word = <span class="built_in">input</span>()</span><br><span class="line">    <span class="keyword">if</span> word == <span class="string">&#x27;close&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># 主线程负责将用户输入的数据发送到socket中</span></span><br><span class="line">    client.send(word.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h3 id="06"><a class="markdownIt-Anchor" href="#06">#</a> <strong>0.6</strong></h3>
<p><strong>作用：0.5 基础上优化（nickname）+ 进行图形界面可视化；</strong></p>
<blockquote>
<p>Python 提供了多个图形开发界面的库，几个常用 Python GUI 库如下：</p>
<ul>
<li><strong>Tkinter：</strong> Tkinter 模块 (Tk 接口) 是 Python 的标准 Tk GUI 工具包的接口 .Tk 和 Tkinter 可以在大多数的 Unix 平台下使用，同样可以应用在 Windows 和 Macintosh 系统里。Tk8.0 的后续版本可以实现本地窗口风格，并良好地运行在绝大多数平台中。</li>
</ul>
<p><strong>注意</strong> *：Python3.x 版本使用的库名为 tkinter, 即首写字母 T 为小写 *</p>
<p>创建一个 GUI 程序</p>
<ul>
<li>1、导入 Tkinter 模块</li>
<li>2、创建控件</li>
<li>3、指定这个控件的 master， 即这个控件属于哪一个</li>
<li>4、告诉 GM (geometry manager) 有一个控件产生了。</li>
</ul>
</blockquote>
<blockquote>
<p>[Python GUI 编程 (Tkinter) | 菜鸟教程 (<a target="_blank" rel="noopener" href="http://runoob.com">runoob.com</a>)](<a target="_blank" rel="noopener" href="https://www.runoob.com/python/python-gui-tkinter.html#:~:text=Tkinter">https://www.runoob.com/python/python-gui-tkinter.html#:~:text=Tkinter</a> 是 Python 的标准 GUI 库。 Python 使用，Tkinter 库、而且 IDLE 也是用 Tkinter 编写而成、对于简单的图形界面 Tkinter 还是能应付自如。)</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Eider1998/article/details/104725180">(29 条消息) TK-StringVar_Eider1998 的博客 - CSDN 博客_stringvar () 作用</a></p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/python/python-tk-frame.html">Python Tkinter 框架控件（Frame） | 菜鸟教程 (runoob.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Bugest/article/details/81557112">(29 条消息) python 弹窗 ——tkinter.messagebox 学习总结_鹿鹿有为啊的博客 - CSDN 博客_python tkinter 弹窗</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zmzzm/p/11973217.html">tkinter 的 set () 与 get () - 做梦者造梦 - 博客园 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46018418/article/details/105927203">(29 条消息) tkinter 库最全使用教程_千禧皓月的博客 - CSDN 博客_tkinter</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/superfanstoprogram/article/details/83713196">(29 条消息) 用 tkinter.pack 设计复杂界面布局_快乐清风客的博客 - CSDN 博客_tkinter 复杂界面</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">host = socket.gethostname() <span class="comment">#获取当前主机的IP地址</span></span><br><span class="line">port = <span class="number">8000</span> <span class="comment">#设置防火墙开放端口</span></span><br><span class="line">SocketList = [] <span class="comment">#存储客户端套接字的列表</span></span><br><span class="line">TextList = [] <span class="comment">#存储聊天记录</span></span><br><span class="line">Nickname = [] <span class="comment">#存储用户呢称</span></span><br><span class="line">cnt = <span class="number">0</span> <span class="comment">#当前客户端人数</span></span><br><span class="line"><span class="built_in">print</span>(host)</span><br><span class="line"></span><br><span class="line">server = socket.socket() <span class="comment">#创建server对象</span></span><br><span class="line">server.bind((host,port)) <span class="comment">#绑定</span></span><br><span class="line">server.listen() <span class="comment">#监听</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;服务器准备就绪！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#接收一个客户端连接，及其发送来数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_client</span>(<span class="params">s,nickname</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment">#接受客户端发送来的数据</span></span><br><span class="line">        <span class="keyword">return</span> s.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment">#客户端异常，连接失败，则删除该socket</span></span><br><span class="line">        <span class="comment"># print(str(addr)+&#x27;已下线！&#x27;)</span></span><br><span class="line">        <span class="built_in">print</span>(nickname + <span class="string">&#x27;已下线！&#x27;</span>)</span><br><span class="line">        SocketList.remove(s)</span><br><span class="line">        Nickname.remove(nickname)</span><br><span class="line">        <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">            sock.send((<span class="string">&#x27;系统消息：&#x27;</span> + nickname + <span class="string">&#x27;已下线！&#x27;</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#多线程：将收到的消息发送给所有客户端</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_client</span>(<span class="params">s,nickname</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s.send((<span class="string">&#x27;,&#x27;</span>.join(Nickname)).encode(<span class="string">&#x27;utf-8&#x27;</span>)) <span class="comment">#将用户列表发送给各客户端</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            content = read_client(s) <span class="comment">#客户端消息</span></span><br><span class="line">            <span class="keyword">if</span> content <span class="keyword">is</span> <span class="literal">None</span>: <span class="comment">#如果没有结束循环</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>: <span class="comment">#如果有将消息保存到历史记录</span></span><br><span class="line">                <span class="comment"># TextList.append(str(addr)+&#x27;: &#x27;+content)</span></span><br><span class="line">                TextList.append(nickname + <span class="string">&#x27;: &#x27;</span> + content)</span><br><span class="line">            <span class="comment">#将一个客户端发送过来的数据广播给其他客户端</span></span><br><span class="line">            <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">                <span class="comment"># sock.send((str(addr)+&#x27;: &#x27;+content).encode(&#x27;utf-8&#x27;))</span></span><br><span class="line">                sock.send((nickname + <span class="string">&#x27;: &#x27;</span> + content).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;广播未成功！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    client,addr = server.accept()</span><br><span class="line">    SocketList.append(client)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        nickname = client.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="comment"># print(str(addr)+&#x27;已加入！&#x27;)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> nickname <span class="keyword">in</span> Nickname:</span><br><span class="line">            i = <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                <span class="keyword">if</span> nickname+<span class="built_in">str</span>(i) <span class="keyword">in</span> Nickname:</span><br><span class="line">                    i = i+<span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    nickname = nickname + <span class="built_in">str</span>(i)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        Nickname.append(nickname)</span><br><span class="line">        <span class="built_in">print</span>(nickname + <span class="string">&#x27;已加入！&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">            sock.send((<span class="string">&#x27;系统消息：&#x27;</span> + nickname + <span class="string">&#x27;已加入！&#x27;</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment">#历史消息生成</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(TextList)==<span class="number">0</span>:</span><br><span class="line">            client.send(<span class="string">&#x27;No message.&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            client.send(<span class="string">&#x27;\n&#x27;</span>.join(TextList).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        cnt = cnt + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#每当有客户连接后，就启动一个线程为其服务</span></span><br><span class="line">        <span class="comment">#加入线程中跑，加入函数为send_client，参数为client,nickname</span></span><br><span class="line">        threading.Thread(target=send_client, args=(client,nickname,)).start()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">repr</span>(e))</span><br></pre></td></tr></table></figure>
<h3 id="065"><a class="markdownIt-Anchor" href="#065">#</a> <strong>0.65</strong></h3>
<p><strong>作用：0.6 基础上的修改（显示在线人数和历史消息暂时删了，仅保留了聊天功能），先能用…… 还要解决子线程如何关闭的问题……</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">host = socket.gethostname() <span class="comment">#获取当前主机的IP地址</span></span><br><span class="line">port = <span class="number">9999</span> <span class="comment">#设置防火墙开放端口</span></span><br><span class="line">SocketList = [] <span class="comment">#存储客户端套接字的列表</span></span><br><span class="line">TextList = [] <span class="comment">#存储聊天记录</span></span><br><span class="line">Nickname = [] <span class="comment">#存储用户呢称</span></span><br><span class="line">cnt = <span class="number">0</span> <span class="comment">#当前客户端人数</span></span><br><span class="line"><span class="built_in">print</span>(host)</span><br><span class="line"></span><br><span class="line">server = socket.socket() <span class="comment">#创建server对象</span></span><br><span class="line">server.bind((host,port)) <span class="comment">#绑定</span></span><br><span class="line">server.listen() <span class="comment">#监听</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;服务器准备就绪！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#接收一个客户端连接，及其发送来数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_client</span>(<span class="params">s,nickname</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment">#接受客户端发送来的数据</span></span><br><span class="line">        <span class="keyword">return</span> s.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment">#客户端异常，连接失败，则删除该socket</span></span><br><span class="line">        <span class="comment"># print(str(addr)+&#x27;已下线！&#x27;)</span></span><br><span class="line">        <span class="built_in">print</span>(nickname + <span class="string">&#x27;已下线！&#x27;</span>)</span><br><span class="line">        SocketList.remove(s)</span><br><span class="line">        Nickname.remove(nickname)</span><br><span class="line">        <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">            sock.send((<span class="string">&#x27;系统消息：&#x27;</span> + nickname + <span class="string">&#x27;已下线！&#x27;</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#多线程：将收到的消息发送给所有客户端</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_client</span>(<span class="params">s,nickname</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># s.send((&#x27;,&#x27;.join(Nickname)).encode(&#x27;utf-8&#x27;)) #将用户列表发送给各客户端</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            content = read_client(s,nickname) <span class="comment">#客户端消息</span></span><br><span class="line">            <span class="keyword">if</span> content <span class="keyword">is</span> <span class="literal">None</span>: <span class="comment">#如果没有结束循环</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>: <span class="comment">#如果有将消息保存到历史记录</span></span><br><span class="line">                <span class="comment"># TextList.append(str(addr)+&#x27;: &#x27;+content)</span></span><br><span class="line">                TextList.append(nickname + <span class="string">&#x27;: &#x27;</span> + content)</span><br><span class="line">            <span class="comment">#将一个客户端发送过来的数据广播给其他客户端</span></span><br><span class="line">            <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">                <span class="comment"># sock.send((str(addr)+&#x27;: &#x27;+content).encode(&#x27;utf-8&#x27;))</span></span><br><span class="line">                sock.send((nickname + <span class="string">&#x27;: &#x27;</span> + content).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(repr())</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;广播未成功！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    client,addr = server.accept()</span><br><span class="line">    SocketList.append(client)</span><br><span class="line"></span><br><span class="line">    nickname = client.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="comment"># print(str(addr)+&#x27;已加入！&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> nickname <span class="keyword">in</span> Nickname:</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> nickname+<span class="built_in">str</span>(i) <span class="keyword">in</span> Nickname:</span><br><span class="line">                i = i+<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                nickname = nickname + <span class="built_in">str</span>(i)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    Nickname.append(nickname)</span><br><span class="line">    <span class="built_in">print</span>(nickname + <span class="string">&#x27;已加入！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">        sock.send((<span class="string">&#x27;系统消息：&#x27;</span> + nickname + <span class="string">&#x27;已加入！&#x27;</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># #历史消息生成</span></span><br><span class="line">    <span class="comment"># if len(TextList)==0:</span></span><br><span class="line">    <span class="comment">#     client.send(&#x27;No message.&#x27;.encode(&#x27;utf-8&#x27;))</span></span><br><span class="line">    <span class="comment"># else:</span></span><br><span class="line">    <span class="comment">#     client.send(&#x27;\n&#x27;.join(TextList).encode(&#x27;utf-8&#x27;))</span></span><br><span class="line"></span><br><span class="line">    cnt = cnt + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#每当有客户连接后，就启动一个线程为其服务</span></span><br><span class="line">    <span class="comment">#加入线程中跑，加入函数为send_client，参数为client,nickname</span></span><br><span class="line">    threading.Thread(target=send_client, args=(client,nickname,)).start()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#客户端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> tkinter.messagebox <span class="comment">#弹窗库</span></span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> scrolledtext  <span class="comment">#滚动文本框</span></span><br><span class="line"></span><br><span class="line">server_host = socket.gethostname()</span><br><span class="line">server_port = <span class="number">9999</span></span><br><span class="line"></span><br><span class="line">client = socket.socket() <span class="comment">#创建socket对象</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Connecting......&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#登入窗口：输入呢称</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LoginWindow</span>():</span></span><br><span class="line">    root = Tk()</span><br><span class="line">    root.title(<span class="string">&#x27;一起来聊天 · 登录&#x27;</span>) <span class="comment">#窗口标题</span></span><br><span class="line">    root.geometry(<span class="string">&#x27;300x150&#x27;</span>) <span class="comment">#窗口大小</span></span><br><span class="line">    root.geometry(<span class="string">&#x27;+500+300&#x27;</span>) <span class="comment">#改变窗体位置（‘+横坐标+纵坐标’）</span></span><br><span class="line">    nickname = StringVar() <span class="comment">#昵称变量（对象）:在使用界面编程的时候，有些时候是需要跟踪变量的值的变化，以保证值的变更随时可以显示在界面上</span></span><br><span class="line">    root.resizable(<span class="number">0</span>, <span class="number">0</span>) <span class="comment">#将窗口大小设置为不可变</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#登录函数（检查用户名是否为空，以及长度）</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Login_in</span>():</span></span><br><span class="line">        name = nickname.get() <span class="comment">#????</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> name:</span><br><span class="line">            tkinter.messagebox.showwarning(<span class="string">&#x27;Warning&#x27;</span>, message=<span class="string">&#x27;用户名为空！&#x27;</span>) <span class="comment">#消息警告框</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">len</span>(name) &gt; <span class="number">10</span>:</span><br><span class="line">            tkinter.messagebox.showwarning(<span class="string">&#x27;Warning&#x27;</span>, message=<span class="string">&#x27;用户名过长！最多为十个字符！&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            root.destroy()</span><br><span class="line">            client.connect((server_host, server_port))  <span class="comment"># 连接服务端，指定主机和端口</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Connecting is successful!&#x27;</span>)</span><br><span class="line">            client.send(name.encode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># 传递用户昵称</span></span><br><span class="line">            ChatRoom(name)  <span class="comment"># 打开聊天窗口</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#登录按钮、输入提示标签、输入框</span></span><br><span class="line">    Button(root, text=<span class="string">&quot;登录&quot;</span>, command=Login_in, width=<span class="number">8</span>, height=<span class="number">1</span>).place(x=<span class="number">100</span>, y=<span class="number">90</span>, width=<span class="number">100</span>, height=<span class="number">35</span>)</span><br><span class="line">    Label(root, text=<span class="string">&#x27;请输入昵称&#x27;</span>, font=(<span class="string">&#x27;Fangsong&#x27;</span>, <span class="number">12</span>)).place(x=<span class="number">10</span>, y=<span class="number">20</span>, height=<span class="number">50</span>, width=<span class="number">80</span>)</span><br><span class="line">    Entry(root, textvariable=nickname, font=(<span class="string">&#x27;Fangsong&#x27;</span>, <span class="number">11</span>)).place(x=<span class="number">100</span>, y=<span class="number">30</span>, height=<span class="number">30</span>, width=<span class="number">180</span>)</span><br><span class="line"></span><br><span class="line">    root.mainloop()</span><br><span class="line"></span><br><span class="line"><span class="comment">#聊天窗口</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ChatRoom</span>(<span class="params">nickname</span>):</span></span><br><span class="line">    root = Tk()</span><br><span class="line">    root.geometry(<span class="string">&#x27;650x400&#x27;</span>)  <span class="comment"># 窗口大小</span></span><br><span class="line">    root.resizable(<span class="number">0</span>, <span class="number">0</span>)  <span class="comment"># 将窗口大小设置为不可变</span></span><br><span class="line">    root.geometry(<span class="string">&#x27;+500+300&#x27;</span>)  <span class="comment"># 改变窗体位置（‘+横坐标+纵坐标’）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># content = client.recv(2048).decode(&#x27;utf-8&#x27;)</span></span><br><span class="line">    <span class="comment"># if content != &#x27;No message.&#x27;:</span></span><br><span class="line">    <span class="comment">#     past_text = content + &#x27;\n------以上是历史消息------\n&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 从服务器端获取当前用户列表</span></span><br><span class="line">    <span class="comment"># UserList = []</span></span><br><span class="line">    <span class="comment"># UserList = client.recv(2048).decode(&#x27;utf-8&#x27;).split(&#x27;,&#x27;)</span></span><br><span class="line">    <span class="comment"># UserList.insert(0, &#x27;------当前用户列表------&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 窗口标题</span></span><br><span class="line">    <span class="comment"># nickname = UserList[len(UserList)-1]</span></span><br><span class="line">    root.title(<span class="string">&#x27;一起来聊天 · &#x27;</span> + nickname)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># name_text = StringVar()</span></span><br><span class="line">    <span class="comment"># name_text.set(UserList)  # 用户列表文本设置</span></span><br><span class="line">    <span class="comment"># listbox1 = Listbox(root, listvariable=name_text)  # 用户列表，使用Listbox组件</span></span><br><span class="line">    <span class="comment"># listbox1.place(x=5, y=0, width=500, height=400)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#聊天界面</span></span><br><span class="line">    content = client.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    ChatBox = scrolledtext.ScrolledText(root)  <span class="comment"># 聊天信息窗口，使用ScrolledText组件制作</span></span><br><span class="line">    ChatBox.place(x=<span class="number">5</span>, y=<span class="number">0</span>, width=<span class="number">500</span>, height=<span class="number">300</span>)</span><br><span class="line">    <span class="comment"># ChatBox.pack()</span></span><br><span class="line">    ChatBox.insert(<span class="string">&#x27;end&#x27;</span>,content)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_server</span>(<span class="params">c</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            content = c.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            ChatBox.insert(<span class="string">&#x27;end&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>+content+<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">            ChatBox.see(tkinter.END)  <span class="comment"># ScrolledText组件方法，自动定位到结尾，否则只有消息在涨，窗口拖动条不动</span></span><br><span class="line">            ChatBox.update()  <span class="comment"># 更新聊天信息窗口，显示新的信息</span></span><br><span class="line">    threading.Thread(target=read_server, args=(client,)).start()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#聊天输入框</span></span><br><span class="line">    word = StringVar()</span><br><span class="line">    word.<span class="built_in">set</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    SentBox = Entry(root,width=<span class="number">140</span>,textvariable=word) <span class="comment">#建一个输入框</span></span><br><span class="line">    SentBox.place(x=<span class="number">5</span>,y=<span class="number">305</span>,width=<span class="number">600</span>,height=<span class="number">95</span>) <span class="comment">#设置大小和位置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#发送按钮</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sendtext</span>():</span></span><br><span class="line">        content = word.get() <span class="comment">#获得文本内容</span></span><br><span class="line">        <span class="keyword">if</span> content==<span class="string">&#x27;end&#x27;</span>:</span><br><span class="line">            client.close()</span><br><span class="line">        client.send(content.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        word.<span class="built_in">set</span>(<span class="string">&#x27;&#x27;</span>) <span class="comment">#用了一个标记记录点击的状态，不管内容是什么点了就变</span></span><br><span class="line"></span><br><span class="line">    sendButton = Button(root, text=<span class="string">&#x27;发 送&#x27;</span>, font=(<span class="string">&#x27;Fangsong&#x27;</span>, <span class="number">18</span>), bg=<span class="string">&#x27;white&#x27;</span>, command=sendtext)</span><br><span class="line">    sendButton.place(x=<span class="number">500</span>, y=<span class="number">305</span>, width=<span class="number">150</span>, height=<span class="number">95</span>)</span><br><span class="line"></span><br><span class="line">    root.mainloop()</span><br><span class="line"></span><br><span class="line">LoginWindow()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="067"><a class="markdownIt-Anchor" href="#067">#</a> <strong>0.67</strong></h3>
<p><strong>作用：0.65 上改了点细节（可视化界面加了个图片），先能用…… 要解决子线程关闭问题</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务器</span></span><br><span class="line"><span class="comment">#服务端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">host = socket.gethostname() <span class="comment">#获取当前主机的IP地址</span></span><br><span class="line">port = <span class="number">9999</span> <span class="comment">#设置防火墙开放端口</span></span><br><span class="line">SocketList = [] <span class="comment">#存储客户端套接字的列表</span></span><br><span class="line">TextList = [] <span class="comment">#存储聊天记录</span></span><br><span class="line">Nickname = [] <span class="comment">#存储用户呢称</span></span><br><span class="line">cnt = <span class="number">0</span> <span class="comment">#当前客户端人数</span></span><br><span class="line"><span class="built_in">print</span>(host)</span><br><span class="line"></span><br><span class="line">server = socket.socket() <span class="comment">#创建server对象</span></span><br><span class="line">server.bind((host,port)) <span class="comment">#绑定</span></span><br><span class="line">server.listen() <span class="comment">#监听</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;服务器准备就绪！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#接收一个客户端连接，及其发送来数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_client</span>(<span class="params">s,nickname</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment">#接受客户端发送来的数据</span></span><br><span class="line">        <span class="keyword">return</span> s.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment">#客户端异常，连接失败，则删除该socket</span></span><br><span class="line">        <span class="comment"># print(str(addr)+&#x27;已下线！&#x27;)</span></span><br><span class="line">        <span class="built_in">print</span>(nickname + <span class="string">&#x27;已下线！&#x27;</span>)</span><br><span class="line">        SocketList.remove(s)</span><br><span class="line">        Nickname.remove(nickname)</span><br><span class="line">        <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">            sock.send((<span class="string">&#x27;系统消息：&#x27;</span> + nickname + <span class="string">&#x27;已下线！&#x27;</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#多线程：将收到的消息发送给所有客户端</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_client</span>(<span class="params">s,nickname</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># s.send((&#x27;,&#x27;.join(Nickname)).encode(&#x27;utf-8&#x27;)) #将用户列表发送给各客户端</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            content = read_client(s,nickname) <span class="comment">#客户端消息</span></span><br><span class="line">            <span class="keyword">if</span> content <span class="keyword">is</span> <span class="literal">None</span>: <span class="comment">#如果没有结束循环</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>: <span class="comment">#如果有将消息保存到历史记录</span></span><br><span class="line">                <span class="comment"># TextList.append(str(addr)+&#x27;: &#x27;+content)</span></span><br><span class="line">                TextList.append(nickname + <span class="string">&#x27;: &#x27;</span> + content)</span><br><span class="line">            <span class="comment">#将一个客户端发送过来的数据广播给其他客户端</span></span><br><span class="line">            <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">                <span class="comment"># sock.send((str(addr)+&#x27;: &#x27;+content).encode(&#x27;utf-8&#x27;))</span></span><br><span class="line">                sock.send((nickname + <span class="string">&#x27;: &#x27;</span> + content).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(repr())</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;广播未成功！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    client,addr = server.accept()</span><br><span class="line">    SocketList.append(client)</span><br><span class="line"></span><br><span class="line">    nickname = client.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="comment"># print(str(addr)+&#x27;已加入！&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> nickname <span class="keyword">in</span> Nickname:</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> nickname+<span class="built_in">str</span>(i) <span class="keyword">in</span> Nickname:</span><br><span class="line">                i = i+<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                nickname = nickname + <span class="built_in">str</span>(i)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    Nickname.append(nickname)</span><br><span class="line">    <span class="built_in">print</span>(nickname + <span class="string">&#x27;已加入！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">        sock.send((<span class="string">&#x27;系统消息：&#x27;</span> + nickname + <span class="string">&#x27;已加入！&#x27;</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># #历史消息生成</span></span><br><span class="line">    <span class="comment"># if len(TextList)==0:</span></span><br><span class="line">    <span class="comment">#     client.send(&#x27;No message.&#x27;.encode(&#x27;utf-8&#x27;))</span></span><br><span class="line">    <span class="comment"># else:</span></span><br><span class="line">    <span class="comment">#     client.send(&#x27;\n&#x27;.join(TextList).encode(&#x27;utf-8&#x27;))</span></span><br><span class="line"></span><br><span class="line">    cnt = cnt + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#每当有客户连接后，就启动一个线程为其服务</span></span><br><span class="line">    <span class="comment">#加入线程中跑，加入函数为send_client，参数为client,nickname</span></span><br><span class="line">    threading.Thread(target=send_client, args=(client,nickname,)).start()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#客户端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> tkinter.messagebox <span class="comment">#弹窗库</span></span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> scrolledtext  <span class="comment">#滚动文本框</span></span><br><span class="line"></span><br><span class="line">server_host = socket.gethostname()</span><br><span class="line">server_port = <span class="number">9999</span></span><br><span class="line"></span><br><span class="line">client = socket.socket() <span class="comment">#创建socket对象</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Connecting......&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#登入窗口：输入呢称</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LoginWindow</span>():</span></span><br><span class="line">    root = Tk()</span><br><span class="line">    root.title(<span class="string">&#x27;一起来聊天 · 登录&#x27;</span>) <span class="comment">#窗口标题</span></span><br><span class="line">    root.geometry(<span class="string">&#x27;300x150&#x27;</span>) <span class="comment">#窗口大小</span></span><br><span class="line">    root.geometry(<span class="string">&#x27;+500+300&#x27;</span>) <span class="comment">#改变窗体位置（‘+横坐标+纵坐标’）</span></span><br><span class="line">    nickname = StringVar() <span class="comment">#昵称变量（对象）:在使用界面编程的时候，有些时候是需要跟踪变量的值的变化，以保证值的变更随时可以显示在界面上</span></span><br><span class="line">    root.resizable(<span class="number">0</span>, <span class="number">0</span>) <span class="comment">#将窗口大小设置为不可变</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#登录函数（检查用户名是否为空，以及长度）</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Login_in</span>():</span></span><br><span class="line">        name = nickname.get() <span class="comment">#????</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> name:</span><br><span class="line">            tkinter.messagebox.showwarning(<span class="string">&#x27;Warning&#x27;</span>, message=<span class="string">&#x27;用户名为空！&#x27;</span>) <span class="comment">#消息警告框</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">len</span>(name) &gt; <span class="number">10</span>:</span><br><span class="line">            tkinter.messagebox.showwarning(<span class="string">&#x27;Warning&#x27;</span>, message=<span class="string">&#x27;用户名过长！最多为十个字符！&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            root.destroy()</span><br><span class="line">            client.connect((server_host, server_port))  <span class="comment"># 连接服务端，指定主机和端口</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Connecting is successful!&#x27;</span>)</span><br><span class="line">            client.send(name.encode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># 传递用户昵称</span></span><br><span class="line">            ChatRoom(name)  <span class="comment"># 打开聊天窗口</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#登录按钮、输入提示标签、输入框</span></span><br><span class="line">    Button(root, text=<span class="string">&quot;登录&quot;</span>, command=Login_in, width=<span class="number">8</span>, height=<span class="number">1</span>).place(x=<span class="number">100</span>, y=<span class="number">90</span>, width=<span class="number">100</span>, height=<span class="number">35</span>)</span><br><span class="line">    Label(root, text=<span class="string">&#x27;请输入昵称&#x27;</span>, font=(<span class="string">&#x27;Fangsong&#x27;</span>, <span class="number">12</span>)).place(x=<span class="number">10</span>, y=<span class="number">20</span>, height=<span class="number">50</span>, width=<span class="number">80</span>)</span><br><span class="line">    Entry(root, textvariable=nickname, font=(<span class="string">&#x27;Fangsong&#x27;</span>, <span class="number">11</span>)).place(x=<span class="number">100</span>, y=<span class="number">30</span>, height=<span class="number">30</span>, width=<span class="number">180</span>)</span><br><span class="line"></span><br><span class="line">    root.mainloop()</span><br><span class="line"></span><br><span class="line"><span class="comment">#聊天窗口</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ChatRoom</span>(<span class="params">nickname</span>):</span></span><br><span class="line">    root = Tk()</span><br><span class="line">    root.geometry(<span class="string">&#x27;650x400&#x27;</span>)  <span class="comment"># 窗口大小</span></span><br><span class="line">    root.resizable(<span class="number">0</span>, <span class="number">0</span>)  <span class="comment"># 将窗口大小设置为不可变</span></span><br><span class="line">    root.geometry(<span class="string">&#x27;+500+300&#x27;</span>)  <span class="comment"># 改变窗体位置（‘+横坐标+纵坐标’）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># content = client.recv(2048).decode(&#x27;utf-8&#x27;)</span></span><br><span class="line">    <span class="comment"># if content != &#x27;No message.&#x27;:</span></span><br><span class="line">    <span class="comment">#     past_text = content + &#x27;\n------以上是历史消息------\n&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 从服务器端获取当前用户列表</span></span><br><span class="line">    <span class="comment"># UserList = []</span></span><br><span class="line">    <span class="comment"># UserList = client.recv(2048).decode(&#x27;utf-8&#x27;).split(&#x27;,&#x27;)</span></span><br><span class="line">    <span class="comment"># UserList.insert(0, &#x27;------当前用户列表------&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 窗口标题</span></span><br><span class="line">    <span class="comment"># nickname = UserList[len(UserList)-1]</span></span><br><span class="line">    root.title(<span class="string">&#x27;一起来聊天 · &#x27;</span> + nickname)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># name_text = StringVar()</span></span><br><span class="line">    <span class="comment"># name_text.set(UserList)  # 用户列表文本设置</span></span><br><span class="line">    <span class="comment"># listbox1 = Listbox(root, listvariable=name_text)  # 用户列表，使用Listbox组件</span></span><br><span class="line">    <span class="comment"># listbox1.place(x=5, y=0, width=500, height=400)</span></span><br><span class="line"></span><br><span class="line">    img_png = PhotoImage(file=<span class="string">&#x27;QQ图片20220901201640.png&#x27;</span>)</span><br><span class="line">    label_img = Label(root, image=img_png)</span><br><span class="line">    label_img.place(x=<span class="number">400</span>, y=<span class="number">0</span>, width=<span class="number">350</span>, height=<span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#聊天界面</span></span><br><span class="line">    content = client.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    ChatBox = scrolledtext.ScrolledText(root)  <span class="comment"># 聊天信息窗口，使用ScrolledText组件制作</span></span><br><span class="line">    ChatBox.place(x=<span class="number">5</span>, y=<span class="number">0</span>, width=<span class="number">470</span>, height=<span class="number">300</span>)</span><br><span class="line">    <span class="comment"># ChatBox.pack()</span></span><br><span class="line">    ChatBox.insert(<span class="string">&#x27;end&#x27;</span>,content)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_server</span>(<span class="params">c</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            content = c.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            ChatBox.insert(<span class="string">&#x27;end&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>+content+<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">            ChatBox.see(tkinter.END)  <span class="comment"># ScrolledText组件方法，自动定位到结尾，否则只有消息在涨，窗口拖动条不动</span></span><br><span class="line">            ChatBox.update()  <span class="comment"># 更新聊天信息窗口，显示新的信息</span></span><br><span class="line">    threading.Thread(target=read_server, args=(client,)).start()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#聊天输入框</span></span><br><span class="line">    word = StringVar()</span><br><span class="line">    word.<span class="built_in">set</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    SentBox = Entry(root,width=<span class="number">140</span>,textvariable=word) <span class="comment">#建一个输入框</span></span><br><span class="line">    SentBox.place(x=<span class="number">5</span>,y=<span class="number">305</span>,width=<span class="number">475</span>,height=<span class="number">90</span>) <span class="comment">#设置大小和位置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#发送按钮</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sendtext</span>():</span></span><br><span class="line">        content = word.get() <span class="comment">#获得文本内容</span></span><br><span class="line">        <span class="keyword">if</span> content==<span class="string">&#x27;end&#x27;</span>:</span><br><span class="line">            client.close()</span><br><span class="line">        client.send(content.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        word.<span class="built_in">set</span>(<span class="string">&#x27;&#x27;</span>) <span class="comment">#用了一个标记记录点击的状态，不管内容是什么点了就变</span></span><br><span class="line"></span><br><span class="line">    sendButton = Button(root, text=<span class="string">&#x27;发 送&#x27;</span>, font=(<span class="string">&#x27;Fangsong&#x27;</span>, <span class="number">18</span>), bg=<span class="string">&#x27;white&#x27;</span>, command=sendtext)</span><br><span class="line">    sendButton.place(x=<span class="number">490</span>, y=<span class="number">308</span>, width=<span class="number">150</span>, height=<span class="number">85</span>)</span><br><span class="line"></span><br><span class="line">    root.mainloop()</span><br><span class="line"></span><br><span class="line">LoginWindow()</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zc666ying/article/details/104444733">(29 条消息) Python— 多线程编程（一）线程的创建，管理，停止_onesalatree 的博客 - CSDN 博客_python 线程开始结束</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wangyunhe5120/article/details/121846368">(29 条消息) python GUI 多线程 暂停 恢复 结束_为此残生的博客 - CSDN 博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41082014/article/details/92085252">(29 条消息) Python 多线程的退出控制_Messy… 的博客 - CSDN 博客_python 关闭线程的方法</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45956730/article/details/124120897">(29 条消息) python 多线程之 终止子线程_水 w 的博客 - CSDN 博客_python 结束线程</a></p>
</blockquote>
<h1 id="实训一阶段2可靠传输"><a class="markdownIt-Anchor" href="#实训一阶段2可靠传输">#</a> 实训一阶段 2：可靠传输</h1>
<blockquote>
<p>要求：</p>
<p>了解聊天程序的一般原理；</p>
<p>按照带流量控制的协议改造聊天程序；</p>
<p>编程语言不限；</p>
<p>要能在两台 PC 上运行。</p>
</blockquote>
<h2 id="初级阶段5可靠传输与流量控制"><a class="markdownIt-Anchor" href="#初级阶段5可靠传输与流量控制">#</a> 初级阶段 5：可靠传输与流量控制</h2>
<blockquote>
<p>可靠传输：使用<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/405221648">差错检测技术</a>，接收方的数据链路层就可以检测出帧在传输过程中是否产生了误码。</p>
<p>如果可靠传输，能够在检测出误码之后，返回一个通知帧，告诉发送方之前传输的帧存在误码，也许可以解决误码重传的问题</p>
<ul>
<li>数据链路层传输差错：比特差错、分组丢失、分组失序、分组重复</li>
<li><strong>可靠传输</strong>：想方法实现<strong>发送端发送什么，接收端就收到什么</strong></li>
</ul>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210424181454154.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1Nzc4Njc2,size_16,color_FFFFFF,t_70" alt="img"></p>
<p><strong>计算机网络之流量控制（停止 - 等待协议 1:1、滑动窗口：后退 N 帧协议 GBN、选择重传协议 SR）、滑动窗口、可靠传输机制</strong></p>
<p>1. 什么是<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6&amp;spm=1001.2101.3001.7020">流量控制</a>？</p>
<ul>
<li>流量控制是数据链路层的一种功能，流量控制对数据链路上的帧的发送速率进行控制，以使接收方有足够的缓冲空间来接受每个帧</li>
<li>流量控制的基本方法是由接收方控制发送方发送数据的速率</li>
<li>常见的流量控制方式有两种： <code>停止-等待协议、滑动窗口协议</code></li>
</ul>
<p>2. 什么是可靠传输机制？</p>
<ul>
<li>
<p>​		可靠传输机制是为了使数据可以正确稳定的传输和接收而制定的规则。</p>
</li>
<li>
<p>数据链路层的可靠传输通常使用确认和超时重传两种机制来完成。</p>
</li>
<li>
<p>确认是一种无数据的控制帧，这种控制帧使得接收方可以让发送方知道哪些内容被正确接收。有些情况下为了提高传输效率，将确认捎带在一个回复帧中，称为捎带确认。</p>
</li>
<li>
<p>超时重传是指发送方在发送某一个数据帧以后就开始一个计时器，在一定时间内如果没有得到发送的数据帧的确认帧，那么就重新发送该数据帧，直到发送成功为止。</p>
</li>
<li>
<p>自动重传请求（Auto Repeat reQuest，ARQ），通过接收方请求发送方重传出错的数据帧来恢复出错的帧，是通信中用于处理信道所带来差错的方法之一。</p>
</li>
<li>
<p>传统自动重传请求分为三种，即停等式（Stop-and-Wait）ARQ、后退 N 帧（Go-Back-N）ARQ 以及选择性重传（Selective Repeat）ARQ。后两种协议是滑动窗口技术与请求重发技术的结合，由于窗口尺寸开到足够大，帧在线路上可以连续地流动，因此又称为连续 ARQ 协议。</p>
</li>
</ul>
<p>3. 什么是滑动窗口机制？</p>
<ul>
<li>滑动窗口协议的基本原理就是在任意时刻，发送方都维持了一个连续的允许发送的帧的序号，称为发送窗口；同时，接收方也维持了一个连续的允许接收的帧的序号，称为接收窗口。</li>
<li>发送窗口和接收窗口的序号的上下界不一定要一样，甚至大小也可以不同。<br>
不同的滑动窗口协议窗口大小一般不同。</li>
<li>发送方窗口内的序列号代表了那些已经被发送，但是还没有被确认的帧，或者是那些可以被发送的帧。</li>
</ul>
<p>PS：直接看王道考研 - 计算机网络 3.4</p>
<h3 id="06-2"><a class="markdownIt-Anchor" href="#06-2">#</a> <strong>0.6</strong></h3>
<p><strong>作用：CRC 校验有问题，基础功能实现</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#客户端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> tkinter.messagebox <span class="comment">#弹窗库</span></span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> scrolledtext  <span class="comment">#滚动文本框</span></span><br><span class="line"></span><br><span class="line">server_host = socket.gethostname()</span><br><span class="line">server_port = <span class="number">9999</span></span><br><span class="line"></span><br><span class="line">client = socket.socket() <span class="comment">#创建socket对象</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Connecting......&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#登入窗口：输入呢称</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LoginWindow</span>():</span></span><br><span class="line">    root = Tk()</span><br><span class="line">    root.title(<span class="string">&#x27;一起来聊天 · 登录&#x27;</span>) <span class="comment">#窗口标题</span></span><br><span class="line">    root.geometry(<span class="string">&#x27;300x150&#x27;</span>) <span class="comment">#窗口大小</span></span><br><span class="line">    root.geometry(<span class="string">&#x27;+500+300&#x27;</span>) <span class="comment">#改变窗体位置（‘+横坐标+纵坐标’）</span></span><br><span class="line">    nickname = StringVar() <span class="comment">#昵称变量（对象）:在使用界面编程的时候，有些时候是需要跟踪变量的值的变化，以保证值的变更随时可以显示在界面上</span></span><br><span class="line">    root.resizable(<span class="number">0</span>, <span class="number">0</span>) <span class="comment">#将窗口大小设置为不可变</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#登录函数（检查用户名是否为空，以及长度）</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Login_in</span>():</span></span><br><span class="line">        name = nickname.get() <span class="comment">#????</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> name:</span><br><span class="line">            tkinter.messagebox.showwarning(<span class="string">&#x27;Warning&#x27;</span>, message=<span class="string">&#x27;用户名为空！&#x27;</span>) <span class="comment">#消息警告框</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">len</span>(name) &gt; <span class="number">10</span>:</span><br><span class="line">            tkinter.messagebox.showwarning(<span class="string">&#x27;Warning&#x27;</span>, message=<span class="string">&#x27;用户名过长！最多为十个字符！&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            root.destroy()</span><br><span class="line">            client.connect((server_host, server_port))  <span class="comment"># 连接服务端，指定主机和端口</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Connecting is successful!&#x27;</span>)</span><br><span class="line">            client.send(name.encode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># 传递用户昵称</span></span><br><span class="line">            ChatRoom(name)  <span class="comment"># 打开聊天窗口</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#登录按钮、输入提示标签、输入框</span></span><br><span class="line">    Button(root, text=<span class="string">&quot;登录&quot;</span>, command=Login_in, width=<span class="number">8</span>, height=<span class="number">1</span>).place(x=<span class="number">100</span>, y=<span class="number">90</span>, width=<span class="number">100</span>, height=<span class="number">35</span>)</span><br><span class="line">    Label(root, text=<span class="string">&#x27;请输入昵称&#x27;</span>, font=(<span class="string">&#x27;Fangsong&#x27;</span>, <span class="number">12</span>)).place(x=<span class="number">10</span>, y=<span class="number">20</span>, height=<span class="number">50</span>, width=<span class="number">80</span>)</span><br><span class="line">    Entry(root, textvariable=nickname, font=(<span class="string">&#x27;Fangsong&#x27;</span>, <span class="number">11</span>)).place(x=<span class="number">100</span>, y=<span class="number">30</span>, height=<span class="number">30</span>, width=<span class="number">180</span>)</span><br><span class="line"></span><br><span class="line">    root.mainloop()</span><br><span class="line"></span><br><span class="line"><span class="comment">#聊天窗口</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ChatRoom</span>(<span class="params">nickname</span>):</span></span><br><span class="line">    root = Tk()</span><br><span class="line">    root.geometry(<span class="string">&#x27;650x400&#x27;</span>)  <span class="comment"># 窗口大小</span></span><br><span class="line">    root.resizable(<span class="number">0</span>, <span class="number">0</span>)  <span class="comment"># 将窗口大小设置为不可变</span></span><br><span class="line">    root.geometry(<span class="string">&#x27;+500+300&#x27;</span>)  <span class="comment"># 改变窗体位置（‘+横坐标+纵坐标’）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># content = client.recv(2048).decode(&#x27;utf-8&#x27;)</span></span><br><span class="line">    <span class="comment"># if content != &#x27;No message.&#x27;:</span></span><br><span class="line">    <span class="comment">#     past_text = content + &#x27;\n------以上是历史消息------\n&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 从服务器端获取当前用户列表</span></span><br><span class="line">    <span class="comment"># UserList = []</span></span><br><span class="line">    <span class="comment"># UserList = client.recv(2048).decode(&#x27;utf-8&#x27;).split(&#x27;,&#x27;)</span></span><br><span class="line">    <span class="comment"># UserList.insert(0, &#x27;------当前用户列表------&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 窗口标题</span></span><br><span class="line">    <span class="comment"># nickname = UserList[len(UserList)-1]</span></span><br><span class="line">    root.title(<span class="string">&#x27;一起来聊天 · &#x27;</span> + nickname)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># name_text = StringVar()</span></span><br><span class="line">    <span class="comment"># name_text.set(UserList)  # 用户列表文本设置</span></span><br><span class="line">    <span class="comment"># listbox1 = Listbox(root, listvariable=name_text)  # 用户列表，使用Listbox组件</span></span><br><span class="line">    <span class="comment"># listbox1.place(x=5, y=0, width=500, height=400)</span></span><br><span class="line"></span><br><span class="line">    img_png = PhotoImage(file=<span class="string">&#x27;QQ图片20220901201640.png&#x27;</span>)</span><br><span class="line">    label_img = Label(root, image=img_png)</span><br><span class="line">    label_img.place(x=<span class="number">400</span>, y=<span class="number">0</span>, width=<span class="number">350</span>, height=<span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#聊天界面</span></span><br><span class="line">    <span class="comment"># content = client.recv(2048).decode(&#x27;utf-8&#x27;)</span></span><br><span class="line">    ChatBox = scrolledtext.ScrolledText(root)  <span class="comment"># 聊天信息窗口，使用ScrolledText组件制作</span></span><br><span class="line">    ChatBox.place(x=<span class="number">5</span>, y=<span class="number">0</span>, width=<span class="number">470</span>, height=<span class="number">300</span>)</span><br><span class="line">    <span class="comment"># ChatBox.pack()</span></span><br><span class="line">    <span class="comment"># ChatBox.insert(&#x27;end&#x27;,content)</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_server</span>(<span class="params">c</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            content = c.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            ChatBox.insert(<span class="string">&#x27;end&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>+content+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            ChatBox.see(tkinter.END)  <span class="comment"># ScrolledText组件方法，自动定位到结尾，否则只有消息在涨，窗口拖动条不动</span></span><br><span class="line">            ChatBox.update()  <span class="comment"># 更新聊天信息窗口，显示新的信息</span></span><br><span class="line">    threading.Thread(target=read_server, args=(client,)).start()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#聊天输入框</span></span><br><span class="line">    word = StringVar()</span><br><span class="line">    word.<span class="built_in">set</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    SentBox = Entry(root,width=<span class="number">140</span>,textvariable=word) <span class="comment">#建一个输入框</span></span><br><span class="line">    SentBox.place(x=<span class="number">5</span>,y=<span class="number">305</span>,width=<span class="number">475</span>,height=<span class="number">90</span>) <span class="comment">#设置大小和位置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#发送按钮</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sendtext</span>():</span></span><br><span class="line">        content = word.get() <span class="comment">#获得文本内容</span></span><br><span class="line">        <span class="keyword">if</span> content==<span class="string">&#x27;end&#x27;</span>:</span><br><span class="line">            client.close()</span><br><span class="line">        client.send(content.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        word.<span class="built_in">set</span>(<span class="string">&#x27;&#x27;</span>) <span class="comment">#用了一个标记记录点击的状态，不管内容是什么点了就变</span></span><br><span class="line"></span><br><span class="line">    sendButton = Button(root, text=<span class="string">&#x27;发 送&#x27;</span>, font=(<span class="string">&#x27;Fangsong&#x27;</span>, <span class="number">18</span>), bg=<span class="string">&#x27;white&#x27;</span>, command=sendtext)</span><br><span class="line">    sendButton.place(x=<span class="number">490</span>, y=<span class="number">308</span>, width=<span class="number">150</span>, height=<span class="number">85</span>)</span><br><span class="line"></span><br><span class="line">    root.mainloop()</span><br><span class="line"></span><br><span class="line">LoginWindow()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">host = socket.gethostname() <span class="comment">#获取当前主机的IP地址</span></span><br><span class="line">port = <span class="number">9999</span> <span class="comment">#设置防火墙开放端口</span></span><br><span class="line">SocketList = [] <span class="comment">#存储客户端套接字的列表</span></span><br><span class="line">TextList = [] <span class="comment">#存储聊天记录</span></span><br><span class="line">Nickname = [] <span class="comment">#存储用户呢称</span></span><br><span class="line">cnt = <span class="number">0</span> <span class="comment">#当前客户端人数</span></span><br><span class="line"><span class="built_in">print</span>(host)</span><br><span class="line"></span><br><span class="line">server = socket.socket() <span class="comment">#创建server对象</span></span><br><span class="line">server.bind((host,port)) <span class="comment">#绑定</span></span><br><span class="line">server.listen() <span class="comment">#监听</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;服务器准备就绪！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CRC</span>(<span class="params">crc,poly=<span class="string">&#x27;11001&#x27;</span></span>):</span></span><br><span class="line">    test_crc = <span class="built_in">int</span>(crc,<span class="number">16</span>) <span class="comment">#将str类型转化成16进制</span></span><br><span class="line">    poly_crc8 = <span class="built_in">int</span>(poly,<span class="number">16</span>)</span><br><span class="line">    <span class="comment"># print(test_crc,poly_crc8)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> bit <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">        <span class="keyword">if</span> test_crc&amp;<span class="number">0x800</span> != <span class="number">0</span>: <span class="comment">#最高位是否为1</span></span><br><span class="line">            test_crc &lt;&lt;= <span class="number">1</span></span><br><span class="line">            test_crc ^= poly_crc8</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            test_crc &lt;&lt;= <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(test_crc)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">hex</span>(test_crc)</span><br><span class="line"></span><br><span class="line"><span class="comment">#接收一个客户端连接，及其发送来数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_client</span>(<span class="params">s,nickname</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment">#接受客户端发送来的数据</span></span><br><span class="line">        <span class="keyword">return</span> s.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment">#客户端异常，连接失败，则删除该socket</span></span><br><span class="line">        <span class="comment"># print(str(addr)+&#x27;已下线！&#x27;)</span></span><br><span class="line">        <span class="built_in">print</span>(nickname + <span class="string">&#x27;已下线！&#x27;</span>)</span><br><span class="line">        SocketList.remove(s)</span><br><span class="line">        Nickname.remove(nickname)</span><br><span class="line">        <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">            sock.send((<span class="string">&#x27;系统消息：&#x27;</span> + nickname + <span class="string">&#x27;已下线！&#x27;</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#多线程：将收到的消息发送给所有客户端</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_client</span>(<span class="params">s,nickname</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># s.send((&#x27;,&#x27;.join(Nickname)).encode(&#x27;utf-8&#x27;)) #将用户列表发送给各客户端</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            content = read_client(s,nickname) <span class="comment">#客户端消息</span></span><br><span class="line">            <span class="keyword">if</span> content <span class="keyword">is</span> <span class="literal">None</span>: <span class="comment">#如果没有结束循环</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>: <span class="comment">#如果有将消息保存到历史记录</span></span><br><span class="line">                <span class="comment"># TextList.append(str(addr)+&#x27;: &#x27;+content)</span></span><br><span class="line">                TextList.append(nickname + <span class="string">&#x27;: &#x27;</span> + content)</span><br><span class="line">            <span class="comment">#将一个客户端发送过来的数据广播给其他客户端</span></span><br><span class="line">            <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">                <span class="comment"># sock.send((str(addr)+&#x27;: &#x27;+content).encode(&#x27;utf-8&#x27;))</span></span><br><span class="line">                sock.send((nickname + <span class="string">&#x27;: &#x27;</span> + content).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">            data = CRC(content)</span><br><span class="line">            <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">                <span class="comment"># sock.send((str(addr)+&#x27;: &#x27;+content).encode(&#x27;utf-8&#x27;))</span></span><br><span class="line">                sock.send((<span class="string">&#x27;Teacher: &#x27;</span> + data).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(repr())</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;广播未成功！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">QianYan = [<span class="string">&#x27;你好呀！今天我们一起来学习SW。&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;可靠传输机制是为了使数据可以正确稳定的传输和接收而制定的规则。&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;流量控制是数据链路层的一种功能，流量控制对数据链路上的帧的发送速率进行控制，以使接收方有足够的缓冲空间来接受每个帧。&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;流量控制的基本方法是由接收方控制发送方发送数据的速率。&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;常见的流量控制方式有两种：`停止-等待协议、滑动窗口协议&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;那么，让我们开始体验停止-等待协议SW的魅力吧！&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;\n\n请输入十六进制数据&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    client,addr = server.accept()</span><br><span class="line">    SocketList.append(client)</span><br><span class="line"></span><br><span class="line">    nickname = client.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="comment"># print(str(addr)+&#x27;已加入！&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> nickname <span class="keyword">in</span> Nickname:</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> nickname+<span class="built_in">str</span>(i) <span class="keyword">in</span> Nickname:</span><br><span class="line">                i = i+<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                nickname = nickname + <span class="built_in">str</span>(i)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    Nickname.append(nickname)</span><br><span class="line">    <span class="built_in">print</span>(nickname + <span class="string">&#x27;已加入！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> QianYan:</span><br><span class="line">            sock.send((<span class="string">&#x27;Teacher: &#x27;</span> + i).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    cnt = cnt + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#每当有客户连接后，就启动一个线程为其服务</span></span><br><span class="line">    <span class="comment">#加入线程中跑，加入函数为send_client，参数为client,nickname</span></span><br><span class="line">    threading.Thread(target=send_client, args=(client,nickname,)).start()</span><br></pre></td></tr></table></figure>
<h3 id="065-2"><a class="markdownIt-Anchor" href="#065-2">#</a> <strong>0.65</strong></h3>
<p><strong>作用：早上灵光一现，以为 CRC 是取模了……</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">host = socket.gethostname() <span class="comment">#获取当前主机的IP地址</span></span><br><span class="line">port = <span class="number">9999</span> <span class="comment">#设置防火墙开放端口</span></span><br><span class="line">SocketList = [] <span class="comment">#存储客户端套接字的列表</span></span><br><span class="line">TextList = [] <span class="comment">#存储聊天记录</span></span><br><span class="line">Nickname = [] <span class="comment">#存储用户呢称</span></span><br><span class="line">cnt = <span class="number">0</span> <span class="comment">#当前客户端人数</span></span><br><span class="line"><span class="built_in">print</span>(host)</span><br><span class="line"></span><br><span class="line">server = socket.socket() <span class="comment">#创建server对象</span></span><br><span class="line">server.bind((host,port)) <span class="comment">#绑定</span></span><br><span class="line">server.listen() <span class="comment">#监听</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;服务器准备就绪！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DEC</span>(<span class="params">data</span>):</span></span><br><span class="line">    s = data</span><br><span class="line">    d = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> s:</span><br><span class="line">        d = d*<span class="number">2</span> + (<span class="built_in">ord</span>(s[<span class="number">0</span>]) -<span class="built_in">ord</span>(<span class="string">&#x27;0&#x27;</span>))</span><br><span class="line">        s = s[<span class="number">1</span>:]</span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CRC</span>(<span class="params">crc,poly=<span class="string">&#x27;11001&#x27;</span></span>):</span></span><br><span class="line">    p = DEC(poly)</span><br><span class="line">    c = DEC(crc+<span class="string">&#x27;0000&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(p,c)</span><br><span class="line">    res = c%p</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment">#接收一个客户端连接，及其发送来数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_client</span>(<span class="params">s,nickname</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment">#接受客户端发送来的数据</span></span><br><span class="line">        <span class="keyword">return</span> s.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment">#客户端异常，连接失败，则删除该socket</span></span><br><span class="line">        <span class="comment"># print(str(addr)+&#x27;已下线！&#x27;)</span></span><br><span class="line">        <span class="built_in">print</span>(nickname + <span class="string">&#x27;已下线！&#x27;</span>)</span><br><span class="line">        SocketList.remove(s)</span><br><span class="line">        Nickname.remove(nickname)</span><br><span class="line">        <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">            sock.send((<span class="string">&#x27;系统消息：&#x27;</span> + nickname + <span class="string">&#x27;已下线！&#x27;</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#多线程：将收到的消息发送给所有客户端</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_client</span>(<span class="params">s,nickname</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># s.send((&#x27;,&#x27;.join(Nickname)).encode(&#x27;utf-8&#x27;)) #将用户列表发送给各客户端</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            content = read_client(s,nickname) <span class="comment">#客户端消息</span></span><br><span class="line">            <span class="keyword">if</span> content <span class="keyword">is</span> <span class="literal">None</span>: <span class="comment">#如果没有结束循环</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>: <span class="comment">#如果有将消息保存到历史记录</span></span><br><span class="line">                <span class="comment"># TextList.append(str(addr)+&#x27;: &#x27;+content)</span></span><br><span class="line">                TextList.append(nickname + <span class="string">&#x27;: &#x27;</span> + content)</span><br><span class="line">            <span class="comment">#将一个客户端发送过来的数据广播给其他客户端</span></span><br><span class="line">            <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">                <span class="comment"># sock.send((str(addr)+&#x27;: &#x27;+content).encode(&#x27;utf-8&#x27;))</span></span><br><span class="line">                sock.send((nickname + <span class="string">&#x27;: &#x27;</span> + content).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">            data = CRC(content)</span><br><span class="line">            <span class="keyword">if</span> data==<span class="number">0</span>:</span><br><span class="line">                word = <span class="string">&#x27;发送帧没问题。&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                word = <span class="string">&#x27;发送帧有问题。&#x27;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">                <span class="comment"># sock.send((str(addr)+&#x27;: &#x27;+content).encode(&#x27;utf-8&#x27;))</span></span><br><span class="line">                sock.send((<span class="string">&#x27;Teacher: &#x27;</span> + word).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(repr())</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;广播未成功！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">QianYan = [<span class="string">&#x27;你好呀！今天我们一起来学习SW。&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;可靠传输机制是为了使数据可以正确稳定的传输和接收而制定的规则。&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;流量控制是数据链路层的一种功能，流量控制对数据链路上的帧的发送速率进行控制，以使接收方有足够的缓冲空间来接受每个帧。&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;流量控制的基本方法是由接收方控制发送方发送数据的速率。&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;常见的流量控制方式有两种：`停止-等待协议、滑动窗口协议&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;那么，让我们开始体验停止-等待协议SW的魅力吧！&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;\n\n请输入十六进制数据&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    client,addr = server.accept()</span><br><span class="line">    SocketList.append(client)</span><br><span class="line"></span><br><span class="line">    nickname = client.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="comment"># print(str(addr)+&#x27;已加入！&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> nickname <span class="keyword">in</span> Nickname:</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> nickname+<span class="built_in">str</span>(i) <span class="keyword">in</span> Nickname:</span><br><span class="line">                i = i+<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                nickname = nickname + <span class="built_in">str</span>(i)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    Nickname.append(nickname)</span><br><span class="line">    <span class="built_in">print</span>(nickname + <span class="string">&#x27;已加入！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> QianYan:</span><br><span class="line">            sock.send((<span class="string">&#x27;Teacher: &#x27;</span> + i).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    cnt = cnt + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#每当有客户连接后，就启动一个线程为其服务</span></span><br><span class="line">    <span class="comment">#加入线程中跑，加入函数为send_client，参数为client,nickname</span></span><br><span class="line">    threading.Thread(target=send_client, args=(client,nickname,)).start()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#客户端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> tkinter.messagebox <span class="comment">#弹窗库</span></span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> scrolledtext  <span class="comment">#滚动文本框</span></span><br><span class="line"></span><br><span class="line">server_host = socket.gethostname()</span><br><span class="line">server_port = <span class="number">9999</span></span><br><span class="line"></span><br><span class="line">client = socket.socket() <span class="comment">#创建socket对象</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Connecting......&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#登入窗口：输入呢称</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LoginWindow</span>():</span></span><br><span class="line">    root = Tk()</span><br><span class="line">    root.title(<span class="string">&#x27;一起来聊天 · 登录&#x27;</span>) <span class="comment">#窗口标题</span></span><br><span class="line">    root.geometry(<span class="string">&#x27;300x150&#x27;</span>) <span class="comment">#窗口大小</span></span><br><span class="line">    root.geometry(<span class="string">&#x27;+500+300&#x27;</span>) <span class="comment">#改变窗体位置（‘+横坐标+纵坐标’）</span></span><br><span class="line">    nickname = StringVar() <span class="comment">#昵称变量（对象）:在使用界面编程的时候，有些时候是需要跟踪变量的值的变化，以保证值的变更随时可以显示在界面上</span></span><br><span class="line">    root.resizable(<span class="number">0</span>, <span class="number">0</span>) <span class="comment">#将窗口大小设置为不可变</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#登录函数（检查用户名是否为空，以及长度）</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Login_in</span>():</span></span><br><span class="line">        name = nickname.get() <span class="comment">#????</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> name:</span><br><span class="line">            tkinter.messagebox.showwarning(<span class="string">&#x27;Warning&#x27;</span>, message=<span class="string">&#x27;用户名为空！&#x27;</span>) <span class="comment">#消息警告框</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">len</span>(name) &gt; <span class="number">10</span>:</span><br><span class="line">            tkinter.messagebox.showwarning(<span class="string">&#x27;Warning&#x27;</span>, message=<span class="string">&#x27;用户名过长！最多为十个字符！&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            root.destroy()</span><br><span class="line">            client.connect((server_host, server_port))  <span class="comment"># 连接服务端，指定主机和端口</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Connecting is successful!&#x27;</span>)</span><br><span class="line">            client.send(name.encode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># 传递用户昵称</span></span><br><span class="line">            ChatRoom(name)  <span class="comment"># 打开聊天窗口</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#登录按钮、输入提示标签、输入框</span></span><br><span class="line">    Button(root, text=<span class="string">&quot;登录&quot;</span>, command=Login_in, width=<span class="number">8</span>, height=<span class="number">1</span>).place(x=<span class="number">100</span>, y=<span class="number">90</span>, width=<span class="number">100</span>, height=<span class="number">35</span>)</span><br><span class="line">    Label(root, text=<span class="string">&#x27;请输入昵称&#x27;</span>, font=(<span class="string">&#x27;Fangsong&#x27;</span>, <span class="number">12</span>)).place(x=<span class="number">10</span>, y=<span class="number">20</span>, height=<span class="number">50</span>, width=<span class="number">80</span>)</span><br><span class="line">    Entry(root, textvariable=nickname, font=(<span class="string">&#x27;Fangsong&#x27;</span>, <span class="number">11</span>)).place(x=<span class="number">100</span>, y=<span class="number">30</span>, height=<span class="number">30</span>, width=<span class="number">180</span>)</span><br><span class="line"></span><br><span class="line">    root.mainloop()</span><br><span class="line"></span><br><span class="line"><span class="comment">#聊天窗口</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ChatRoom</span>(<span class="params">nickname</span>):</span></span><br><span class="line">    root = Tk()</span><br><span class="line">    root.geometry(<span class="string">&#x27;650x400&#x27;</span>)  <span class="comment"># 窗口大小</span></span><br><span class="line">    root.resizable(<span class="number">0</span>, <span class="number">0</span>)  <span class="comment"># 将窗口大小设置为不可变</span></span><br><span class="line">    root.geometry(<span class="string">&#x27;+500+300&#x27;</span>)  <span class="comment"># 改变窗体位置（‘+横坐标+纵坐标’）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># content = client.recv(2048).decode(&#x27;utf-8&#x27;)</span></span><br><span class="line">    <span class="comment"># if content != &#x27;No message.&#x27;:</span></span><br><span class="line">    <span class="comment">#     past_text = content + &#x27;\n------以上是历史消息------\n&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 从服务器端获取当前用户列表</span></span><br><span class="line">    <span class="comment"># UserList = []</span></span><br><span class="line">    <span class="comment"># UserList = client.recv(2048).decode(&#x27;utf-8&#x27;).split(&#x27;,&#x27;)</span></span><br><span class="line">    <span class="comment"># UserList.insert(0, &#x27;------当前用户列表------&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 窗口标题</span></span><br><span class="line">    <span class="comment"># nickname = UserList[len(UserList)-1]</span></span><br><span class="line">    root.title(<span class="string">&#x27;一起来聊天 · &#x27;</span> + nickname)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># name_text = StringVar()</span></span><br><span class="line">    <span class="comment"># name_text.set(UserList)  # 用户列表文本设置</span></span><br><span class="line">    <span class="comment"># listbox1 = Listbox(root, listvariable=name_text)  # 用户列表，使用Listbox组件</span></span><br><span class="line">    <span class="comment"># listbox1.place(x=5, y=0, width=500, height=400)</span></span><br><span class="line"></span><br><span class="line">    img_png = PhotoImage(file=<span class="string">&#x27;QQ图片20220901201640.png&#x27;</span>)</span><br><span class="line">    label_img = Label(root, image=img_png)</span><br><span class="line">    label_img.place(x=<span class="number">400</span>, y=<span class="number">0</span>, width=<span class="number">350</span>, height=<span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#聊天界面</span></span><br><span class="line">    <span class="comment"># content = client.recv(2048).decode(&#x27;utf-8&#x27;)</span></span><br><span class="line">    ChatBox = scrolledtext.ScrolledText(root)  <span class="comment"># 聊天信息窗口，使用ScrolledText组件制作</span></span><br><span class="line">    ChatBox.place(x=<span class="number">5</span>, y=<span class="number">0</span>, width=<span class="number">470</span>, height=<span class="number">300</span>)</span><br><span class="line">    <span class="comment"># ChatBox.pack()</span></span><br><span class="line">    <span class="comment"># ChatBox.insert(&#x27;end&#x27;,content)</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_server</span>(<span class="params">c</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            content = c.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            ChatBox.insert(<span class="string">&#x27;end&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>+content+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            ChatBox.see(tkinter.END)  <span class="comment"># ScrolledText组件方法，自动定位到结尾，否则只有消息在涨，窗口拖动条不动</span></span><br><span class="line">            ChatBox.update()  <span class="comment"># 更新聊天信息窗口，显示新的信息</span></span><br><span class="line">    threading.Thread(target=read_server, args=(client,)).start()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#聊天输入框</span></span><br><span class="line">    word = StringVar()</span><br><span class="line">    word.<span class="built_in">set</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    SentBox = Entry(root,width=<span class="number">140</span>,textvariable=word) <span class="comment">#建一个输入框</span></span><br><span class="line">    SentBox.place(x=<span class="number">5</span>,y=<span class="number">305</span>,width=<span class="number">475</span>,height=<span class="number">90</span>) <span class="comment">#设置大小和位置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#发送按钮</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sendtext</span>():</span></span><br><span class="line">        content = word.get() <span class="comment">#获得文本内容</span></span><br><span class="line">        <span class="keyword">if</span> content==<span class="string">&#x27;end&#x27;</span>:</span><br><span class="line">            client.close()</span><br><span class="line">        client.send(content.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        word.<span class="built_in">set</span>(<span class="string">&#x27;&#x27;</span>) <span class="comment">#用了一个标记记录点击的状态，不管内容是什么点了就变</span></span><br><span class="line"></span><br><span class="line">    sendButton = Button(root, text=<span class="string">&#x27;发 送&#x27;</span>, font=(<span class="string">&#x27;Fangsong&#x27;</span>, <span class="number">18</span>), bg=<span class="string">&#x27;white&#x27;</span>, command=sendtext)</span><br><span class="line">    sendButton.place(x=<span class="number">490</span>, y=<span class="number">308</span>, width=<span class="number">150</span>, height=<span class="number">85</span>)</span><br><span class="line"></span><br><span class="line">    root.mainloop()</span><br><span class="line"></span><br><span class="line">LoginWindow()</span><br></pre></td></tr></table></figure>
<h3 id="07"><a class="markdownIt-Anchor" href="#07">#</a> 0.7</h3>
<p><strong>作用：拿的网上的 CRC 但感觉还是错的……</strong></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://cn.bing.com/search?q=crc%E5%8E%9F%E7%90%86Python&amp;qs=n&amp;form=QBRE&amp;sp=-1&amp;pq=crc%E5%8E%9F%E7%90%86python&amp;sc=0-11&amp;sk=&amp;cvid=66D0F3FB7AC54F3683ABFEB1122DA0BF&amp;ghsh=0&amp;ghacc=0&amp;ghpl=">crc 原理 Python - Search (bing.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/smallfox233/article/details/111242813">https://blog.csdn.net/smallfox233/article/details/111242813</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">host = socket.gethostname() <span class="comment">#获取当前主机的IP地址</span></span><br><span class="line">port = <span class="number">9999</span> <span class="comment">#设置防火墙开放端口</span></span><br><span class="line">SocketList = [] <span class="comment">#存储客户端套接字的列表</span></span><br><span class="line">TextList = [] <span class="comment">#存储聊天记录</span></span><br><span class="line">Nickname = [] <span class="comment">#存储用户呢称</span></span><br><span class="line">cnt = <span class="number">0</span> <span class="comment">#当前客户端人数</span></span><br><span class="line"><span class="built_in">print</span>(host)</span><br><span class="line"></span><br><span class="line">server = socket.socket() <span class="comment">#创建server对象</span></span><br><span class="line">server.bind((host,port)) <span class="comment">#绑定</span></span><br><span class="line">server.listen() <span class="comment">#监听</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;服务器准备就绪！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">TurnBin</span>(<span class="params">expression</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;将生成多项式转换为二进制字符串输出&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># 输入数据处理</span></span><br><span class="line">    expression = expression.upper()  <span class="comment"># 大写转换</span></span><br><span class="line">    lis = <span class="built_in">list</span>(expression.split(<span class="string">&quot;+&quot;</span>))  <span class="comment"># 以加号为标志进行分割</span></span><br><span class="line">    string = lis[-<span class="number">1</span>]  <span class="comment"># 多项式末尾的数字1</span></span><br><span class="line">    <span class="keyword">del</span> lis[-<span class="number">1</span>]</span><br><span class="line">    lis = lis[::-<span class="number">1</span>]  <span class="comment"># 倒序</span></span><br><span class="line">    <span class="comment">##    print(lis)</span></span><br><span class="line">    <span class="comment"># 二进制转换</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(lis)):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(string) == <span class="built_in">int</span>(lis[i][<span class="number">1</span>]):  <span class="comment"># 满足位数与变量的数字相同时</span></span><br><span class="line">            string += <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(lis[i][<span class="number">1</span>]) - <span class="built_in">len</span>(string)):  <span class="comment"># 用0补全相差的位数</span></span><br><span class="line">                string += <span class="string">&quot;0&quot;</span></span><br><span class="line">            string += <span class="string">&quot;1&quot;</span></span><br><span class="line">    <span class="keyword">return</span> string[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">XOR</span>(<span class="params">string1, string2</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;将两个二进制串进行异或操作，不同为1&#x27;&#x27;&#x27;</span></span><br><span class="line">    result = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 输入数据处理</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(string1) &lt; <span class="built_in">len</span>(string2):  <span class="comment"># 若前者的位数不足时</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(string2) - <span class="built_in">len</span>(string1)):  <span class="comment"># 对string1的首位补0</span></span><br><span class="line">            string1 = <span class="string">&quot;0&quot;</span> + string1</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(string1) &gt; <span class="built_in">len</span>(string2):  <span class="comment"># 若后者的位数不足时</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(string1) - <span class="built_in">len</span>(string2)):  <span class="comment"># 对string2的首位补0</span></span><br><span class="line">            string2 = <span class="string">&quot;0&quot;</span> + string2</span><br><span class="line">    <span class="comment">##    print(string1,string2)</span></span><br><span class="line">    <span class="comment"># 异或计算</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(string1)):</span><br><span class="line">        <span class="keyword">if</span> string1[i] != string2[i]:</span><br><span class="line">            result += <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result += <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="comment">##    print(result)</span></span><br><span class="line">    <span class="comment"># 输出数据处理</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(result)):  <span class="comment"># 消除异或结果中的无效0</span></span><br><span class="line">        <span class="keyword">if</span> result[i] == <span class="string">&quot;1&quot;</span>:  <span class="comment"># 找到第一个有效数据时</span></span><br><span class="line">            <span class="keyword">return</span> result[i::]</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CRC</span>(<span class="params">string, expression</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;产生CRC校验码&#x27;&#x27;&#x27;</span></span><br><span class="line">    crc = <span class="string">&quot;&quot;</span>  <span class="comment"># 最终的crc校验码</span></span><br><span class="line">    <span class="comment"># 输入数据处理</span></span><br><span class="line">    bin_expression = TurnBin(expression)  <span class="comment"># 转换为二进制串</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bin_expression) - <span class="number">1</span>):  <span class="comment"># 在二进制串末尾补0</span></span><br><span class="line">        string += <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="comment">##    print(string,bin_expression)</span></span><br><span class="line">    <span class="comment"># CRC计算</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(string)):  <span class="comment"># 遍历被除数二进制串</span></span><br><span class="line">        crc += string[i]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(crc) == <span class="built_in">len</span>(bin_expression):  <span class="comment"># 当位数足够异或计算时</span></span><br><span class="line">            crc = XOR(crc, bin_expression)</span><br><span class="line">    <span class="comment">##    print(crc)</span></span><br><span class="line">    <span class="comment"># 输出数据处理</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(crc) &lt; <span class="built_in">len</span>(bin_expression) - <span class="number">1</span>:  <span class="comment"># 当crc位数不足时</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bin_expression) - <span class="built_in">len</span>(crc)):  <span class="comment"># 在首部补0</span></span><br><span class="line">            crc = <span class="string">&quot;0&quot;</span> + crc</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(crc) &gt; <span class="built_in">len</span>(bin_expression) - <span class="number">1</span>:  <span class="comment"># 当crc位数过多时</span></span><br><span class="line">        crc = crc[<span class="built_in">len</span>(crc) - <span class="built_in">len</span>(bin_expression) + <span class="number">1</span>::]  <span class="comment"># 切片，消除首部多余的0</span></span><br><span class="line">    <span class="keyword">return</span> crc</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CheckCRC</span>(<span class="params">string, expression=<span class="string">&#x27;x4+x3+1&#x27;</span></span>):</span>  <span class="comment"># 检测传输数据是否正确，并打印结果</span></span><br><span class="line">    <span class="comment"># 输入数据处理</span></span><br><span class="line">    bin_expression = TurnBin(expression)  <span class="comment"># 转换为二进制串</span></span><br><span class="line">    right_crc = string[<span class="built_in">len</span>(string) - <span class="built_in">len</span>(bin_expression) + <span class="number">1</span>::]  <span class="comment"># 原数据末尾的crc校验码</span></span><br><span class="line">    <span class="comment"># CRC计算</span></span><br><span class="line">    crc = CRC(string[:<span class="built_in">len</span>(string) - <span class="built_in">len</span>(bin_expression) + <span class="number">1</span>:], expression)</span><br><span class="line">    <span class="comment"># 检验</span></span><br><span class="line">    <span class="keyword">if</span> right_crc == crc:  <span class="comment"># 当尾部的CRC校验码，与首部数据生成的CRC校验码一致时</span></span><br><span class="line">        word =<span class="string">&quot;数据传输过程正常..\n检测出的校验码：&quot;</span>+<span class="built_in">str</span>(crc)+<span class="string">&#x27;\n数据尾部校验码：&#x27;</span>+<span class="built_in">str</span>(right_crc)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        word =<span class="string">&quot;数据传输过程出错..\n检测出的校验码：&quot;</span>+<span class="built_in">str</span>(crc)+<span class="string">&#x27;\n数据尾部校验码：&#x27;</span>+<span class="built_in">str</span>(right_crc)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">        <span class="comment"># sock.send((str(addr)+&#x27;: &#x27;+content).encode(&#x27;utf-8&#x27;))</span></span><br><span class="line">        sock.send((<span class="string">&#x27;Teacher: &#x27;</span> + word).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#接收一个客户端连接，及其发送来数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_client</span>(<span class="params">s,nickname</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment">#接受客户端发送来的数据</span></span><br><span class="line">        <span class="keyword">return</span> s.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment">#客户端异常，连接失败，则删除该socket</span></span><br><span class="line">        <span class="comment"># print(str(addr)+&#x27;已下线！&#x27;)</span></span><br><span class="line">        <span class="built_in">print</span>(nickname + <span class="string">&#x27;已下线！&#x27;</span>)</span><br><span class="line">        SocketList.remove(s)</span><br><span class="line">        Nickname.remove(nickname)</span><br><span class="line">        <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">            sock.send((<span class="string">&#x27;系统消息：&#x27;</span> + nickname + <span class="string">&#x27;已下线！&#x27;</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#多线程：将收到的消息发送给所有客户端</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_client</span>(<span class="params">s,nickname</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># s.send((&#x27;,&#x27;.join(Nickname)).encode(&#x27;utf-8&#x27;)) #将用户列表发送给各客户端</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            content = read_client(s,nickname) <span class="comment">#客户端消息</span></span><br><span class="line">            <span class="keyword">if</span> content <span class="keyword">is</span> <span class="literal">None</span>: <span class="comment">#如果没有结束循环</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>: <span class="comment">#如果有将消息保存到历史记录</span></span><br><span class="line">                <span class="comment"># TextList.append(str(addr)+&#x27;: &#x27;+content)</span></span><br><span class="line">                TextList.append(nickname + <span class="string">&#x27;: &#x27;</span> + content)</span><br><span class="line">            <span class="comment">#将一个客户端发送过来的数据广播给其他客户端</span></span><br><span class="line">            <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">                <span class="comment"># sock.send((str(addr)+&#x27;: &#x27;+content).encode(&#x27;utf-8&#x27;))</span></span><br><span class="line">                sock.send((nickname + <span class="string">&#x27;: &#x27;</span> + content).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">            CheckCRC(content)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(repr())</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;广播未成功！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">QianYan = [</span><br><span class="line">    <span class="string">&#x27;你好呀！今天我们一起来学习SW。&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;可靠传输机制是为了使数据可以正确稳定的传输和接收而制定的规则。&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;流量控制是数据链路层的一种功能，流量控制对数据链路上的帧的发送速率进行控制，以使接收方有足够的缓冲空间来接受每个帧。&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;流量控制的基本方法是由接收方控制发送方发送数据的速率。&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;常见的流量控制方式有两种：`停止-等待协议、滑动窗口协议&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;那么，让我们开始体验停止-等待协议SW的魅力吧！&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;\n\n请输入高于4位的二进制数据&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    client,addr = server.accept()</span><br><span class="line">    SocketList.append(client)</span><br><span class="line"></span><br><span class="line">    nickname = client.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="comment"># print(str(addr)+&#x27;已加入！&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> nickname <span class="keyword">in</span> Nickname:</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> nickname+<span class="built_in">str</span>(i) <span class="keyword">in</span> Nickname:</span><br><span class="line">                i = i+<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                nickname = nickname + <span class="built_in">str</span>(i)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    Nickname.append(nickname)</span><br><span class="line">    <span class="built_in">print</span>(nickname + <span class="string">&#x27;已加入！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> sock <span class="keyword">in</span> SocketList:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> QianYan:</span><br><span class="line">            sock.send((<span class="string">&#x27;Teacher: &#x27;</span> + i).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    cnt = cnt + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#每当有客户连接后，就启动一个线程为其服务</span></span><br><span class="line">    <span class="comment">#加入线程中跑，加入函数为send_client，参数为client,nickname</span></span><br><span class="line">    threading.Thread(target=send_client, args=(client,nickname,)).start()</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#客户端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> tkinter.messagebox <span class="comment">#弹窗库</span></span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> scrolledtext  <span class="comment">#滚动文本框</span></span><br><span class="line"></span><br><span class="line">server_host = socket.gethostname()</span><br><span class="line">server_port = <span class="number">9999</span></span><br><span class="line"></span><br><span class="line">client = socket.socket() <span class="comment">#创建socket对象</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Connecting......&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#登入窗口：输入呢称</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LoginWindow</span>():</span></span><br><span class="line">    root = Tk()</span><br><span class="line">    root.title(<span class="string">&#x27;一起来聊天 · 登录&#x27;</span>) <span class="comment">#窗口标题</span></span><br><span class="line">    root.geometry(<span class="string">&#x27;300x150&#x27;</span>) <span class="comment">#窗口大小</span></span><br><span class="line">    root.geometry(<span class="string">&#x27;+500+300&#x27;</span>) <span class="comment">#改变窗体位置（‘+横坐标+纵坐标’）</span></span><br><span class="line">    nickname = StringVar() <span class="comment">#昵称变量（对象）:在使用界面编程的时候，有些时候是需要跟踪变量的值的变化，以保证值的变更随时可以显示在界面上</span></span><br><span class="line">    root.resizable(<span class="number">0</span>, <span class="number">0</span>) <span class="comment">#将窗口大小设置为不可变</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#登录函数（检查用户名是否为空，以及长度）</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Login_in</span>():</span></span><br><span class="line">        name = nickname.get() <span class="comment">#????</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> name:</span><br><span class="line">            tkinter.messagebox.showwarning(<span class="string">&#x27;Warning&#x27;</span>, message=<span class="string">&#x27;用户名为空！&#x27;</span>) <span class="comment">#消息警告框</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">len</span>(name) &gt; <span class="number">10</span>:</span><br><span class="line">            tkinter.messagebox.showwarning(<span class="string">&#x27;Warning&#x27;</span>, message=<span class="string">&#x27;用户名过长！最多为十个字符！&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            root.destroy()</span><br><span class="line">            client.connect((server_host, server_port))  <span class="comment"># 连接服务端，指定主机和端口</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Connecting is successful!&#x27;</span>)</span><br><span class="line">            client.send(name.encode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># 传递用户昵称</span></span><br><span class="line">            ChatRoom(name)  <span class="comment"># 打开聊天窗口</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#登录按钮、输入提示标签、输入框</span></span><br><span class="line">    Button(root, text=<span class="string">&quot;登录&quot;</span>, command=Login_in, width=<span class="number">8</span>, height=<span class="number">1</span>).place(x=<span class="number">100</span>, y=<span class="number">90</span>, width=<span class="number">100</span>, height=<span class="number">35</span>)</span><br><span class="line">    Label(root, text=<span class="string">&#x27;请输入昵称&#x27;</span>, font=(<span class="string">&#x27;Fangsong&#x27;</span>, <span class="number">12</span>)).place(x=<span class="number">10</span>, y=<span class="number">20</span>, height=<span class="number">50</span>, width=<span class="number">80</span>)</span><br><span class="line">    Entry(root, textvariable=nickname, font=(<span class="string">&#x27;Fangsong&#x27;</span>, <span class="number">11</span>)).place(x=<span class="number">100</span>, y=<span class="number">30</span>, height=<span class="number">30</span>, width=<span class="number">180</span>)</span><br><span class="line"></span><br><span class="line">    root.mainloop()</span><br><span class="line"></span><br><span class="line"><span class="comment">#聊天窗口</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ChatRoom</span>(<span class="params">nickname</span>):</span></span><br><span class="line">    root = Tk()</span><br><span class="line">    root.geometry(<span class="string">&#x27;650x400&#x27;</span>)  <span class="comment"># 窗口大小</span></span><br><span class="line">    root.resizable(<span class="number">0</span>, <span class="number">0</span>)  <span class="comment"># 将窗口大小设置为不可变</span></span><br><span class="line">    root.geometry(<span class="string">&#x27;+500+300&#x27;</span>)  <span class="comment"># 改变窗体位置（‘+横坐标+纵坐标’）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># content = client.recv(2048).decode(&#x27;utf-8&#x27;)</span></span><br><span class="line">    <span class="comment"># if content != &#x27;No message.&#x27;:</span></span><br><span class="line">    <span class="comment">#     past_text = content + &#x27;\n------以上是历史消息------\n&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 从服务器端获取当前用户列表</span></span><br><span class="line">    <span class="comment"># UserList = []</span></span><br><span class="line">    <span class="comment"># UserList = client.recv(2048).decode(&#x27;utf-8&#x27;).split(&#x27;,&#x27;)</span></span><br><span class="line">    <span class="comment"># UserList.insert(0, &#x27;------当前用户列表------&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 窗口标题</span></span><br><span class="line">    <span class="comment"># nickname = UserList[len(UserList)-1]</span></span><br><span class="line">    root.title(<span class="string">&#x27;一起来聊天 · &#x27;</span> + nickname)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># name_text = StringVar()</span></span><br><span class="line">    <span class="comment"># name_text.set(UserList)  # 用户列表文本设置</span></span><br><span class="line">    <span class="comment"># listbox1 = Listbox(root, listvariable=name_text)  # 用户列表，使用Listbox组件</span></span><br><span class="line">    <span class="comment"># listbox1.place(x=5, y=0, width=500, height=400)</span></span><br><span class="line"></span><br><span class="line">    img_png = PhotoImage(file=<span class="string">&#x27;QQ图片20220901201640.png&#x27;</span>)</span><br><span class="line">    label_img = Label(root, image=img_png)</span><br><span class="line">    label_img.place(x=<span class="number">400</span>, y=<span class="number">0</span>, width=<span class="number">350</span>, height=<span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#聊天界面</span></span><br><span class="line">    <span class="comment"># content = client.recv(2048).decode(&#x27;utf-8&#x27;)</span></span><br><span class="line">    ChatBox = scrolledtext.ScrolledText(root)  <span class="comment"># 聊天信息窗口，使用ScrolledText组件制作</span></span><br><span class="line">    ChatBox.place(x=<span class="number">5</span>, y=<span class="number">0</span>, width=<span class="number">470</span>, height=<span class="number">300</span>)</span><br><span class="line">    <span class="comment"># ChatBox.pack()</span></span><br><span class="line">    <span class="comment"># ChatBox.insert(&#x27;end&#x27;,content)</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_server</span>(<span class="params">c</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            content = c.recv(<span class="number">2048</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            ChatBox.insert(<span class="string">&#x27;end&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>+content+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            ChatBox.see(tkinter.END)  <span class="comment"># ScrolledText组件方法，自动定位到结尾，否则只有消息在涨，窗口拖动条不动</span></span><br><span class="line">            ChatBox.update()  <span class="comment"># 更新聊天信息窗口，显示新的信息</span></span><br><span class="line">    threading.Thread(target=read_server, args=(client,)).start()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#聊天输入框</span></span><br><span class="line">    word = StringVar()</span><br><span class="line">    word.<span class="built_in">set</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    SentBox = Entry(root,width=<span class="number">140</span>,textvariable=word) <span class="comment">#建一个输入框</span></span><br><span class="line">    SentBox.place(x=<span class="number">5</span>,y=<span class="number">305</span>,width=<span class="number">475</span>,height=<span class="number">90</span>) <span class="comment">#设置大小和位置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#发送按钮</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sendtext</span>():</span></span><br><span class="line">        content = word.get() <span class="comment">#获得文本内容</span></span><br><span class="line">        <span class="keyword">if</span> content==<span class="string">&#x27;end&#x27;</span>:</span><br><span class="line">            client.close()</span><br><span class="line">        client.send(content.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        word.<span class="built_in">set</span>(<span class="string">&#x27;&#x27;</span>) <span class="comment">#用了一个标记记录点击的状态，不管内容是什么点了就变</span></span><br><span class="line"></span><br><span class="line">    sendButton = Button(root, text=<span class="string">&#x27;发 送&#x27;</span>, font=(<span class="string">&#x27;Fangsong&#x27;</span>, <span class="number">18</span>), bg=<span class="string">&#x27;white&#x27;</span>, command=sendtext)</span><br><span class="line">    sendButton.place(x=<span class="number">490</span>, y=<span class="number">308</span>, width=<span class="number">150</span>, height=<span class="number">85</span>)</span><br><span class="line"></span><br><span class="line">    root.mainloop()</span><br><span class="line"></span><br><span class="line">LoginWindow()</span><br></pre></td></tr></table></figure>
<h1 id="实训二阶段"><a class="markdownIt-Anchor" href="#实训二阶段">#</a> 实训二阶段</h1>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Protinx/article/details/124586695">(29 条消息) Cisco Packet Tracer 安装详解_@Protinx 的博客 - CSDN 博客_cisco packet tracer</a></p>
<p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%80%9D%E7%A7%91%E6%A8%A1%E6%8B%9F%E5%99%A8&amp;spm=1001.2101.3001.7020">思科模拟器</a> Cisco Packet <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Tracer&amp;spm=1001.2101.3001.7020">Tracer</a> 是一个功能强大的网络仿真程序，允许学生实验与网络行为。但是这个软件是纯软件模拟，和真实的环境有差距，命令也不全。适合新手教程教学使用。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41625827/article/details/106115226">(29 条消息) 思科 Packet Tracer 基础使用教程_冰镇阔落的博客 - CSDN 博客_cisco packet tracer 教程</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43598138/article/details/104317148">(29 条消息) Cisco Packet Tracer 软件介绍与使用方法_发光吖的博客 - CSDN 博客_packet tracer</a></p>
<ul>
<li>
<p>一般选择高型号的路由器（可支持的命令比较多），在 Packet Tracer 5.3 里面推荐选择 2811 系列路由器。</p>
</li>
<li>
<p>交换机也选择高型号的，推荐选择 2960 系列。（注：2xxx 系列为二层交换机，3xxx 系列为三层交换机。两者交换功能相同，但三层交换机多了路由功能，在一些情况下三层交换机可以代替路由器，但不能完全替代路由器）</p>
<p>交换机（Switch）意为 “<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%BC%80%E5%85%B3/2275072?fromModule=lemma_inlink">开关</a>” 是一种用于电（光）信号转发的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/7667828?fromModule=lemma_inlink">网络设备</a>。它可以为接入交换机的任意两个<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E8%8A%82%E7%82%B9/9338583?fromModule=lemma_inlink">网络节点</a>提供独享的电信号通路。</p>
</li>
<li>
<p>一般情况下选择（自动线）即可，或选择（直通线）。若方案要求选择专线，则需要选择（专线）。方案中线路大多为直通线（即以太网线），少数会有专线要求。<br>
点击一下所要使用的线，然后点击需要连线的设备接口，从一个设备接口连线至另一个设备接口。（注：自动线不需要选择接口，其他两种线需要手动选择接口。直通线选择 Fast 开头的接口，专线选择 Serial 开头的接口）<br>
注：自动线连好为虚线；直通线连好为实线。</p>
</li>
</ul>
<p>交换机是用来连接局域网的，路由器是用来连接互联网的（也可以连接多个局域网）</p>
</blockquote>
<img src="https://zhang2002gz.oss-cn-qingdao.aliyuncs.com/img/image-20220902192351180.png" alt="image-20220902192351180" style="zoom: 50%;">
<p>各线缆两端有不同颜色的圆点，它们分别表示什么样的含义呢？</p>
<table>
<thead>
<tr>
<th>链路圆点的状态</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>亮绿色</td>
<td>物理连接准备就绪，还没有 Line Protocol status 的指示</td>
</tr>
<tr>
<td>闪烁的绿色</td>
<td>连接激活</td>
</tr>
<tr>
<td>红色</td>
<td>物理连接不通，没有信号</td>
</tr>
<tr>
<td>黄色</td>
<td>交换机端口处于 &quot;阻塞&quot; 状态</td>
</tr>
</tbody>
</table>
<blockquote>
<p>路由器和交换机区别</p>
<ul>
<li>路由器：寻址，转发（依靠 IP 地址），交换机：过滤，转发（依靠 MAC 地址）</li>
<li>交换机用于连接局域网，数据包在局域网内网的数据转发，路由器用于连接局域网和外网，数据包可以在不同局域网转发。</li>
<li>交换机工作于 TCP/IP 协议的最后一层数据链路层（物理层），路由器工作于网络层</li>
<li>交换机负责具体的数据包传输，路由器不负责包的实际传输，路由器只封装好要传输的数据包，然后交给交换机去传输（不一定是交换机，可能是其他传输技术），用 java 比喻大概简单理解为路由器是抽象类，定义好传输的数据包格式，交换机是具体实现类，也可以有其他实现类</li>
<li>交换机没有 MAC 地址和 IP 地址，路由器有 MAC 地址和 IP 地址（指纯碎的交换机和路由器，三层交换机是可以有 IP 地址的，路由器也有内置交换机功能的）<br>
原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_21187515/article/details/119416934">https://blog.csdn.net/qq_21187515/article/details/119416934</a></li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Router&gt;enable </span><br><span class="line">Router<span class="comment">#</span></span><br><span class="line">(Router&gt;en)</span><br><span class="line">在用户模式下输入enable即可进入特权模式。第二级别模式，可以对设备进行所有的查看、测试及简单的配置。</span><br><span class="line"></span><br><span class="line">Router<span class="comment">#configure terminal </span></span><br><span class="line">Enter configuration commands, one per line.  End <span class="keyword">with</span> CNTL/Z.</span><br><span class="line">Router(config)<span class="comment">#</span></span><br><span class="line">(Router<span class="comment">#conf t)</span></span><br><span class="line">在特权模式下，输入configure terminal即可进入配置模式。第三级别模式，可以对设备进行管理配置。</span><br><span class="line"></span><br><span class="line">Router(config)<span class="comment">#interface fastEthernet 0/0</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#</span></span><br><span class="line">(Router(config)<span class="comment">#int fa0/0  //定义0/0接口)</span></span><br><span class="line">其他配置模式Router(config-???)<span class="comment">#。第四级别模式，可以对设备进行各种专用配置。如，进入配置设备接口的模式</span></span><br><span class="line"></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#ip address 192.168.1.2 255.255.255.0</span></span><br><span class="line">(Router(config-<span class="keyword">if</span>)<span class="comment">#ip add 192.168.1.254 255.255.255.0)</span></span><br><span class="line">配置ip地址</span><br><span class="line"></span><br><span class="line">R2(config-<span class="keyword">if</span>)<span class="comment">#no shutdown</span></span><br><span class="line">(Router(config-<span class="keyword">if</span>)<span class="comment">#no sh)</span></span><br><span class="line">激活接口</span><br><span class="line"></span><br><span class="line">(Router(config-<span class="keyword">if</span>)<span class="comment">#do wr)</span></span><br><span class="line">Building configuration...</span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#do show ip rou               //显示所有IP路由</span></span><br><span class="line"></span><br><span class="line">C    <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span> <span class="keyword">is</span> directly connected, FastEthernet0/<span class="number">0</span>		//路由表</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">路由器配置</span><br><span class="line">Router&gt;en</span><br><span class="line">Router<span class="comment">#</span></span><br><span class="line">Router<span class="comment">#conf t</span></span><br><span class="line">Router(config)<span class="comment">#int fa0/0                       //定义0/0接口</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#ip add 192.168.1.254 255.255.255.0</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#no sh </span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#int fa0/1                    //定义0/1接口</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#ip add 192.168.2.254 255.255.255.0</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#no sh                        //激活接口</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#do wr</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#do show ip rou               //显示所有IP路由</span></span><br><span class="line">Codes: C - connected, S - static, I - IGRP, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area</span><br><span class="line">       N1 - OSPF NSSA external <span class="built_in">type</span> <span class="number">1</span>, N2 - OSPF NSSA external <span class="built_in">type</span> <span class="number">2</span></span><br><span class="line">       E1 - OSPF external <span class="built_in">type</span> <span class="number">1</span>, E2 - OSPF external <span class="built_in">type</span> <span class="number">2</span>, E - EGP</span><br><span class="line">       i - IS-IS, L1 - IS-IS level-<span class="number">1</span>, L2 - IS-IS level-<span class="number">2</span>, ia - IS-IS inter area</span><br><span class="line">       * - candidate default, U - per-user static route, o - ODR</span><br><span class="line">       P - periodic downloaded static route</span><br><span class="line"> </span><br><span class="line">Gateway of last resort <span class="keyword">is</span> <span class="keyword">not</span> <span class="built_in">set</span></span><br><span class="line"> </span><br><span class="line">C    <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span> <span class="keyword">is</span> directly connected, FastEthernet0/<span class="number">0</span>      //路由表</span><br><span class="line">C    <span class="number">192.168</span><span class="number">.2</span><span class="number">.0</span>/<span class="number">24</span> <span class="keyword">is</span> directly connected, FastEthernet0/<span class="number">1</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39524009/article/details/81073693">(29 条消息) 交换机实验、VLAN 创建_Air_Echo 的博客 - CSDN 博客_创建 vlan</a></p>
</blockquote>
<blockquote>
<p>打开 **【PC 中 &gt;&gt; Desktop &gt;&gt; Commond prompt】**</p>
<p>pc0 上 ping 192.168.20.1 (PC1) 的 ip 地址</p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/VariatioZbw/article/details/108212741">(29 条消息) Cisco Packet Tracer 命令大全 【思科交换机模拟器命令大全】_zhangbw~ 的博客 - CSDN 博客_cisco packet tracer 命令行</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40163937/article/details/88818072">(29 条消息) Cisco Packet Tracer—VLAN 配置详解_HOPEAMOR 的博客 - CSDN 博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_34194317/article/details/92553357">(29 条消息) cisco 交换机 配置一组端口，interface range_weixin_34194317 的博客 - CSDN 博客</a></p>
</blockquote>
<blockquote>
<p>当使用<strong> interface range</strong> 命令时有如下的规则:</p>
<p>有效的组范围:<br>
vlan 从 1 到 4094<br>
fastethernet 槽位 /{first port} - {last port}, 槽位为 0<br>
gigabitethernet 槽位 /{first port} - {last port}, 槽位为 0<br>
port-channel port-channel-number - port-channel-number, port-channel 号从 1 到 64<br>
 端口号之间需要加入空格，如：interface range fastethernet 0/1 – 5 是有效的，而 interface range fastethernet 0/1-5 是无效的.<br>
interface range 命令只能配置已经存在的 interface vlan<br>
 所有在同一组的端口必须是相同类别的。<br>
见以下例子:</p>
<p>Switch# configure terminal<br>
Switch(config)# interface range fastethernet0/1 - 5</p>
</blockquote>
<blockquote>
<p><strong>#switch trunk encapsulation dot1q</strong></p>
<p><strong>IEEE 802.1Q 协议</strong>，是 vlan 的一种封装方式，是公有协议。 还有一种 trunk 协议，是 ISL，也是 vlan 的一种封装方式，不过这是 Cisco 思科私有协议，其他厂商不能用。</p>
<p><strong>#switchport trunk</strong> 是配置允许通过的 vlan；<br>
　　switchport mode trunk 是将端口配置成 trunk 模式；<br>
　　mode trunk // 端口模式为 trunk<br>
　　switchport trunk encapsulation dot1q //trunk 协议封装为 dot1q<br>
　　dot1q 就是 IEEE 802.1Q 协议，是 vlan 的一种封装方式，是公有协议。<br>
　　还有一种 trunk 协议，是 ISL，也是 vlan 的一种封装方式，不过这是 Cisco 思科私有协议，其他厂商不能用。</p>
</blockquote>
<h2 id="实训1局域网分层结构"><a class="markdownIt-Anchor" href="#实训1局域网分层结构">#</a> 实训 1：局域网分层结构</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.基本任务</span><br><span class="line">三层交换上实现VLAN间路由；</span><br><span class="line">两层交换机上划分VLAN；</span><br><span class="line">VLAN数目不少于2个；</span><br><span class="line">自行规划IP地址</span><br></pre></td></tr></table></figure>
<blockquote>
<p>技术原理</p>
<ul>
<li>三层交换机具备网络层的功能，实现 VLAN 相互访问的原理是：利用三层交换机的路由功能，通过识别数据包的 IP 地址，查找路由表进行选路转发，三层交换机利用直连路由可以实现不同 VLAN 之间的相互访问。</li>
<li>三层交换机给接口配置 IP 地址。采用 SVI（交换虚拟接口）的方式实现 VLAN 间互连。<strong>SVI 是指为交换机中的 VLAN 创建虚拟接口，并且配置 IP 地址</strong>。</li>
<li>Tag VLAN 是基于交换机端口的一种类型，主要用于<strong>使交换机的相同 Vlan 内的主机之间</strong>可以直接访问，同时对于不同 Vlan 的主机进行隔离。</li>
<li>trunk 主要用在<strong>连接其它交换机</strong>，以便在线路上承载多个 vlanWLAN 是 Wireless Local Area Network 的简称，指应用无线通信技术将计算机设备互联起来，构成可以互相通信和实现资源共享的网络体系。</li>
<li>802.1x 协议是 WLAN 第二代的认证技术，它是基于客户端 - 服务器（Client-Server) 结构的访问控制和认证协议。它可以限制未经授权的用户 / 设备通过接入端口（Access Port) 访问 LAN/WLAN。</li>
<li>DOT1Q 是提供 VLAN 识别和服务质量 (QoS) 级别的 IEEE 标准。电气和电子工程师协会（IEEE，全称是 Institute of Electrical and Electronics Engineers）是一个美国的电子技术与信息科学工程师的协会，是世界上最大的非营利性专业技术学会。</li>
<li>ip routing 启用 IP 路由功能 no ip routing 关闭 IP 路由功能</li>
</ul>
</blockquote>
<blockquote>
<p><strong>二层交换机与三层交换机区别</strong></p>
<p>我们习惯说，<strong>在二层网络环境中相同 vlan 之间可以通信，不同 vlan 之间不可以通信，如果想通信必须借助三层设备</strong>，所以说<strong>三层交换机必须要做的事情是路由转发</strong>，但是二、三层交换机具体有什么区别呢？</p>
<ul>
<li>
<p>二层交换机工作于 OSI 模型的第 2 层 (数据链路层)，故而称为二层交换机。二层交换技术发展比较成熟，二层交换机属数据链路层设备，可以<strong>识别数据包中的 MAC 地址信息，根据 MAC 地址进行转发</strong>，并将这些 MAC 地址与对应的端口记录在自己内部的一个地址表中。具体的工作流程如下：</p>
<p>（1） 当交换机从某个端口收到一个数据包，它先读取包头中的源 MAC 地址，这样它就知道源 MAC 地址的机器是连在哪个端口上的；</p>
<p>（2） 再去读取包头中的目的 MAC 地址，并在地址表中查找相应的端口；</p>
<p>（3） 如表中有与这目的 MAC 地址对应的端口，把数据包直接复制到这端口上；</p>
<p>（4） 如表中找不到相应的端口则把数据包广播到所有端口上，当目的机器对源机器回应时，交换机又可以学习一目的 MAC 地址与哪个端口对应，在下次传送数据时就不再需要对所有端口进行广播了。</p>
<p>​	不断的循环这个过程，对于全网的 MAC 地址信息都可以学习到，二层交换机就是这样建立和维护它自己的地址表。二层交换技术从网桥发展到 VLAN（虚拟局域网），在局域网建设和改造中得到了广泛的应用。第二层交换技术是工作在 OSI 七层网络模型中的第二层，即数据链路层。它按照所接收到数据包的目的 MAC 地址来进行转发，对于网络层或者高层协议来说是透明的。<strong>它不处理网络层的 IP 地址</strong>，不处理高层协议的诸如 TCP、UDP 的端口地址，它只需要数据包的物理地址即 MAC 地址，<strong>数据交换是靠硬件来实现的，其速度相当快，这是二层交换的一个显著的优点</strong>。但是，它<strong>不能处理不同 IP 子网之间的数据交换</strong>。</p>
<p>​	传统的路由器可以处理大量的跨越 IP 子网的数据包，但是它的转发效率比二层低，因此要想利用二层转发效率高这一优点，又要处理三层 IP 数据包，三层交换技术就诞生了。</p>
</li>
<li>
<p>三层交换（也称多层交换技术，或 IP 交换技术）是相对于传统交换概念而提出的。众所周知，传统的交换技术是在 OSI 网络标准模型中的第二层 —— 数据链路层进行操作的，而三层交换技术是在网络模型中的第三层实现了数据包的高速转发。简单地说，** 三层交换技术就是：二层交换技术＋三层转发技术。** 三层交换机就是具有部分路由器功能的交换机。三层交换机的最重要目的是加快大型局域网内部的数据交换，所具有的路由功能也是为这目的服务的，能够做到一次路由，多次转发。对于数据包转发等规律性的过程由硬件高速实现，而像路由信息更新、路由表维护、路由计算、路由确定等功能，由软件实现。三层交换技术就是二层交换技术 + 三层转发技术。三层交换技术的出现，解决了局域网中网段划分之后，网段中子网必须依赖路由器进行管理的局面，解决了传统路由器低速、复杂所造成的网络瓶颈问题。</p>
</li>
</ul>
</blockquote>
<p><img src="https://img2020.cnblogs.com/blog/1280419/202004/1280419-20200425105756156-1041750903.png" alt="img"></p>
<blockquote>
<p>实验步骤</p>
<p>1）在二层交换机上配置 VLAN2、VLAN3，分别将端口 2、端口 3 划分给 VLAN2、VLAN3。<br>
（2）<strong>将二层交换机与三层交换机相连的端口 fa 0/1 都定义为 tag Vlan 模式。</strong><br>
（3）在三层交换机上配置 VLAN2、VLAN3，此时验证二层交换机 VLAN2、VLAN3 下的主机之间不能相互通信。<br>
（4）设置三层交换机 VLAN 间的通信，创建 VLAN2,VLAN3 的虚接口，并配置虚接口 VLAN2、VLAN3 的 IP 地址。<br>
（5）查看三层交换机路由表。<br>
（6）将二层交换机 VLAN2、VLAN3 下的主机默认网关分别设置为相应虚拟接口的 IP 地址。<br>
（7）验证二层交换机 VLAN2,VALN3 下的主机之间可以相互通信。</p>
</blockquote>
<blockquote>
<p><strong>switchport access vlan 3</strong><br>
 语法：<br>
switchport access vlan vlan-id<br>
no switchport access vlan</p>
<p><strong>该命令把一个 Access 接口指派给一个 VLAN</strong>。使用 no 选项可以把接口指派到缺省的 VLAN 中。</p>
<p>缺省值：接口缺省的 VLAN 是 VLAN 1。</p>
<p>命令模式：接口配置模式</p>
<p>适用接口：2 层物理接口。</p>
<p>说明：如果指定的 VLAN 不存在，则系统会创建这个 VLAN，并把接口设置为该 VLAN 的成员。如果指定的 VLAN 已经存在，则把接口添加到该 VLAN 中。如果接口是一个 Trunk 口，该操作没有任何作用。可以用 show vlan 命令查看 VLAN 信息。</p>
<p>范例：<br>
Ruijie(config)# interface f0/1<br>
Ruijie(config)# switchport<br>
Ruijie(config-if)# switchport access vlan 10<br>
 本例把 <strong>FastEthernat 0/1 口设置为 2 层口，并把它加入到 VLAN 10 中。</strong></p>
<p><strong>#switchport mode trunk</strong></p>
<p>语法：</p>
<p access | trunk>switchport mode</p>
<p>no switchport mode</p>
<p>该命令 ** 指定一个 2 层接口的模式，可以把接口指定为 access 接口或者 trunk 接口。** 使用 no 选项可以把接口模式恢复为缺省值。</p>
<p>缺省值：接口的缺省模式是 access。</p>
<p>命令模式：接口配置模式</p>
<p>适用接口：2 层物理接口、2 层 Aggregateport 接口。</p>
<p>说明：如果一个接口的模式是 access，则该接口只能成为一个 VLAN 的成员，可以使用 switchport access vlan 命令把它指定给一个 VLAN；如果一个接口的模式是 trunk，则该接口可以是多个 VLAN 的成员，可以用 switchport trunk 命令定义许可 VLAN 列表决定它所在的 VLAN。</p>
<p>范例：</p>
<p>Ruijie(config)# interface f0/1<br>
Ruijie(config-if)# switchport mode trunk<br>
<strong> 本例把 FastEthernat 0/1 口设置为 Trunk 接口。</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ahleung/article/details/100102099">(29 条消息) Switchport 详细用法_天地良心的博客 - CSDN 博客</a></p>
</blockquote>
<blockquote>
<p>三个空的的口令分别是：</p>
<ol>
<li>interface e0 // 根据图示这个是 E0 口。</li>
<li>192.168.2.1 255.255.255.0 //R1 的 S0 接口的 IP 地址和子网掩码。</li>
<li>s0 // 这个是送出接口</li>
</ol>
<p><strong>ip routing 是用在三层交换机上打开路由功能，默认是关闭的</strong>，ip router ospf 是在路由器上启用 ospf 等路由协议，ospf 后面还要加个进程号，范围是 0-65535，只具有本地意义</p>
<p>ip routing 启用 IP 路由功能：</p>
<ol>
<li>
<p>配置三层交换机启动路由功能：ip routing 。</p>
</li>
<li>
<p>配置 VLAN IP 地址：</p>
<p>interface vlan vlan-id</p>
<p>Ip address ip-address subnet-mask</p>
<p>No shutdown</p>
</li>
<li>
<p>配置接口为三层模式：</p>
<p>no switchport</p>
</li>
<li>
<p>配置 DHCP 中继转发：</p>
<p>int vlan vlan-i</p>
<p>Ip helper-address Dhcpserver-address</p>
</li>
<li>
<p>配置静态路由：</p>
<p>ip route targetnet-address netmask nexthop-address</p>
</li>
<li>
<p>配置 RIP 协议：</p>
<p>router rip</p>
</li>
<li>
<p>查看 FIB 表：</p>
<p>show ip cef</p>
</li>
<li>
<p>查看邻接关系表：</p>
<p>show adjacency detail</p>
</li>
<li>
<p>查看路由表：</p>
<p>show ip route</p>
</li>
</ol>
</blockquote>
<blockquote>
<p>PC1	IP: 192.168.1.2   Submark: 255.255.255.0   Gateway: 192.168.1.1</p>
<p>PC2	IP: 192.168.2.2   Submark: 255.255.255.0   Gateway: 192.168.2.1</p>
<p>PC3    IP: 192.168.1.3   Submark: 255.255.255.0   Gateway: 192.168.1.1</p>
<p>二层交换机<br>
<strong> Switch&gt;en</strong><br>
<strong>Switch#conf t</strong><br>
Enter configuration commands, one per line. End with CNTL/Z.</p>
<p><strong>Switch(config)#vlan 2</strong><br>
<strong>Switch(config-vlan)#exit</strong><br>
<strong>Switch(config)#vlan 3</strong></p>
<p><strong>Switch(config-vlan)#int fa 0/2</strong><br>
<strong>Switch(config-if)#switchport access vlan 2</strong><br>
Switch(config-if)#int fa 0/3<br>
Switch(config-if)#switchport access vlan 3</p>
<p><strong>Switch(config-if)#int fa 0/1</strong><br>
<strong>Switch(config-if)#switchport mode trunk</strong></p>
<p>%LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/1, changed state to down</p>
<p>%LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/1, changed state to up</p>
<p><strong>Switch(config-if)#end</strong><br>
Switch#<br>
%SYS-5-CONFIG_I: Configured from console by console</p>
<p><strong>Switch#show vlan</strong></p>
<p>VLAN Name Status Ports</p>
<hr>
<p>1 default active Fa0/4, Fa0/5, Fa0/6, Fa0/7<br>
Fa0/8, Fa0/9, Fa0/10, Fa0/11<br>
Fa0/12, Fa0/13, Fa0/14, Fa0/15<br>
Fa0/16, Fa0/17, Fa0/18, Fa0/19<br>
Fa0/20, Fa0/21, Fa0/22, Fa0/23<br>
Fa0/24, Gig1/1, Gig1/2<br>
2 VLAN0002 active Fa0/2<br>
3 VLAN0003 active Fa0/3<br>
1002 fddi-default act/unsup<br>
1003 token-ring-default act/unsup<br>
1004 fddinet-default act/unsup<br>
1005 trnet-default act/unsup</p>
<p>VLAN Type SAID MTU Parent RingNo BridgeNo Stp BrdgMode Trans1 Trans2</p>
<hr>
<p>1 enet 100001 1500 - - - - - 0 0<br>
2 enet 100002 1500 - - - - - 0 0<br>
3 enet 100003 1500 - - - - - 0 0<br>
1002 fddi 101002 1500 - - - - - 0 0<br>
–More–</p>
</blockquote>
<blockquote>
<p>三层交换机<br>
<strong> Switch&gt;en</strong><br>
<strong>Switch#conf t</strong><br>
Enter configuration commands, one per line. End with CNTL/Z.</p>
<p><strong>Switch(config)#vlan 2</strong><br>
<strong>Switch(config-vlan)#exit</strong><br>
<strong>Switch(config)#vlan 3</strong><br>
<strong>Switch(config-vlan)#exit</strong></p>
<p><strong>Switch(config)#int fa 0/1</strong><br>
<strong>Switch(config-if)#switchport trunk encapsulation dot1q</strong><br>
<strong>Switch(config-if)#switchport mode trunk</strong><br>
<strong>Switch(config-if)#switchport trunk allowed vlan 2,3</strong><br>
<strong>Switch(config-if)#exit</strong></p>
<p><strong>Switch(config)#int fa 0/2</strong><br>
<strong>Switch(config-if)#switchport access vlan 2</strong><br>
<strong>Switch(config-if)#exit</strong></p>
<p><strong>Switch(config)#int vlan 2</strong></p>
<p>%LINK-5-CHANGED: Interface Vlan2, changed state to up</p>
<p>%LINEPROTO-5-UPDOWN: Line protocol on Interface Vlan2, changed state to up<br>
<strong>Switch(config-if)#ip address 192.168.1.1 255.255.255.0</strong><br>
<strong>Switch(config-if)#no shutdown</strong><br>
<strong>Switch(config-if)#exit</strong><br>
Switch(config)#int vlan 3</p>
<p>%LINK-5-CHANGED: Interface Vlan3, changed state to up</p>
<p>%LINEPROTO-5-UPDOWN: Line protocol on Interface Vlan3, changed state to up<br>
Switch(config-if)#ip address 192.168.2.1 255.255.255.0<br>
Switch(config-if)#no shutdown<br>
Switch(config-if)#exit</p>
<p><strong>Switch(config)#ip routing</strong><br>
<strong>Switch(config)#exit</strong><br>
Switch#<br>
%SYS-5-CONFIG_I: Configured from console by console</p>
<p><strong>Switch#show ip route</strong><br>
Codes: C - connected, S - static, I - IGRP, R - RIP, M - mobile, B - BGP<br>
D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area<br>
N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2<br>
E1 - OSPF external type 1, E2 - OSPF external type 2, E - EGP<br>
i - IS-IS, L1 - IS-IS level-1, L2 - IS-IS level-2, ia - IS-IS inter area</p>
<ul>
<li>
<ul>
<li>candidate default, U - per-user static route, o - ODR<br>
P - periodic downloaded static route</li>
</ul>
</li>
</ul>
<p>Gateway of last resort is not set</p>
<p>C 192.168.1.0/24 is directly connected, Vlan2<br>
C 192.168.2.0/24 is directly connected, Vlan3</p>
<p><strong>Switch#show vlan</strong></p>
<p>VLAN Name Status Ports</p>
<hr>
<p>1 default active Fa0/3, Fa0/4, Fa0/5, Fa0/6<br>
Fa0/7, Fa0/8, Fa0/9, Fa0/10<br>
Fa0/11, Fa0/12, Fa0/13, Fa0/14<br>
Fa0/15, Fa0/16, Fa0/17, Fa0/18<br>
Fa0/19, Fa0/20, Fa0/21, Fa0/22<br>
Fa0/23, Fa0/24, Gig0/1, Gig0/2<br>
2 VLAN0002 active Fa0/2<br>
3 VLAN0003 active<br>
1002 fddi-default act/unsup<br>
1003 token-ring-default act/unsup<br>
1004 fddinet-default act/unsup<br>
1005 trnet-default act/unsup</p>
<p>VLAN Type SAID MTU Parent RingNo BridgeNo Stp BrdgMode Trans1 Trans2</p>
<hr>
<p>1 enet 100001 1500 - - - - - 0 0<br>
2 enet 100002 1500 - - - - - 0 0<br>
3 enet 100003 1500 - - - - - 0 0<br>
1002 fddi 101002 1500 - - - - - 0 0<br>
–More–</p>
</blockquote>
<blockquote>
<p>PC1 分别 ping PC2 和 PC3</p>
<p><strong>PC&gt;ipconfig IP</strong></p>
<p>Address…: 192.168.1.2</p>
<p>Subnet Mask…: 255.255.255.0</p>
<p>Default Gateway…: 192.168.1.1</p>
<p><strong>PC&gt;ping 192.168.2.2</strong></p>
<p>Pinging 192.168.2.2 with 32 bytes of data:</p>
<p>Request timed out.</p>
<p>Reply from 192.168.2.2: bytes=32 time=25ms TTL=127</p>
<p>Reply from 192.168.2.2: bytes=32 time=20ms TTL=127</p>
<p>Reply from 192.168.2.2: bytes=32 time=20ms TTL=127</p>
<p>Ping statistics for 192.168.2.2:</p>
<p>Packets: Sent = 4, Received = 3, Lost = 1 (25% loss), Approximate round trip times in milli-seconds: Minimum = 20ms, Maximum = 25ms, Average = 21ms</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2.拓展任务</span><br><span class="line">使用VTP管理交换机</span><br><span class="line">启用快速生成树，采用线路冗余的方式增加可靠性。</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zoulongbin/p/9047390.html">https://www.cnblogs.com/zoulongbin/p/9047390.html</a></p>
<p>VTP 的工作原理</p>
<p>VTP：虚拟局域网中继协议，VTP 是一种消息协议，它使用第二层帧，<strong>在交换机之间传递 VLAN 信息</strong>，被称为 VTP 通告。<strong>有了 VTP 通告就可以再一台交换机上集中修改 VLAN 配置，所做的修改会被自动传播到网络中的其他交换机，从而实现 VLAN 配置的一致性。</strong></p>
<p>VTP 域：也称为 VLAN 管理域，由一个以上共享 VTP 域名相连接的交换机组成。也就是说，VTP 域是一组 VTP 域名相同并通过中继链路互相连接的交换机。使用 VTP 首先需要建立一个 VTP 管理域，在同一管理域中的交换机共享他们的 VLAN 信息，并且<strong>一个交换机只能参加一个 VTP 管理域</strong>。</p>
<p>配置 VTP 域的要求如下：</p>
<p>1、域内的每台交换机都必须使用相同的 VTP 域名。</p>
<p>2、交换机必须是相邻的，即相邻的交换机并具有相同的域名。</p>
<p>3、交换机之前必须配置中继链路 (也就是 Trunk)。</p>
<p>它不通告自己的 VLAN 配置信息，对收到的 VTP 通告只转发而不会学习与更改自己的 VLAN 信息。</p>
</blockquote>
<blockquote>
<p>VTP 的模式</p>
<p>1、服务器模式：充当 VTP 服务器模式的交换机负责它所在域中 VLAN 信息的管理工作。VTP 服务器可以创建、删除或修改 VLAN，并向外发送 VTP 通告，同时，VTP 服务器也会学习域名相同的 VTP 通告信息。</p>
<p>2、客户机模式：处于 VTP 客户机模式的交换机不允许管理创建，删除或修改 VLAN。它们监听本域中其他交换机的 VTP 通告，并相应修改它们自己的 VTP 配置。</p>
<p>3、透明模式：VTP 透明模式中的交换机不参与 VTP。当交换机处于透明模式时，它可以创建，删除或修改本地的 VLAN 信息，但</p>
</blockquote>
<blockquote>
<p>VTP 通告</p>
<p>使用 VTP 时，加入 VTP 域的每台交换机在其中继端口上通告如下信息：</p>
<p>1、管理域 (即 VTP 的域名信息)</p>
<p>2、版本号 (使用 VTP 的版本号，只要校验服务器和客户机模式的版本是否一致)</p>
<p>3、配置修改编号 (默认为 0，当修改 VTP 域的配置之后，此编号会加 1)</p>
<p>4、它所知道的 VLAN (即 VTP 中的所有 VLAN)</p>
<p>5、每个 VLAN 的某些参数 (vlan 的相关信息)</p>
<p>注意：当一台修改编号高于此 VTP 域中的修改编号的交换机加入此 VTP 域时，此交换机的中的 VLAN 配置会覆盖所有 VTP 域中的 VLAN 配置，所以将交换机加入 VTP 域时要格外小心。我们可以将交换机的 VTP 模式改为透明模式，再改回服务器模式或交换机模式，或者是将交换机的域名更改一下在改回来，就可以将交换机的修改编号初始为 0。</p>
</blockquote>
<blockquote>
<p>VTP 修剪</p>
<p>VTP 修剪是 VTP 的一个功能，它能减少中继链路上不必要的广播流量。</p>
</blockquote>
<blockquote>
<p>配置 VTP 实例</p>
<p>在配置 VTP 之前，我们需要将<strong> VTP 服务器和 VTP 客户机之间的链路设置为中继链路</strong>。</p>
<p>列如：将 Switch1 和 Switch2 的 24 号端口设置为 trunk 中继链路。</p>
<p>Switch1(config)#int f0/24</p>
<p>Switch1(config)#switchport mode trunk</p>
<p>Switch1(config)#no sh</p>
<p>Switch2(config)#int f0/24</p>
<p>Switch2(config)#switchport mode trunk</p>
<p>Switch2(config)#no sh</p>
<p>配置 VTP 服务器模式</p>
<p>列如：将 Switch1 配置为 VTP 服务器，域名为 test，秘密为 123，配置 VTP 修剪。</p>
<p>Switch1#config terminal</p>
<p>Switch1(config)#vtp domain test</p>
<p>Switch1(config)#vtp mode server</p>
<p>SWitch1(config)#vtp passwd 123</p>
<p>Switch1(config)#vtp pruning</p>
<p>配置 VTP 客户机模式</p>
<p>列如：将 Switch2 配置为 VTP 客户机，域名和密码必须和服务器器一致，否则将不匹配。</p>
<p>Switch2#config terminal</p>
<p>Switch2(config)#vtp domain test</p>
<p>Switch2(config)#vtp mode client</p>
<p>SWitch2(config)#vtp passwd 123</p>
<p>Switch2(config)#vtp pruning</p>
<p>此时 VTP 服务器和 VTP 客户端就配置完成了，现在只需要在 VTP 服务器端创建 VLAN，VTP 客户端就可以自动学习到服务器端创建的 VLAN，而不需要自己创建 VLAN，但是注意，虽然 VTP 客户端可是自动学习 VLAN，但是将端口加入 VLAN 的动作是不可以学习的，所以在客户端需要手动将端口添加到相应的 VLAN 中。</p>
</blockquote>
<blockquote>
<p>Unable to perform trunk negotiation on port Fa0/23 because of VTP domain mismatch 这句话是什么意思？？是不能开启 trunk 在 f0/23 上！！因为 VTP 的域名错了！！你 VTP 配置的时候是不是名字有问题？？要就是配置一个！！要就是两边一样的！！不要两边不一样的！</p>
</blockquote>
<h2 id="实训2-多域ospf"><a class="markdownIt-Anchor" href="#实训2-多域ospf">#</a> 实训 2 多域 OSPF</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">要求：</span><br><span class="line">配置多域OSPF；</span><br><span class="line">Loopback口相当于PC；</span><br><span class="line">基本配置内容自主网络搜索。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>OSPF 多用于大型 IPv4 网络，是基于链路状态的路由协议，与基于距离矢量的路由协议相比具有更快的收敛速度，支撑的网络规模也更大。</p>
<p>OSPF（Open Shortest Path First）是 IETF 组织开发的一个基于链路状态的内部网关协议。目前针对 IPv4 协议使用的是 OSPF Version 2（RFC2328）。OSPF 是不属于任何一个厂商或组织私有的路由协议，使用 Dijkstra 的最短路径（SPF）算法计算路由。在 OSPF 中引入了区域的概念，有效的减少了路由选择协议对路由器 CPU 和内存的占用，同时也降低了路由选择协议的通信量，使得构建大型层次化网络成为可能</p>
</blockquote>
<blockquote>
<p><strong>duplex auto</strong> 是双工的协商模式为自动<br>
双工模式有两种，一种是 full（全双工），一种是 half（半双工）<br>
<strong>speed auto</strong> 是速率为协商模式为自动<br>
一般的 100M 口支持: 10M，100M 和自动模式</p>
<p>选择为自动模式则接口会和对端设备的接口进行协商，并自动选择最佳模式。</p>
</blockquote>
<blockquote>
<p><strong>#ip access-group 10 out</strong></p>
<p>将列表 10 所定义的条件应用禁止从此接口出去</p>
<p>该命令的详细说明如下：<br>
ip access-group {[access-list-number] |[ name]} [in | out]<br>
no ip access-group {[access-list-number] |[ name]} [in | out]</p>
<p>功能：将指定的访问列表应用到相关接口，并且指定 acl 起作用的方向。本命令的 no 操作为解除访问列表应用到相关接口，若没有指定方向，则默认为 out；<br>
若没有指定具体的 [access-list-number] 或 [name] 而指定了方向，则默认为删除该方向上所有的访问列表的应用；若没有指定具体的 [access-list-number] 或 [name] 也没有指定方向，则默认为删除 out 方向上所有的访问列表的应用。</p>
<p>参数：[access-list-number] 为访问表表号，取值范围 1～199；[name] 为由 ip access-list 命令指定的访问表名字，最长不超过 8 个字符；in 为过滤入口的包；out 为过滤出口的包。</p>
<p>缺省情况：没有任何访问表被应用至任何接口。若指定了绑定，而未指定方向，缺省为 out。</p>
<p>命令模式：接口配置模式</p>
<p>使用指南：在访问列表应用到具体接口的具体方向之前，访问列表的规则是不起作用的。每个接口定义两个方向，即 in 和 out 方向。前者代表流入接口的方向，<br>
后者代表流出接口的方向。规则可单独对 in 或 out 方向起作用，即只过滤入口的包或只过滤出口方向上的包，也可以两个方向都过滤。</p>
<p>应用到接口上的访问列表可以有多条，但只能有一条标准访问列表，对扩展访问列表来说，一个接口一个方向相同协议的访问列表只能有一条。访问列表的协议是指</p>
<p>每个表的协议缺省为这个表的第一条规则中指定要过滤的协议。若通过的信息包符合多条规则，则只有匹配的第一条规则有作用，匹配的顺序与规则应用到接口的先<br>
后顺序一致。若规则中含有相互冲突的设置，以第一条匹配到的规则为准。</p>
<p>在当前时间不在分段时间过滤访问表设定的时间段时，将分段时间过滤访问表应用到接口是不起作用的，但等时间进入设定的时间段后，曾经应用到接口的分段时间过滤访问表会自动生效。</p>
</blockquote>
<p><img src="https://img-blog.csdn.net/20160629191708718?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="img"></p>
<blockquote>
<p><strong>router ospf 10</strong></p>
<p>Router ospf 10 中的 10 是这台<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%B7%AF%E7%94%B1%E5%99%A8&amp;spm=1001.2101.3001.7020">路由器</a> Ospf 进程的 ID 号！<br>
路由器和我们的 PC 一样，是多任务系统，理论上能够支持多个 OSPF 进程同时运行！此 ID 号仅本地有效！ <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=SNMP&amp;spm=1001.2101.3001.7020">SNMP</a> 是网络管理协议，OSPF<br>
 是路由协议，两者就不是一个东西，不能相提并论！</p>
<p><strong>log-adjacency-changes</strong></p>
<p><strong>log-adjacency-changes 命令</strong>可用来激活路由协议邻接关系变化日志的功能（例如 ospf 或者 ISIS 等）。使用该命令来生成 SYSLOG 信息以用于网络操作与管理。日志信息对于故障排除也非常有用。log-adjacency-changes 是一个日志开关，意思是<strong>当 OSPF 探测到邻居关系发生变化时，将变化情况记录在系统日志里面</strong>！</p>
<p><strong>network 192.168.233.160 0.0.0.3 area 1</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">network 192.168.233.164 0.0.0.3 area 1 </span><br><span class="line">network 192.168.233.168 0.0.0.3 area 1 </span><br><span class="line">network 192.168.233.172 0.0.0.3 area 1 </span><br><span class="line">network 192.168.233.176 0.0.0.3 area 1 </span><br><span class="line">network 192.168.233.184 0.0.0.3 area 1 </span><br><span class="line">network 192.168.233.188 0.0.0.3 area 1 </span><br><span class="line">network 192.168.233.192 0.0.0.3 area 1 </span><br><span class="line">network 192.168.233.196 0.0.0.3 area 1 </span><br><span class="line">network 192.168.233.200 0.0.0.3 area 1 </span><br><span class="line">network 192.168.233.204 0.0.0.3 area 1</span><br><span class="line">network 10.228.1.0      0.0.0.15 area 1 </span><br></pre></td></tr></table></figure>
<p>是使用 OSPF 向邻居发布路由信息！ area 1 是 OSPF 路由域中的 区域 1，ospf 路由域分为骨干区域和非骨干区域，只有 area 0 是骨干区域，其他都是非骨干区域！<br>
0.0.0.3 表示： 反掩码，表示匹配反掩码为 1 的位<br>
 0.0.0.255 实际上是 0.0.0.1111 1111 只要 192.168.2.xxxx xxxx 的网段就应用该路由 我自己把反掩码中的 0 理解为固定位，1 理解为自由位。固定位就是不能变的，自由位是能变的，其实就是对前面 ip 的修饰，固定位就是他的网络段</p>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_31828929/article/details/71191679">https://blog.csdn.net/qq_31828929/article/details/71191679</a></p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PC与路由器的接口配置：</span><br><span class="line">interface FastEthernet0/<span class="number">0</span></span><br><span class="line"> </span><br><span class="line">ip address <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> </span><br><span class="line">duplex <span class="keyword">auto</span></span><br><span class="line">    </span><br><span class="line">speed <span class="keyword">auto</span></span><br><span class="line">    </span><br><span class="line">[(<span class="number">30</span>条消息) 思科实验之配置ACL_晚风挽着浮云的博客-CSDN博客_思科配置acl](https:<span class="comment">//blog.csdn.net/weixin_57636278/article/details/123912132)</span></span><br><span class="line">                                              </span><br><span class="line">interface FastEthernet0/<span class="number">0</span></span><br><span class="line">ip address <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">no shutdown</span><br><span class="line"><span class="built_in">exit</span>                                              </span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">R1:</span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">172.16</span><span class="number">.10</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> no shutdown                          #开启接口</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">router ospf <span class="number">10</span>                        #开启ospf 进程号为<span class="number">10</span></span><br><span class="line">network <span class="number">172.16</span><span class="number">.10</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">1</span>  #宣告直连的网段；网段的反掩码；其直连的网段属于area1区域</span><br><span class="line">R2:</span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">172.16</span><span class="number">.10</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> no shu</span><br><span class="line">interface GigabitEthernet0/<span class="number">1</span></span><br><span class="line"> ip address <span class="number">172.16</span><span class="number">.20</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> no shu</span><br><span class="line"> <span class="built_in">exit</span></span><br><span class="line">router ospf <span class="number">10</span></span><br><span class="line"> network <span class="number">172.16</span><span class="number">.10</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">1</span>  #宣告直连，其直连的网段属于area1 区域</span><br><span class="line"> network <span class="number">172.16</span><span class="number">.20</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span>  #area0是骨干区域</span><br><span class="line"> R3：</span><br><span class="line"> interface GigabitEthernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">172.16</span><span class="number">.20</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> no shu</span><br><span class="line">interface GigabitEthernet0/<span class="number">1</span></span><br><span class="line"> ip address <span class="number">172.16</span><span class="number">.30</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> no shu</span><br><span class="line"> <span class="built_in">exit</span></span><br><span class="line">router ospf <span class="number">10</span></span><br><span class="line"> network <span class="number">172.16</span><span class="number">.20</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br><span class="line"> network <span class="number">172.16</span><span class="number">.30</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">2</span></span><br><span class="line"> R4：</span><br><span class="line"> interface GigabitEthernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">172.16</span><span class="number">.30</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> no shu</span><br><span class="line"> <span class="built_in">exit</span></span><br><span class="line">router ospf <span class="number">10</span></span><br><span class="line"> network <span class="number">172.16</span><span class="number">.30</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">2</span></span><br><span class="line"> </span><br><span class="line"> show ip route</span><br><span class="line"> ping <span class="number">172.16</span><span class="number">.30</span><span class="number">.2</span></span><br><span class="line">    </span><br><span class="line"> https:<span class="comment">//blog.csdn.net/zhangzc0408/article/details/124372279</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Loopback</strong> 是路由器里面的一个逻辑接口。逻辑接口是指能够实现数据交换功能，但是物理上不存在、需要通过配置建立的接口。Loopback 接口一旦被创建，其物理状态和链路协议状态永远是 Up，即使该接口上没有配置 IP 地址</p>
<p>Loopback 接口创建后一直保持 UP 状态，用户可通过配置 Loopback 接口达到提高网络可靠性的目的。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/JackLiu16/article/details/80296461">(30 条消息) Loopback 接口的主要作用及 Loopback 端口配置_JackLiu16 的博客 - CSDN 博客_交换机 loopback 接口</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15624911/5287875">OSPF 多域配置_wx627255bd4ac6d 的技术博客_51CTO 博客</a></p>
</blockquote>
<h2 id="实训3-路由交换综合"><a class="markdownIt-Anchor" href="#实训3-路由交换综合">#</a> 实训 3 路由交换综合</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">实训要求</span><br><span class="line">1.试验台环境：路由器为2811，交换机3560、2950；</span><br><span class="line">2.规划IP，配置接口，启动静态或动态路由协议，保障网络连通性；</span><br><span class="line">3.划分两个VLAN，VLAN 10采用192.168.10.0/24，VLAN 20采用192.168.20.20；</span><br><span class="line">4.能够实现VLAN间路由；</span><br><span class="line">5.禁止VLAN 20中的主机访问WWW服务，但不禁止Ping （VLAN10中主机可以访问WWW）。</span><br><span class="line">6.VLAN 20需要配置DHCP。</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20200723091948207.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0MDE4Njky,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44018692/article/details/107529914">(30 条消息) 交换机与路由器的通信的配置（2020.7.15）_penguinhd 的博客 - CSDN 博客</a></p>
<blockquote>
<p>SW13</p>
<p>Enable<br>
Conf t<br>
Vlan 10<br>
Exit<br>
Interface f0/1<br>
Switchport access vlan 10<br>
Exit<br>
Interface f0/2<br>
Switchport mode trunk</p>
</blockquote>
<blockquote>
<p>sw14</p>
<p>Enable<br>
Conf t<br>
Vlan 20<br>
Exit<br>
Interface f0/2<br>
Switchport access vlan 20<br>
Exit<br>
Interface f0/1<br>
Switchport mode trunk</p>
</blockquote>
<blockquote>
<p>sw12</p>
<p>enable<br>
conf t<br>
vlan 10<br>
exit<br>
vlan 20<br>
interface range f0/1-3<br>
switchport mode trunk</p>
</blockquote>
<blockquote>
<p>sw1</p>
<p>enable<br>
conf t<br>
vlan 10<br>
exit<br>
vlan 20<br>
exit<br>
interface f0/1<br>
switchport tr en do<br>
switchport mode trunk<br>
exit<br>
interface vlan 10<br>
ip address 192.168.10.1 255.255.255.0<br>
exit<br>
interface vlan 20<br>
ip address 192.168.20.1 255.255.255.0<br>
exit<br>
ip routing</p>
<p>Switch(config)#interface f0/2<br>
Switch (config-if)#no switchport（使其成为路由器接口）<br>
Switch(config-if)#ip address 192.168.30.1 255.255.255.0</p>
</blockquote>
<blockquote>
<p>route 4</p>
<p>enable<br>
config t<br>
interface f0/0<br>
no shutdown<br>
ip address 192.168.30.2 255.255.255.0<br>
exit<br>
interface f0/1<br>
no shutdown<br>
ip address 192.168.40.1 255.255.255.0</p>
</blockquote>
<blockquote>
<p>route 5</p>
<p>enable<br>
conf t<br>
interface f0/0<br>
no shutdown<br>
ip address 192.168.40.2 255.255.255.0<br>
exit<br>
interface f0/1<br>
no shutdown<br>
ip address 192.168.50.1 255.255.255.0</p>
</blockquote>
<blockquote>
<p><strong>什么是 ACL？</strong></p>
<p>ACL 全称访问控制列表（Access Control List），主要通过配置一组规则进行过滤路由器或交换机接口进出的数据包，</p>
<p>是<strong>控制访问的一种网络技术手段</strong>， ACL 适用于所有的被路由支持的协议，如 IP、tcp、udp、ftp、www 等。</p>
<p><strong>什么是反掩码？</strong></p>
<p>反掩码就是通配符掩码 ， 通过标记 0 和 1 告诉设备应该匹配到哪位。 在反掩码中，相应位为 1 的地址在比较中忽略，</p>
<p>为 0 的必须被检查。IP 地址与反掩码都是 32 位的数 由于跟子网掩码刚好相反，所以也叫反掩码 。</p>
<p>路由器使用的通配符掩码与源或目标地址一起来分辨匹配的地址范围，它与子网掩码不同。它不像子网掩码告诉</p>
<p>路由器 IP 地址是属于哪个子网（网段），通配符掩码告诉路由器为了判断出匹配，它需要检查 IP 地址中的多少位。</p>
<p>例如：</p>
<p>255.255.255.0 反掩码（wildcard-mask）就是 0.0.0.255</p>
<p>255.255.255.248 反掩码（wildcard-mask）就是 0.0.0.7</p>
<p><strong>ACL 工作原理：</strong></p>
<p>ACL 使用包过滤技术，在路由器上读取 OSI 七层模型的第 3 层和第 4 层包头中的信息。如源地址，目标地址，源端口，目标端口等，根据预先定义好的规则，对包进行过滤，从而达到访问控制的目的。</p>
<p>对于路由器接口而言，ACL 是有两个方向：</p>
<p>** 注意：** 如果发现没有匹配的 ACL 规则，默认会丢弃该数据包，思科 ACL 规则默认会有一条隐藏的 deny any any 规则，而华三 ACL 规则默认是 permit any any 规则。</p>
<p>** 入站 ----** 如果是入站访问列表，则当路由器接收到数据包时，Cisco IOS 软件将检查访问列表中的条件语句，看是否有匹配。如果数据包被允许，则软件将继续处理该数据包。如果数据包被拒绝，则软件会丢弃该数据包。</p>
<p>** 出站 ----** 如果是出站访问列表，则当软件到接收数据包并将群其路由至出站接口后，软件将检查访问列表中的条件语句，看是否有匹配。如果数据包被允许，则软件会发送该数据包。如果数据包被拒绝，则软件会丢弃该数据包。</p>
<p><img src="https://images2018.cnblogs.com/blog/435896/201805/435896-20180516175614455-864140199.png" alt="img"></p>
<p><strong>ACL 两种类型：</strong></p>
<p>** 标注：** 允许在标准 ACL 和扩展 ACL 中使用名称代替访问控制列表号。</p>
<p><strong>1、 标准的 ACL</strong></p>
<p>根据数据包的源 IP 地址来控制允许转发或拒绝数据包，访问控制列表号 1~99。</p>
<p>标准访问控制列表配置命令如下：</p>
<p>Router(config)#access-list access-list-number {permit|deny} source [souce-wildcard]</p>
<p>或者</p>
<p>Router(config)#ip access-list standard access-list-number</p>
<p>Router(config-std-nacl)#Sequence Number{permit|deny} source [souce-wildcard]</p>
<p>下面是命令参数的详细说明</p>
<p>access-list-number：访问控制列表号，标准 ACL 取值是 1-99，可以使用名称替代列表号。</p>
<p>Sequence Number：每条 ACL 规则列表序列号，可使用范围 1-2147483647。</p>
<p>permit | deny：如果满足规则，则允许 / 拒绝通过。</p>
<p>source：数据包的源地址，可以是主机地址，也可以是网络地址</p>
<p><strong>2、 扩展的 ACL</strong></p>
<p>根据数据包的源 IP 地址、目的 IP 地址、指定协议，端口、标志和时间来控制允许转发或拒绝数据包，访问控制列表号 100~199</p>
<p>扩展访问控制列表配置命令如下：</p>
<p>Router(config)#access-list access-list-number {permit|deny} protocol {source souce-wildcard destination destination-wildcard} [operator operan]</p>
<p>或者</p>
<p>Router(config)#ip access-list extended access-list-number</p>
<p>Router(config-std-nacl)#{permit|deny} protocol {source souce-wildcard destination destination-wildcard} [operator operan]</p>
<p>下面是命令参数的详细说明</p>
<p>access-list-number：访问控制列表号，扩展 ACL 取值 100-199，可以使用名称替代列表号。</p>
<p>Sequence Number：每条 ACL 规则列表序列号，可使用范围 1-2147483647。</p>
<p>permit|deny：如果满足规则，则允许 / 拒绝通过。</p>
<p>protocol：用来指定协议的类型，如 IP，TCP，UDP，ICMP 等。</p>
<p>source、destination：源和目的，分别用来标示源地址和目的地址。</p>
<p>souce-wildcard、destination-wildcard：子网反码，souce-wildcard 是源反码，destination-wildcard 是目标反码。</p>
<p>operator operan：lt (小于)、gt (大于)、eq (等于)、neq (不等于)、rand (范围端口号) 等。</p>
</blockquote>
<blockquote>
<p><strong>DHCP</strong></p>
<p>​	DHCP 全称为 Dynamic Host Configuration Protocol，中文含义为 “动态主机配置协议”，通常被应用在大型的局域网络环境中，主要作用是集中管理、分配 IP 地址，使网络环境中的主机动态获得 IP 地址、Gateway 地址、<a target="_blank" rel="noopener" href="https://product.pconline.com.cn/itbk/wlbg/network/1305/3304121.html">DNS</a> 服务器地址等信息，并能够提升地址的使用率。</p>
<p>DHCP 协议采用客户端 / 服务器模型，主机地址的动态分配任务由网络主机驱动。当 DHCP 服务器接收到来自网络主机申请地址的信息时，才会向网络主机发送相关的地址配置等信息，以实现网络主机地址信息的动态配置。</p>
<p>​	<strong>DHCP 服务器</strong>就是自动给电脑分配 IP 地址和子网掩码的服务器。比如我们设置了路由器的 DHCP 服务器，让 DHCP 服务器自动分配 IP 地址，从<a target="_blank" rel="noopener" href="https://product.pconline.com.cn/itbk/wlbg/network/1403/4387067.html"> 192.168.1.1</a>00 到 192.168.1.199 (子网掩码会自动设置，我们无需设置)。</p>
</blockquote>
<h2 id="实训4-rip一般配置方法"><a class="markdownIt-Anchor" href="#实训4-rip一般配置方法">#</a> 实训 4 RIP 一般配置方法</h2>
<blockquote>
<p>RIP（Routing　Information protocol) 路由信息协议.<br>
 是一种内部网关协议（IGP），是一种动态路由选择协议，用于自治系统（AS）内的路由信息的传递。RIP 协议基于距离矢量算法（DistanceVectorAlgorithms），使用 “跳数”(即 metric) 来衡量到达目标地址的路由距离。RIP 通过 UDP 报文进行路由信息交换，使用的端口号为 520.</p>
<p>这种协议的路由器<strong>只关心自己周围的世界，只与自己相邻的路由器交换信息，范围限制在 15 跳 (15 度) 之内</strong>，再远，它就不关心了。RIP 应用于 OSI 网络七层模型的应用层。各厂家定义的管理距离（AD，即优先级）如下：华为定义的优先级是 100，思科定义的优先级是 120。</p>
</blockquote>
<blockquote>
<p>第一步：将每个设备的 IP 地址配好</p>
<p>Router#configure terminal<br>
Enter configuration commands, one per line.  End with CNTL/Z.<br>
Router(config)#interface g0/0<br>
Router(config-if)#ip address 192.168.1.1 255.255.255.0<br>
Router(config-if)#no shutdown<br>
Router(config-if)#exit<br>
Router(config)#interface Se0/3/0<br>
Router(config-if)#ip address 10.0.0.1 255.0.0.0<br>
Router(config-if)#no shutdown<br>
Router(config-if)#end<br>
Router#<br>
%SYS-5-CONFIG_I: Configured from console by console</p>
<p>Router#</p>
</blockquote>
<blockquote>
<p>第二步：配置 rip 路由</p>
<p>Router(config)#hostname R0<br>
R0(config)#end<br>
R0#<br>
%SYS-5-CONFIG_I: Configured from console by console<br>
R0#configure terminal<br>
Enter configuration commands, one per line.  End with CNTL/Z.<br>
R0(config)#route rip<br>
R0(config-router)#network 192.168.1.0<br>
R0(config-router)#network 10.0.0.0<br>
R0(config-router)#end</p>
</blockquote>
<h2 id="实训5-华为交换初步"><a class="markdownIt-Anchor" href="#实训5-华为交换初步">#</a> 实训 5 华为交换初步</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">实训目的：</span><br><span class="line">了解VLAN的划分方法；</span><br><span class="line">了解VLAN特性；</span><br><span class="line">了解Trunk的配置方法</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/sizaif/article/details/78281112">(30 条消息) 二层交换机实现 vlan 功能 (Cisco Packer Tracer 模拟器)_sizaif 的博客 - CSDN 博客</a></p>
<p><img src="https://img-blog.csdn.net/20171019103159363?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2l6YWlm/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="img"></p>
<blockquote>
<p>主机配置：</p>
<p>Switch&gt;en<br>
Switch#conf<br>
Switch (config)#vlan 10 // 创建 vlan 10<br>
Switch (config-vlan)#vlan 20 // 创建 vlan 20<br>
Switch(config-vlan)#EXIT<br>
Switch (config-if)#interface fa0/1  // 进入端口 f0/1 并配置为接入到 vlan10 的 access 模式<br>
 Switch (config-if)#switchport mode access<br>
Switch(config-if)#switchport  access  vlan 10<br>
Switch (config-if)#interface fa0/2  // 进入端口 f0/2 并配置为接入到 vlan20 的 access 模式<br>
 Switch (config-if)#switchport mode access<br>
Switch(config-if)#switchport  access  vlan 20</p>
</blockquote>
<blockquote>
<p>交换机配置：</p>
<p>Switch&gt;en	<br>
Switch#conf<br>
Switch (config)#interface fa0/24 // 进入端口 f0/24  并设置为 trun 模式，允许所以 vlan 通过<br>
 Switch (config-if)#switchport mode access<br>
Switch(config-if)#switchport mode trunk<br>
Switch(config-if)#switchport trunk allowed vlan all</p>
</blockquote>
<p>192.168.1.1 ----- &gt;ping 192.168.2.2 <strong>ping 不通  ：同一交换机下，不同 vlan，不同网段</strong><img src="https://img-blog.csdn.net/20171019103514241?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2l6YWlm/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="img"></p>
<p>192.168.1.1 ----- &gt; ping 192.168.1.4 <strong>ping 通： 跨交换机，同一 vlan，同一网段</strong></p>
<p><img src="https://img-blog.csdn.net/20171019103517139?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2l6YWlm/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="img"></p>
<h2 id="总结"><a class="markdownIt-Anchor" href="#总结">#</a> 总结</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Switch<span class="meta">#show ip route</span></span><br><span class="line">Switch<span class="meta">#show vlan</span></span><br><span class="line">Switch<span class="meta">#write #保存已写的内容</span></span><br><span class="line">    </span><br><span class="line">PC&gt;ipconfig IP</span><br><span class="line">PC&gt;ping <span class="number">192.168</span><span class="number">.2</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>
<p><img src="https://zhang2002gz.oss-cn-qingdao.aliyuncs.com/img/image-20220903230622353.png" alt="image-20220903230622353"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">二层交换机</span><br><span class="line">Switch&gt;en</span><br><span class="line">Switch<span class="meta">#conf t</span></span><br><span class="line"></span><br><span class="line">#设置<span class="function">vlan    </span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config)</span><span class="meta">#vlan 2</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config)</span><span class="meta">#vlan 3</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-vlan)</span><span class="meta">#exit</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">#同一个vlan交流，配置vlan就用switchport access vlan n就足够了</span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config)</span><span class="meta">#int fa 0/2</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>)</span><span class="meta">#switchport access vlan 2</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>)</span><span class="meta">#int fa 0/3</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>)</span><span class="meta">#switchport access vlan 3</span></span></span><br><span class="line"><span class="function">#想vlan2和vlan3交流就得使用trunk协议，二层交换机上配置如下：</span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>)</span><span class="meta">#int fa 0/1</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>)</span><span class="meta">#switchport mode trunk</span></span></span><br><span class="line"><span class="function">  </span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>)</span><span class="meta">#end</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">三层交换机</span><br><span class="line">Switch&gt;en</span><br><span class="line">Switch<span class="meta">#conf t</span></span><br><span class="line"></span><br><span class="line">Switch(config)<span class="meta">#vlan 2</span></span><br><span class="line">Switch(config)<span class="meta">#vlan 3</span></span><br><span class="line">Switch(config-vlan)<span class="meta">#exit</span></span><br><span class="line"></span><br><span class="line">#三层交换机口配置    </span><br><span class="line">Switch(config)<span class="meta">#int fa 0/1</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#switchport trunk encapsulation dot1q</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#switchport mode trunk</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#switchport trunk allowed vlan 2,3</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#exit</span></span><br><span class="line"></span><br><span class="line">#启动vlan n的使用</span><br><span class="line">Switch(config)<span class="meta">#int vlan 2</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#ip address 192.168.1.1 255.255.255.0</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#no shutdown</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#exit</span></span><br><span class="line">（vlan <span class="number">3</span> 同理）</span><br><span class="line"></span><br><span class="line">#开启三层交换机默认路由</span><br><span class="line">Switch(config)<span class="meta">#ip routing</span></span><br><span class="line">Switch(config)<span class="meta">#exit</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">##配置VTP服务器https:<span class="comment">//www.cnblogs.com/zoulongbin/p/9047390.html</span></span><br><span class="line">#三层交换机实现服务器</span><br><span class="line">Switch&gt;enable</span><br><span class="line">Switch<span class="meta">#vlan database</span></span><br><span class="line">Switch(vlan)<span class="meta">#vtp domain CCTV</span></span><br><span class="line">Switch(vlan)<span class="meta">#vtp server</span></span><br><span class="line">    </span><br><span class="line">##创建<span class="function">VLAN</span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(vlan)</span><span class="meta">#vlan 10 name VLAN10</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(vlan)</span><span class="meta">#vlan 20 name VLAN20</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(vlan)</span><span class="meta">#exit</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">##配置VLAN IP地址</span></span><br><span class="line"><span class="function">Switch<span class="meta">#configure terminal</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config)</span><span class="meta">#interface vlan 10</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>)</span><span class="meta">#ip address 192.168.10.1 255.255.255.0</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>)</span><span class="meta">#exit</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config)</span><span class="meta">#interface vlan 20</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>)</span><span class="meta">#ip address 192.168.20.1 255.255.255.0</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>)</span><span class="meta">#exit</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">##开启三层交换机默认路由</span></span><br><span class="line"><span class="function">3560<span class="title">SW</span><span class="params">(config)</span><span class="meta">#ip routing</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">#设置端口汇聚<span class="params">(trunk)</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config)</span><span class="meta">#interface range fastEthernet 0/22-24</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>-range)</span><span class="meta">#switchport trunk encapsulation dot1q</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>-range)</span><span class="meta">#switchport mode trunk</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>-range)</span><span class="meta">#no shutdown</span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>-range)</span><span class="meta">#exit</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#二层交换机作为VTP客户端</span><br><span class="line">Switch<span class="meta">#vlan database</span></span><br><span class="line">Switch(vlan)<span class="meta">#vtp domain CCTV</span></span><br><span class="line">Switch(vlan)<span class="meta">#vtp client</span></span><br><span class="line">Switch(vlan)<span class="meta">#exit</span></span><br><span class="line">    </span><br><span class="line">##设置端口汇聚(trunk)</span><br><span class="line">Switch<span class="meta">#configure terminal</span></span><br><span class="line">Switch(config)<span class="meta">#interface fastEthernet 0/24</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#switchport mode trunk</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#no shutdown</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#exit</span></span><br><span class="line">    </span><br><span class="line">##分配VLAN所属端口</span><br><span class="line">Switch<span class="meta">#configure terminal</span></span><br><span class="line">Switch(config)<span class="meta">#interface range fastEthernet 0/1-5</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>-range)<span class="meta">#switchport access vlan 10</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>-range)<span class="meta">#switchport mode access</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>-range)<span class="meta">#no shutdown</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>-range)<span class="meta">#exit</span></span><br></pre></td></tr></table></figure>
<p><img src="https://zhang2002gz.oss-cn-qingdao.aliyuncs.com/img/image-20220903233009617.png" alt="image-20220903233009617"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#PC机与路由器间的配置：</span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="meta">#interface FastEthernet0/0</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="meta">#ip address 192.168.1.254 255.255.255.0</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="meta">#no shutdown</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="meta">#exit  </span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#路由器与路由器间的配置</span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="meta">#interface GigabitEthernet0/0</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="meta">#ip address 172.16.10.1 255.255.255.0</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="meta">#no shutdown                          </span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="meta">#exit</span></span><br><span class="line"><span class="meta">#ospf配置</span></span><br><span class="line">Router(config)<span class="meta">#router ospf 10                        </span></span><br><span class="line">Router(config-router)<span class="meta">#network 172.16.10.0 0.0.0.255 area 1 </span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#配置loopback接口（ip自定义）</span><br><span class="line">Router(config)<span class="meta">#interface loopback 0</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="meta">#ip address 1.1.1.1 255.255.255.255</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="meta">#no shutdown</span></span><br><span class="line">Router(config)<span class="meta">#interface loopback 1</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="meta">#ip address 192.168.1.1 255.255.255.0</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="meta">#no shutdown</span></span><br></pre></td></tr></table></figure>
<p><img src="https://zhang2002gz.oss-cn-qingdao.aliyuncs.com/img/image-20220903233645910.png" alt="image-20220903233645910"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#路由器地址配置</span><br><span class="line">Router(config)<span class="meta">#interface g0/0</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="meta">#ip address 192.168.1.1 255.255.255.0</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="meta">#no shutdown</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="meta">#exit</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#路由器RIP配置</span><br><span class="line">Router(config)<span class="meta">#hostname R0</span></span><br><span class="line">R0(config)<span class="meta">#route rip</span></span><br><span class="line">R0(config-router)<span class="meta">#network 192.168.1.0</span></span><br><span class="line">R0(config-router)<span class="meta">#network 10.0.0.0</span></span><br><span class="line">R0(config-router)<span class="meta">#end</span></span><br></pre></td></tr></table></figure>
<p><img src="https://zhang2002gz.oss-cn-qingdao.aliyuncs.com/img/image-20220903234041573.png" alt="image-20220903234041573"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">主机的vlan配置：</span><br><span class="line">Switch(config)<span class="meta">#vlan 10  </span></span><br><span class="line">Switch(config-vlan)#<span class="function">EXIT</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>)</span><span class="meta">#interface fa0/1 </span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>)</span><span class="meta">#switchport mode access </span></span></span><br><span class="line"><span class="function"><span class="title">Switch</span><span class="params">(config-<span class="keyword">if</span>)</span><span class="meta">#switchport access vlan 10</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">二层交换机间的配置：</span><br><span class="line">Switch(config)<span class="meta">#interface fa0/24 </span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#switchport mode access </span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#switchport mode trunk </span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#switchport trunk allowed vlan all</span></span><br></pre></td></tr></table></figure>
<p><img src="https://zhang2002gz.oss-cn-qingdao.aliyuncs.com/img/image-20220904091713476.png" alt="image-20220904091713476"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">路由器与交换机间的配置：</span><br><span class="line">（<span class="number">1</span>）交换机端口配置</span><br><span class="line">#f0/<span class="number">1</span>协议配置</span><br><span class="line">Switch(config)<span class="meta">#interface f0/1</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#switchport trunk encapsulation dot1q</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#switchport mode trunk</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#exit</span></span><br><span class="line"></span><br><span class="line">#f0/<span class="number">1</span> IP配置</span><br><span class="line">Switch(config)<span class="meta">#interface f0/1</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#no switchport（使其成为路由器接口） </span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#ip address 192.168.30.1 255.255.255.0</span></span><br><span class="line"></span><br><span class="line">（<span class="number">2</span>）路由器配置</span><br><span class="line">Switch(config)<span class="meta">#interface f0/0</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#no shutdown</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#ip address 192.168.30.2 255.255.255.0</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="meta">#exit</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#DHCP:动态地址获取</span><br><span class="line">Switch(config)<span class="meta">#ip dhcp pool vlan20</span></span><br><span class="line">Switch(dhcp-config)<span class="meta">#network 192.168.20.254 255.255.255.0</span></span><br><span class="line">Switch(dhcp-config)<span class="meta">#default-router 192.168.20.254</span></span><br><span class="line">Switch(dhcp-config)<span class="meta">#dns-server 8.8.8.8</span></span><br><span class="line">Switch(dhcp-config)<span class="meta">#end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#telnet:远程登陆</span></span><br><span class="line">Switch（config）<span class="meta">#enable password 123</span></span><br><span class="line">Switch（config）<span class="meta"># <span class="meta-keyword">line</span> vty 0 2</span></span><br><span class="line">Switch（config-line）<span class="meta"># password cisco</span></span><br></pre></td></tr></table></figure>
<p><img src="https://zhang2002gz.oss-cn-qingdao.aliyuncs.com/img/image-20220904144443585.png" alt="image-20220904144443585"></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">十二惊惶</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://shierjinghuang.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AE%9E%E8%AE%AD/20220908/">https://shierjinghuang.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AE%9E%E8%AE%AD/20220908/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">十二惊惶</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E5%AE%9E%E8%AE%AD%E8%AE%B0%E5%BD%95/">
                                    <span class="chip bg-color">实训记录</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/%E7%AE%80%E5%8D%95%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%99%A8/20220908/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/8.jpg" class="responsive-img" alt="计算机网络实训之简单文件传输系统器">
                        
                        <span class="card-title">计算机网络实训之简单文件传输系统器</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-09-08
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E7%9B%B8%E5%85%B3/" class="post-category">
                                    网络工程相关
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%AE%9E%E8%AE%AD%E8%AE%B0%E5%BD%95/">
                        <span class="chip bg-color">实训记录</span>
                    </a>
                    
                    <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">
                        <span class="chip bg-color">计算机网络</span>
                    </a>
                    
                    <a href="/tags/FTP/">
                        <span class="chip bg-color">FTP</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1%E5%9B%BD%E8%B5%9B%E9%80%89%E6%8B%94/20220810/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/4.jpg" class="responsive-img" alt="数学建模：综合选拔题">
                        
                        <span class="card-title">数学建模：综合选拔题</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-08-10
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E4%B8%AA%E4%BA%BA/" class="post-category">
                                    个人
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/">
                        <span class="chip bg-color">数学建模</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2023</span>
            
            <a href="/about" target="_blank">十二惊惶</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">318.8k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:572688347@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=572688347" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 572688347" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
